(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("roslib"),require("xstream"),require("three"),require("three/examples/jsm/loaders/STLLoader.js"),require("three/examples/jsm/loaders/ColladaLoader.js"),require("three-mesh-bvh"),require("three-spritetext"),require("@juggle/resize-observer"),require("lodash.debounce"),require("three-freeform-controls"),require("randomcolor")):"function"==typeof define&&define.amd?define(["roslib","xstream","three","three/examples/jsm/loaders/STLLoader.js","three/examples/jsm/loaders/ColladaLoader.js","three-mesh-bvh","three-spritetext","@juggle/resize-observer","lodash.debounce","three-freeform-controls","randomcolor"],t):(e=e||self,e.amphion=t(e.ROSLIB,e.xs,e.three,e.STLLoader,e.ColladaLoader,e.threeMeshBvh,e.SpriteText,e.resizeObserver,e.debounce,e.threeFreeformControls,e.randomColor))})(this,function(e,t,o,a,r,i,n,s,l,d,p){"use strict";var c=Math.pow,m=Math.abs,g=Math.round,y=Math.floor,b=Math.max,E=Math.min,_=Math.sin,T=Math.cos,v=Math.PI;function S(e,t){function o(){this.constructor=e}H(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}function O(e,t,o,a){return new(o||(o=Promise))(function(r,i){function n(e){try{l(a.next(e))}catch(t){i(t)}}function s(e){try{l(a["throw"](e))}catch(t){i(t)}}function l(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(n,s)}l((a=a.apply(e,t||[])).next())})}function A(e,o){function a(e){return function(t){return r([e,t])}}function r(t){if(i)throw new TypeError("Generator is already executing.");for(;d;)try{if(i=1,n&&(s=2&t[0]?n["return"]:t[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,t[1])).done)return s;switch((n=0,s)&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,n=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if((s=d.trys,!(s=0<s.length&&s[s.length-1]))&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){d.label=t[1];break}if(6===t[0]&&d.label<s[1]){d.label=s[1],s=t;break}if(s&&d.label<s[2]){d.label=s[2],d.ops.push(t);break}s[2]&&d.ops.pop(),d.trys.pop();continue;}t=o.call(e,d)}catch(o){t=[6,o],n=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,n,s,l,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l}function P(e){var t="function"==typeof Symbol&&e[Symbol.iterator],a=0;return t?t.call(e):{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}}function C(t,o){var a="function"==typeof Symbol&&t[Symbol.iterator];if(!a)return t;var s,l,d=a.call(t),i=[];try{for(;(void 0===o||0<o--)&&!(s=d.next()).done;)i.push(s.value)}catch(e){l={error:e}}finally{try{s&&!s.done&&(a=d["return"])&&a.call(d)}finally{if(l)throw l.error}}return i}function M(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}function R(e){if(e===void 0||null===e)throw new TypeError("Expected 'val' to be defined, but received "+e)}function j(e){if(!(e instanceof o.Mesh))throw new TypeError("Expected 'val' to be mesh")}function L(e){if(!(e instanceof o.Material))throw new TypeError("Expected 'val' to be Material")}function N(e){if(!(e instanceof o.MeshBasicMaterial))throw new TypeError("Expected 'val' to be MeshBasicMaterial")}function x(e){if(!("color"in e))throw new TypeError("Expected 'val' to be MeshBasicMaterial with color")}function I(e){if(e.length===void 0)throw new TypeError("Expected 'val' to be an array")}function D(e){return e instanceof o.Object3D}function k(e){return e instanceof HTMLElement}function w(e){if(!(e instanceof o.TorusGeometry))throw new Error("the provided geometry was not TorusGeometry")}function U(e){if(!(e instanceof HTMLVideoElement))throw new Error("the provided element must be an HTMLVideoElement")}function z(e){if(!(e instanceof o.BufferGeometry))throw new Error("the provided attribute must be an BufferGeometry")}function F(e){if(!(e instanceof o.BufferAttribute))throw new Error("the provided attribute must be an BufferAttribute")}function Y(e,t){return t={exports:{}},e(t,t.exports),t.exports}var V="default"in e?e["default"]:e;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t;var G="default"in o?o["default"]:o;a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r["default"]:r,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i["default"]:i,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n["default"]:n,l=l&&Object.prototype.hasOwnProperty.call(l,"default")?l["default"]:l,p=p&&Object.prototype.hasOwnProperty.call(p,"default")?p["default"]:p;var H=function(e,t){return H=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},H(e,t)},B=function(){return B=Object.assign||function t(e){for(var o,a=1,r=arguments.length;a<r;a++)for(var n in o=arguments[a],o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);return e},B.apply(this,arguments)},W=function(){function o(o){var a,r=this;this.createdAt=new Date,this.isStreamLive=!1,this.isStreamPaused=!1,this.internalListener=null,this.listeners=new Set,this.rosConnectionHook=null,this.rosCloseHook=null,this.rosErrorHook=null,this.addRosHealthHooks=function(){r.rosCloseHook=function(){r.isStreamLive=!1,r.cleanStream("complete")},r.rosErrorHook=function(e){r.isStreamLive=!1,r.cleanStream("error",e)},r.ros.on("error",r.rosErrorHook),r.ros.on("close",r.rosCloseHook)},this.removeRosHealthHooks=function(){r.ros.off("error",r.rosErrorHook),r.ros.off("close",r.rosCloseHook),r.rosErrorHook=null,r.rosCloseHook=null},this.addListener=function(e){return r.listeners.has(e)?{success:!1,reason:"listener already present"}:(r.listeners.add(e),r.isStreamLive&&r.stream.addListener(e),{success:!0})},this.removeListener=function(e){return r.listeners.has(e)?(r.listeners.delete(e),r.stream.removeListener(e),{success:!0}):{success:!1,reason:"listener not present"}},this.cleanStream=function(e,t){"error"===e?r.stream.shamefullySendError(t):r.stream.shamefullySendComplete(),r.listeners.forEach(function(e){r.stream.removeListener(e)})},this.removeAllListeners=function(){return r.listeners.forEach(function(e){r.stream.removeListener(e)}),r.listeners.clear(),{success:!0}},this.pause=function(){return r.isStreamPaused=!0,{success:!0}},this.resume=function(){return r.isStreamPaused=!1,{success:!0}},this.ros=o.ros,this.hasMemory=!(null===(a=o.memory)||void 0===a)&&a;var i={ros:this.ros,name:o.topicName,messageType:o.messageType};o.compression&&(i.compression=o.compression),o.queueSize&&(i.queue_size=o.queueSize),o.queueLength&&(i.queue_length=o.queueLength),this.topic=new e.Topic(i),this.producer={start:function(e){r.rosCloseHook||r.rosErrorHook||r.addRosHealthHooks(),r.internalListener=function(t){r.isStreamPaused||e.next(t)},r.topic.subscribe(r.internalListener)},stop:function(){r.topic.unsubscribe(r.internalListener),r.removeRosHealthHooks()}},this.stream=this.hasMemory?t.createWithMemory(this.producer):t.create(this.producer),this.isStreamLive=!0,this.rosConnectionHook=function(){r.isStreamLive||(r.stream=r.hasMemory?t.createWithMemory(r.producer):t.create(r.producer),r.isStreamLive=!0,r.listeners.forEach(function(e){r.stream.addListener(e)}))},this.ros.on("connection",this.rosConnectionHook)}return o}(),X="Arrow",q="ArrowWithCircle",Z="Axes",Q="FlatArrow",K=5e6,J=15790320,$=30,ee=30,te=11184810,oe=7368816,ae={INHERIT:0,FIXED:1,VIEW_FACING:2},re=[ae.VIEW_FACING],ie={NONE:0,MENU:1,BUTTON:2,MOVE_AXIS:3,MOVE_PLANE:4,ROTATE_AXIS:5,MOVE_ROTATE:6,MOVE_3D:7,ROTATE_3D:8,MOVE_ROTATE_3D:9},ne="robot_description",se="geometry_msgs/AccelStamped",le="geometry_msgs/PolygonStamped",de="geometry_msgs/PoseArray",pe="geometry_msgs/msg/PoseArray",ce="geometry_msgs/PoseWithCovariance",me="geometry_msgs/PoseStamped",ue="geometry_msgs/msg/PoseStamped",he="geometry_msgs/TwistStamped",ge="geometry_msgs/Vector3Stamped",ye="geometry_msgs/WrenchStamped",be="moveit_msgs/BoundingVolume",fe="moveit_msgs/CollisionObject",Ee="moveit_msgs/DisplayRobotState",_e="moveit_msgs/DisplayTrajectory",Te="moveit_msgs/PlanningScene",ve="nav_msgs/OccupancyGrid",Se="nav_msgs/msg/OccupancyGrid",Oe="nav_msgs/Odometry",Ae="nav_msgs/msg/Odometry",Pe="nav_msgs/Path",Ce="nav_msgs/msg/Path",Me="sensor_msgs/CompressedImage",Re="sensor_msgs/JointState",je="sensor_msgs/Image",Le="sensor_msgs/msg/Image",Ne="sensor_msgs/LaserScan",xe="sensor_msgs/msg/LaserScan",Ie="sensor_msgs/MagneticField",De="sensor_msgs/PointCloud",ke="sensor_msgs/PointCloud2",we="sensor_msgs/msg/PointCloud2",Ue="sensor_msgs/Range",ze="tf/tfMessage",Fe="tf/msg/tfMessage",Ye="tf2_msgs/TFMessage",Ve="tf2_msgs/msg/TFMessage",Ge="visualization_msgs/Marker",He="visualization_msgs/msg/Marker",Be="visualization_msgs/MarkerArray",We="visualization_msgs/msg/MarkerArray",Xe="visualization_msgs/InteractiveMarkerInit",qe="visualization_msgs/InteractiveMarkerFeedback",Ze={INT8:1,UINT8:2,INT16:3,UINT16:4,INT32:5,UINT32:6,FLOAT32:7,FLOAT64:8},Qe={ADD:0,REMOVE:1,APPEND:2,MOVE:3},Ke={BOX:1,SPHERE:2,CYLINDER:3,CONE:4},Je={ARROW:0,CUBE:1,SPHERE:2,CYLINDER:3,LINE_STRIP:4,LINE_LIST:5,CUBE_LIST:6,SPHERE_LIST:7,POINTS:8,TEXT_VIEW_FACING:9,MESH_RESOURCE:10,TRIANGLE_LIST:11},$e={MAP:"map",CONST_MAP:"constmap",RAW:"raw"},et={SQUARES:"squares",POINTS:"points",FLAT_SQUARES:"flat_squares",SPHERES:"spheres",BOXES:"boxes"},tt={INTENSITY:"Intensity",AXIS_COLOR:"AxisColor",FLAT_COLOR:"FlatColor"},ot={RGB:"rgb",INTENSITY:"intensity"},at={X:"x",Y:"y",Z:"z"},rt=B({INTENSITY:"intensity"},at),it={arrow:X,axes:Z},nt={arrow:X,axes:Z,flatArrow:Q},st={arrow:X,arrowWithCircle:q},lt=1,dt=1,pt=32,ct=1,mt=1,ut="#ff0000",ht="#008000",gt="#0000ff",yt="#f0ff00",bt="#f0ff00",ft={backgroundColor:J,gridSize:$,gridDivisions:ee,gridColor:te,gridCenterlineColor:oe},Et={selectedFrame:""},_t={shaftLength:1,shaftRadius:.05,headLength:.3,headRadius:.1},Tt={axesLength:1,axesRadius:.1},vt={arrowLength:.3},St={robot:new o.Group,loop:!0},Ot={channelName:rt.INTENSITY,useRainbow:!1,invertRainbow:!1,minColor:"#000000",maxColor:"#ffffff",autocomputeIntensityBounds:!1,maxIntensity:3730,minIntensity:388},At={},Pt={axis:at.X,autocomputeValueBounds:!1,useFixedFrame:!1,minAxisValue:0,maxAxisValue:0},Ct={streamType:{VP8:"vp8",MJPEG:"mjpeg"}.MJPEG,f:526,maxDepthPerTile:1,pointSize:3,width:1024,height:1024,whiteness:0,varianceThreshold:16667e-9},Mt={queueSize:1,width:320,height:240,compression:"cbor"},Rt={width:320,height:240},jt=B(B({selectable:!1,style:et.FLAT_SQUARES,size:.05,alpha:1,decayTime:0,queueSize:10,compression:"cbor",colorTransformer:tt.INTENSITY,flatColor:"#ffffff"},Ot),Pt),Lt={alpha:1,colorScheme:$e.MAP,compression:"cbor",drawBehind:!1},Nt={queueSize:1,namespaces:[]},xt={queueSize:1,namespaces:[],throttleRate:0},It={queueSize:1,namespaces:[],throttleRate:0,publishThrottleRate:0,hideOtherHandlesOnSelect:!0,hideOtherControlsInstancesOnSelect:!0},Dt=B(B(B(B({type:X,color:ut,alpha:1},_t),Tt),vt),{positionTolerance:.1,angleTolerance:.1,keep:100}),kt={color:"#ffffff",alpha:1},wt={},Ut={compression:"cbor",colorChannel:ot.RGB,size:.0125,useRainbow:!0,queueSize:1},zt={color:"#ff0000",alpha:1,radius:.2},Ft={color:"#ffffff",alpha:1},Yt=B(B(B({color:ut,alpha:1},_t),Tt),{type:nt.arrow}),Vt={circleRadius:.3,tube:.03,radialSegments:16,tubularSegments:100,arc:1.7*v},Gt=B(B(B({},_t),Vt),{circleConeLength:.1,circleConeRadius:.1}),Ht=B(B({forceColor:ut,torqueColor:yt,alpha:1,forceArrowScale:1,torqueArrowScale:1,arrowWidth:1},Gt),{type:st.arrow}),Bt=B(B(B(B({color:ut,alpha:1},_t),Tt),vt),{type:nt.arrow}),Wt={color:ut,alpha:1},Xt={},qt={},Zt=Object.freeze({__proto__:null,OBJECT_TYPE_ARROW:X,OBJECT_TYPE_ARROW_WITH_CIRCLE:q,OBJECT_TYPE_AXES:Z,OBJECT_TYPE_FLAT_ARROW:Q,MAX_POINTCLOUD_POINTS:K,DEFAULT_BACKGROUND_COLOR:J,DEFAULT_GRID_SIZE:$,DEFAULT_GRID_DIVISIONS:ee,DEFAULT_GRID_COLOR:te,DEFAULT_GRID_COLOR_CENTERLINE:oe,INTERACTIVE_MARKER_ORIENTATION_MODES:ae,UNSUPPORTED_INTERACTIVE_MARKER_ORIENTATION_MODES:re,INTERACTIVE_MARKER_INTERACTION_MODES:ie,MESSAGE_TYPE_ROBOT_MODEL:ne,MESSAGE_TYPE_ACCELSTAMPED:se,MESSAGE_TYPE_POINTSTAMPED:"geometry_msgs/PointStamped",MESSAGE_TYPE_POINTSTAMPED2:"geometry_msgs/msg/PointStamped",MESSAGE_TYPE_POLYGONSTAMPED:le,MESSAGE_TYPE_POSEARRAY:de,MESSAGE_TYPE_POSEARRAY2:pe,MESSAGE_TYPE_POSECOVARIANCE:ce,MESSAGE_TYPE_POSECOVARIANCE2:"geometry_msgs/msg/PoseWithCovariance",MESSAGE_TYPE_POSESTAMPED:me,MESSAGE_TYPE_POSESTAMPED2:ue,MESSAGE_TYPE_TWISTSTAMPED:he,MESSAGE_TYPE_VECTOR3STAMPED:ge,MESSAGE_TYPE_WRENCHSTAMPED:ye,MESSAGE_TYPE_WRENCHSTAMPED2:"geometry_msgs/msg/WrenchStamped",MESSAGE_TYPE_BOUNDINGVOLUME:be,MESSAGE_TYPE_COLLISION_OBJECT:fe,MESSAGE_TYPE_DISPLAYROBOTSTATE:Ee,MESSAGE_TYPE_DISPLAYTRAJECTORY:_e,MESSAGE_TYPE_PLANNINGSCENE:Te,MESSAGE_TYPE_OCCUPANCYGRID:ve,MESSAGE_TYPE_OCCUPANCYGRID2:Se,MESSAGE_TYPE_ODOMETRY:Oe,MESSAGE_TYPE_ODOMETRY2:Ae,MESSAGE_TYPE_PATH:Pe,MESSAGE_TYPE_PATH2:Ce,MESSAGE_TYPE_COMPRESSEDIMAGE:Me,MESSAGE_TYPE_DISPLAYJOINTSTATE:Re,MESSAGE_TYPE_IMAGE:je,MESSAGE_TYPE_IMAGE2:Le,MESSAGE_TYPE_LASERSCAN:Ne,MESSAGE_TYPE_LASERSCAN2:xe,MESSAGE_TYPE_MAGNETICFIELD:Ie,MESSAGE_TYPE_POINTCLOUD:De,MESSAGE_TYPE_POINTCLOUD2:ke,MESSAGE_TYPE_ROS2POINTCLOUD2:we,MESSAGE_TYPE_RANGE:Ue,MESSAGE_TYPE_RANGE2:"sensor_msgs/msg/Range",MESSAGE_TYPE_TF:ze,MESSAGE_TYPE_ROS2_TF:Fe,MESSAGE_TYPE_TF2:Ye,MESSAGE_TYPE_ROS2_TF2:Ve,MESSAGE_TYPE_MARKER:Ge,MESSAGE_TYPE_MARKER2:He,MESSAGE_TYPE_MARKERARRAY:Be,MESSAGE_TYPE_MARKERARRAY2:We,MESSAGE_TYPE_INTERACTIVEMARKER:Xe,MESSAGE_TYPE_INTERACTIVEMARKER2:"visualization_msgs/msg/InteractiveMarkerInit",MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE:"visualization_msgs/InteractiveMarkerUpdate",MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE2:"visualization_msgs/msg/InteractiveMarkerUpdate",MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK:qe,MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK2:"visualization_msgs/msg/InteractiveMarkerFeedback",VIZ_TYPE_IMAGE:"Image",VIZ_TYPE_INTERACTIVEMARKER:"InteractiveMarker",VIZ_TYPE_LASERSCAN:"LaserScan",VIZ_TYPE_MAP:"Map",VIZ_TYPE_MARKER:"Marker",VIZ_TYPE_MARKERARRAY:"MarkerArray",VIZ_TYPE_ODOMETRY:"Odometry",VIZ_TYPE_PATH:"Path",VIZ_TYPE_POINT:"Point",VIZ_TYPE_POINTCLOUD:"PointCloud",VIZ_TYPE_POLYGON:"Polygon",VIZ_TYPE_POSE:"Pose",VIZ_TYPE_POSEARRAY:"PoseArray",VIZ_TYPE_RANGE:"Range",VIZ_TYPE_ROBOTMODEL:"RobotModel",VIZ_TYPE_TF:"Tf",VIZ_TYPE_WRENCH:"Wrench",POINT_FIELD_DATATYPES:Ze,COLLISION_OBJECT_OPERATIONS:Qe,SOLID_PRIMITIVE_TYPES:Ke,MARKER_OBJECT_TYPES:Je,LINE_STYLES:{LINES:"Lines",BILLBOARDS:"Billboards"},MAP_COLOR_SCHEMES:$e,LASERSCAN_STYLES:et,COLOR_TRANSFORMERS:tt,POINTCLOUD_COLOR_CHANNELS:ot,AXES:at,INTENSITY_CHANNEL_OPTIONS:rt,ODOMETRY_OBJECT_TYPES:it,POSE_OBJECT_TYPES:nt,WRENCH_OBJECT_TYPES:st,DEFAULT_CYLINDER_HEIGHT:lt,DEFAULT_CYLINDER_RADIUS:dt,DEFAULT_RADIAL_SEGMENTS:pt,DEFAULT_CONE_HEIGHT:ct,DEFAULT_CONE_RADIUS:mt,DEFAULT_COLOR_X_AXIS:ut,DEFAULT_COLOR_Y_AXIS:ht,DEFAULT_COLOR_Z_AXIS:gt,DEFAULT_COLOR_ARROW:yt,DEFAULT_COLOR_LINE:bt,DEFAULT_OPTIONS_SCENE:ft,DEFAULT_OPTIONS_TF_VIEWER:Et,DEFAULT_OPTIONS_ARROW:_t,DEFAULT_OPTIONS_AXES:Tt,DEFAULT_OPTIONS_FLATARROW:vt,DEFAULT_OPTIONS_DISPLAYTRAJECTORY:St,DEFAULT_OPTIONS_COLLISION_OBJECT:At,DEFAULT_OPTIONS_DEPTHCLOUD:Ct,DEFAULT_OPTIONS_IMAGE:Mt,DEFAULT_OPTIONS_IMAGE_STREAM:Rt,DEFAULT_OPTIONS_LASERSCAN:jt,DEFAULT_OPTIONS_MAP:Lt,DEFAULT_OPTIONS_MARKER:Nt,DEFAULT_OPTIONS_MARKERARRAY:xt,DEFAULT_OPTIONS_INTERACTIVE_MARKER:It,DEFAULT_OPTIONS_ODOMETRY:Dt,DEFAULT_OPTIONS_PATH:kt,DEFAULT_OPTIONS_PLANNINGSCENE:wt,DEFAULT_OPTIONS_POINTCLOUD:Ut,DEFAULT_OPTIONS_POINT:zt,DEFAULT_OPTIONS_POLYGON:Ft,DEFAULT_OPTIONS_POSE:Yt,DEFAULT_OPTIONS_TORUS:Vt,DEFAULT_OPTIONS_ARROW_WITH_CIRCLE:Gt,DEFAULT_OPTIONS_WRENCH:Ht,DEFAULT_OPTIONS_POSEARRAY:Bt,DEFAULT_OPTIONS_RANGE:Wt,DEFAULT_OPTIONS_ROBOTMODEL:Xt,DEFAULT_OPTIONS_TF:qt,SUPPORTED_MESSAGE_TYPES:[je,Le,Ne,xe,Ge,He,Be,We,ve,Se,Oe,Ae,Pe,Ce,Te,ke,we,le,me,ue,de,pe,me,ue,ne,ze,Fe,Ye,Ve],UNSUPPORTED_MESSAGE_TYPES:[se,be,Me,Re,Ee,_e,Xe,Ie,De,ce,Ue,he,ge,ye]}),Qt=function(e,t,o){var a=o.angleTolerance,r=o.positionTolerance,i=t.position,n=t.quaternion,s=e.position,l=e.quaternion,d=s.distanceTo(i)>r,p=l.angleTo(n)>a;return d||p},Kt=function(e,t){switch(t.type){case X:{var a=t.alpha,r=t.color,i=t.headLength,n=t.headRadius,s=t.shaftLength,l=t.shaftRadius;e.setHeadDimensions({radius:n,length:i}),e.setShaftDimensions({radius:l,length:s}),e.setAlpha(a),e.setColor({cone:new o.Color(r),cylinder:new o.Color(r)});break}case Z:{var d=t.axesLength,p=t.axesRadius;e.setLength(d),e.setRadius(p);break}case Q:{var c=t.arrowLength,m=t.color;e.setLength(c),e.setColor(new o.Color(m));break}case q:var u=t.alpha,h=t.circleConeLength,g=t.circleConeRadius,y=t.circleRadius,b=t.color,f=t.headLength,E=t.headRadius,_=t.shaftLength,T=t.shaftRadius,v=t.tube;e.setHeadDimensions({radius:E,length:f}),e.setShaftDimensions({radius:T,length:_}),e.setTorusDimensions({radius:y,tube:v}),e.setCircleConeDimensions({radius:g,length:h}),e.setAlpha(u),e.setColor({cone:new o.Color(b),cylinder:new o.Color(b),torus:new o.Color(b),circleCone:new o.Color(b)});}},Jt=function(){function e(e,t,o,a){void 0===a&&(a={});var r=a.onHeaderChange;this.options=a,this.ros=e,this.headerFrameId="",e&&t&&this.changeTopic(t,o,!1),this.onHeaderChange=r||function(){},this.update=this.update.bind(this)}return e.prototype.hide=function(){R(this.object),this.object.visible=!1},e.prototype.show=function(){R(this.object),this.object.visible=!0},e.prototype.destroy=function(){this.unsubscribe(),this.object&&this.object.parent&&(this.object.parent.remove(this.object),this.object=null)},e.prototype.reset=function(){},e.prototype.subscribe=function(){var e=this;this.dataSourceInstances&&this.dataSourceInstances.forEach(function(o){var t={next:e.update,error:function(e){return console.log(e)},complete:function(){return console.log("stream complete")}};o.addListener(t)})},e.prototype.unsubscribe=function(){this.dataSourceInstances&&this.dataSourceInstances.forEach(function(e){e.removeAllListeners()})},e.prototype.update=function(e){var t=e.header?e.header.frame_id:"";t!==this.headerFrameId&&(this.headerFrameId=t,this.onHeaderChange(this.headerFrameId))},e.prototype.updateOptions=function(e){this.options=B(B({},this.options),e)},e.prototype.changeTopic=function(e,t,o){var a=this;void 0===o&&(o=!0);var r=this.options,i=r.compression,n=r.queueSize,s=r.throttleRate;o&&this.unsubscribe(),this.topicName=e,this.messageType=t||this.messageType,this.dataSourceInstances=(Array.isArray(e)?e:[{name:e,messageType:t}]).map(function(e){var t=e.name,o=e.messageType;return new W({ros:a.ros,topicName:t,messageType:o,compression:i||"none",throttleRate:s||0,queueSize:n||10})}),o&&(this.reset(),this.subscribe())},e}(),$t=function(e,t){var a=t.translation,r=a.x,i=a.y,n=a.z,s=t.rotation,l=s.w,d=s.x,p=s.y,c=s.z;e.position.set(r,i,n),e.quaternion.copy(new o.Quaternion(d,p,c,l).normalize())},eo=function(e,t){var o=t.x,a=t.y,r=t.z;e.scale.set(o,a,r)},to=function(e,t){x(e.material),"string"==typeof t||"number"==typeof t?e.material.color=new o.Color(t):e.material.color.setRGB(t.r,t.g,t.b)},oo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t.prototype.setTransform=function(e){$t(this,e)},t.prototype.setScale=function(e){eo(this,e)},t.prototype.setColor=function(e){this.children.forEach(function(t){to(t,e)})},t}(o.Group),ao=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return S(t,e),t.prototype.setTransform=function(e){$t(this,e)},t.prototype.setScale=function(e){e&&eo(this,e)},t.prototype.setColor=function(e){e&&to(this,e)},t.prototype.setAlpha=function(e){if(Array.isArray(this.material))this.material.forEach(function(t){t.opacity=o.MathUtils.clamp(e,0,1)});else{debugger;this.material.opacity=o.MathUtils.clamp(e,0,1)}},t}(o.Mesh),ro=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.BoxGeometry,t.material=new o.MeshStandardMaterial,t}return S(t,e),t}(ao),io=function(e){function t(t,o,a){void 0===a&&(a=At);var r=e.call(this,null!==t&&void 0!==t?t:null,null!==o&&void 0!==o?o:null,fe,B(B({},At),a))||this;return r.object=new oo,r.updateOptions(B(B({},At),a)),r}return S(t,e),t.prototype.update=function(o){var a,r;e.prototype.update.call(this,o);var i=o.id,n=o.operation,s=o.primitive_poses,l=o.primitives,d=this.object.getObjectByName(i);switch(n){case Qe.ADD:{d&&(null===(a=d.parent)||void 0===a?void 0:a.remove(d));var p=new oo;p.name=i,l.forEach(function(e,o){var a=t.getNewPrimitive(e);null===a||void 0===a?void 0:a.setTransform({translation:s[o].position,rotation:s[o].orientation}),a&&p.add(a)}),this.object.add(p);break}case Qe.REMOVE:{d&&(null===(r=d.parent)||void 0===r?void 0:r.remove(d));break}case Qe.APPEND:{l.forEach(function(e,o){var a=t.getNewPrimitive(e);null===a||void 0===a?void 0:a.setTransform({translation:s[o].position,rotation:s[o].orientation}),a&&(null===d||void 0===d?void 0:d.add(a))});break}}},t.getNewPrimitive=function(e){var t=e.type,o=e.dimensions;switch(t){case Ke.BOX:var a=new ro,r=C(o,3),i=r[0],n=r[1],s=r[2];return a.setScale({x:i,y:n,z:s}),a;default:return null;}},t}(Jt),no=function(e){function t(t,a,r){void 0===r&&(r=St);var i=e.call(this,t,a,_e,r)||this;i.pointsUpdateIds=[],i.object=new oo,i.updateOptions(B(B({},St),r));var n=i.options.robot;return i.robotClone=n.clone(!0),Object.keys(i.robotClone.links).forEach(function(e){var t=i.robotClone.links[e];t.traverse(function(e){e.material&&(e.material=new o.MeshPhongMaterial({color:"#ff0000"}))})}),i}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),t.loop&&this.lastMessage?this.update(this.lastMessage,!0):this.resetLoopback()},t.prototype.resetLoopback=function(){clearTimeout(this.loopbackId),clearTimeout(this.poseRemovalId),this.pointsUpdateIds&&this.pointsUpdateIds.map(function(e){return clearTimeout(e)}),this.pointsUpdateIds=[],this.robotClone&&this.robotClone.parent&&this.robotClone.parent.remove(this.robotClone)},t.prototype.update=function(t,o){var a,r=this,i=this.options.loop;this.resetLoopback(),o||(this.lastMessage=t),e.prototype.update.call(this,t);var n=C(t.trajectory,1),s=n[0].joint_trajectory,l=s.joint_names,d=s.points,p=t.trajectory_start.joint_state,c=p.name,m=p.position;if(null===(a=this.object)||void 0===a?void 0:a.add(this.robotClone),c.forEach(function(e,t){var o=r.robotClone.getObjectByName(e);o&&o.setAngle(m[t])}),d.forEach(function(e){var t=e.positions,o=e.time_from_start,a=o.nsec,i=o.secs;r.pointsUpdateIds.push(window.setTimeout(function(){l.forEach(function(e,o){var a=r.robotClone.getObjectByName(e);a&&a.setAngle(t[o])})},1e3*i+a/1e6))}),0<d.length){var u=d[d.length-1].time_from_start,h=u.nsec,g=u.secs;this.poseRemovalId=window.setTimeout(function(){var e;null===(e=r.robotClone.parent)||void 0===e?void 0:e.remove(r.robotClone),i&&(r.loopbackId=window.setTimeout(function(){r.lastMessage&&r.update(r.lastMessage,!0)},1e3))},1e3*g+h/1e6)}},t}(Jt),so=function(e){function t(t,o,a){void 0===a&&(a=wt);var r=e.call(this,t,o,Te,B(B({},wt),a))||this;return r.collisionObjectViz=new io,r.attachedCollisionObjects=new Map,r.object=new oo,r.object.add(r.collisionObjectViz.object),r.updateOptions(B(B({},wt),a)),r}return S(t,e),t.prototype.update=function(t){var o,a,r=this;e.prototype.update.call(this,t);var i=t.robot_state,n=i.attached_collision_objects,s=void 0===n?[]:n,l=i.is_diff,d=i.joint_state,p=d.name,c=d.position,m=t.world.collision_objects;if(m.forEach(function(e){r.collisionObjectViz.update(e)}),s.length&&s.map(function(e){var t,o=e.link_name,a=e.object,i=new io,n=null===(t=r.object)||void 0===t?void 0:t.getObjectByName(o);R(n),i.object=n,i.update(a),r.attachedCollisionObjects.set(a.id,i)}),!l){var u=s.map(function(e){var t=e.object.id;return t});try{for(var h=P(this.attachedCollisionObjects.entries()),g=h.next();!g.done;g=h.next()){var y=C(g.value,2),b=y[0],f=y[1];-1===u.indexOf(b)&&(f.update({id:b,operation:Qe.REMOVE}),this.attachedCollisionObjects.delete(b))}}catch(e){o={error:e}}finally{try{g&&!g.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}}p.forEach(function(e,t){var o,a=null===(o=r.object)||void 0===o?void 0:o.getObjectByName(e);a&&a.setAngle(c[t])})},t}(Jt),lo=function(e){function t(t,a,r){void 0===t&&(t=yt),void 0===a&&(a=dt),void 0===r&&(r=lt);var i=e.call(this)||this;return i.geometry=new o.CylinderGeometry(a,a,r,pt),i.material=new o.MeshStandardMaterial({color:t}),i.material.transparent=!0,i.rotateX(v/2),i}return S(t,e),t}(ao),po=function(e){function t(t){void 0===t&&(t=ut);var a=e.call(this)||this;return a.geometry=new o.ConeGeometry(mt,ct,pt),a.material=new o.MeshStandardMaterial({color:t}),a.material.transparent=!0,a}return S(t,e),t}(ao),co=function(e){function t(){var t=e.call(this)||this;return t.cone=new po(ut),t.cylinder=new lo(ut),t.cone.rotateZ(-v/2),t.cylinder.rotateZ(-v/2),t.cone.setScale({x:mt,y:ct,z:mt}),t.cylinder.setScale({x:dt,y:lt,z:dt}),t.cylinder.translateY(t.cylinder.scale.y/2),t.cone.translateY(t.cylinder.scale.y+t.cone.scale.y/2),t.add(t.cone),t.add(t.cylinder),t}return S(t,e),t.prototype.setTransform=function(e){$t(this,e)},t.prototype.setColor=function(e){var t=e.cone,o=e.cylinder;t&&this.cone.setColor(t),o&&this.cylinder.setColor(o)},t.prototype.setHeadDimensions=function(e){var t=e.radius,o=e.length;if(t){var a=this.cone.scale.y;this.cone.setScale({x:t,y:a,z:t})}if(o){var r=this.cone.scale,i=r.x,n=r.z;this.cone.setScale({x:i,y:o,z:n}),this.cone.position.set(0,0,0),this.cone.translateY(this.cylinder.scale.y+o/2)}},t.prototype.setShaftDimensions=function(e){var t=e.radius,o=e.length;if(t){var a=this.cylinder.scale.y;this.cylinder.setScale({x:t,y:a,z:t})}if(o){var r=this.cylinder.scale,i=r.x,n=r.z;this.cylinder.setScale({x:i,y:o,z:n}),this.cylinder.position.set(0,0,0),this.cylinder.translateY(o/2),this.setHeadDimensions({length:this.cone.scale.y})}},t.prototype.setAlpha=function(e){this.cylinder.setAlpha(e),this.cone.setAlpha(e)},t.prototype.setScale=function(e){var t=e.x,o=C([t/2,t/2],2),a=o[0],r=o[1];eo(this,{x:t,y:a,z:r})},t}(o.Group),mo=function(e){function t(t,o){void 0===t&&(t=dt),void 0===o&&(o=lt);var a=e.call(this)||this;return a.objectType=Z,a.x=new lo(ut,t,o),a.y=new lo(ht,t,o),a.z=new lo(gt,t,o),a.x.translateX(o/2),a.y.translateZ(-o/2),a.z.translateY(o/2),a.x.rotateZ(-v/2),a.y.rotateX(v/2),a.add(a.x),a.add(a.y),a.add(a.z),a}return S(t,e),t.prototype.setLength=function(e){var t=+(""+e);[this.x,this.y,this.z].forEach(function(e){e.position.set(0,0,0),e.scale.setY(t)}),this.x.translateY(t/2),this.y.translateY(-t/2),this.z.translateY(t/2)},t.prototype.setRadius=function(e){var t=+(""+e);this.children.forEach(function(e){e.scale.setX(t),e.scale.setZ(t)})},t}(oo),uo=function(e){function t(t,a){void 0===t&&(t=bt),void 0===a&&(a=!1);var r=e.call(this)||this;r.geometry=new o.Geometry,r.geometry.vertices.push(new o.Vector3(0,0,0));var i={};return a||(i.vertexColors=o.VertexColors),r.material=new o.LineBasicMaterial(B({},i)),r.material.transparent=!0,r.setColor(t),r}return S(t,e),t.prototype.setColor=function(e){e&&to(this,e)},t.prototype.updatePoints=function(e,t){void 0===t&&(t=[]),this.geometry.vertices=e.map(function(e){var t=e.x,a=e.y,r=e.z;return new o.Vector3(t,a,r)}),this.geometry.verticesNeedUpdate=!0;var a=[];t.forEach(function(e){if("string"==typeof e||"number"==typeof e)a.push(new o.Color(e));else if(e){var t=e.r,r=e.g,i=e.b;a.push(new o.Color(t,r,i))}}),this.geometry.colors=a,this.geometry.colorsNeedUpdate=!0},t.prototype.setTransform=function(e){$t(this,e)},t.prototype.setAlpha=function(e){L(this.material),this.material.opacity=e},t}(o.Line),ho=function(e){function t(){var t=e.call(this)||this;return t.objectType=Q,t.arrowTop=new uo(16711680,!0),t.topPoints=[],t.arrowLength=new uo(16711680,!0),t.topPoints.push(new o.Vector3(2,1,0)),t.topPoints.push(new o.Vector3(3,0,0)),t.topPoints.push(new o.Vector3(2,-1,0)),t.arrowTop.updatePoints(t.topPoints),t.add(t.arrowTop),t.arrowLength.updatePoints([new o.Vector3(0,0,0),new o.Vector3(3,0,0)]),t.add(t.arrowLength),t.scale.set(.1,.1,.1),t}return S(t,e),t.prototype.setLength=function(e){this.scale.set(e,e,e)},t.prototype.setColor=function(e){var t=e.r,o=e.g,a=e.b;this.arrowTop.material.color.setRGB(t,o,a),this.arrowLength.material.color.setRGB(t,o,a)},t}(oo),go=function(){function e(e){var t,o=this;this.onHeaderChange=function(e){},this.headerFrameId="",this.hide=function(){R(o.object),D(o.object)?o.object.visible=!1:k(o.object)&&(o.object.style.visibility="hidden")},this.show=function(){R(o.object),D(o.object)?o.object.visible=!0:k(o.object)&&(o.object.style.visibility="visible")},this.destroy=function(){var e,t,a,r;o.unsubscribe(),D(o.object)?null===(t=null===(e=o.object)||void 0===e?void 0:e.parent)||void 0===t?void 0:t.remove(o.object):k(o.object)&&(null===(r=null===(a=o.object)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.removeChild(o.object)),o.object=void 0},this.reset=function(){},this.subscribe=function(){o.sources.forEach(function(e){var t={next:o.update,error:function(e){return console.log(e)},complete:function(){}};e.addListener(t)})},this.unsubscribe=function(){o.sources.forEach(function(e){e.removeAllListeners()})},this.sources=e.sources,this.options=null!==(t=e.options)&&void 0!==t?t:{},this.update=this.update.bind(this),this.updateOptions=this.updateOptions.bind(this)}return e.prototype.update=function(e){var t,o,a=null!==(o=null===(t=e.header)||void 0===t?void 0:t.frame_id)&&void 0!==o?o:"";a!==this.headerFrameId&&(this.headerFrameId=a,this.onHeaderChange(this.headerFrameId))},e.prototype.updateOptions=function(e){this.options=B(B({},this.options),e)},e.prototype.changeSources=function(e){this.unsubscribe(),this.sources=e,this.subscribe()},e}(),yo=function(e){function t(t,a){void 0===a&&(a=Yt);var r=e.call(this,{sources:[t],options:B(B({},Yt),a)})||this;return r.object=new o.Group,r.primitive=null,r.updateOptions(B(B({},Yt),a)),r}return S(t,e),t.getNewPrimitive=function(e){var t=e.type,o=null;return t===nt.arrow?o=new co:t===nt.axes?o=new mo:t===nt.flatArrow?o=new ho:void 0,o},t.prototype.updateOptions=function(o){var a,r,i;e.prototype.updateOptions.call(this,o);var n=this.options.type;if((null===(a=this.primitive)||void 0===a?void 0:a.type)!==n&&(null===(r=this.object)||void 0===r?void 0:r.remove(this.primitive),this.primitive=null),!this.primitive){var s=t.getNewPrimitive(this.options);s&&(this.primitive=s,null===(i=this.object)||void 0===i?void 0:i.add(this.primitive))}Kt(this.primitive,this.options)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.pose,r=a.orientation,i=a.position;null===(o=this.primitive)||void 0===o?void 0:o.setTransform({translation:i,rotation:r})},t}(go),bo=function(e){function t(){var t=e.call(this)||this;t.circleCone=new po(ut),t.material=new o.MeshStandardMaterial({color:t.cone.material.color}),t.add(t.circleCone),t.material.transparent=!0;var a=Vt,r=new o.TorusGeometry(a.circleRadius,a.tube,a.radialSegments,a.tubularSegments,a.arc);return t.torus=new ao(r,t.material),t.add(t.torus),t.circleCone.rotateX(r.parameters.arc),t.circleCone.translateZ(-T(-r.parameters.arc)*r.parameters.radius),t.circleCone.translateY(-_(-r.parameters.arc)*r.parameters.radius),t.circleCone.translateX(t.cylinder.scale.y/2),t.torus.translateX(t.cylinder.scale.y/2),t.torus.rotateY(v/2),t}return S(t,e),t.prototype.setTorusDimensions=function(e){var t=e.radius,a=e.tube,r=Vt;this.torus.geometry=new o.TorusGeometry(t,a,r.radialSegments,r.tubularSegments,r.arc),this.torus.position.set(0,0,0),this.torus.rotation.set(0,0,0),this.torus.translateX(this.cylinder.scale.y/2),this.torus.rotateY(v/2)},t.prototype.setCircleConeDimensions=function(e){var t=e.radius,o=e.length,a=+(""+t),r=+(""+o);if(w(this.torus.geometry),a){var i=this.circleCone.scale.y;this.circleCone.setScale({x:t,y:i,z:t})}if(r){var n=this.circleCone.scale,s=n.x,l=n.z;this.circleCone.setScale({x:s,y:r,z:l})}this.circleCone.position.set(0,0,0),this.circleCone.rotation.set(0,0,0),this.circleCone.translateX(this.cylinder.scale.y/2),this.circleCone.translateZ(-T(-this.torus.geometry.parameters.arc)*this.torus.geometry.parameters.radius),this.circleCone.translateY(-_(-this.torus.geometry.parameters.arc)*this.torus.geometry.parameters.radius),this.circleCone.rotateX(this.torus.geometry.parameters.arc)},t.prototype.setColor=function(e){var t=e.cone,o=e.cylinder,a=e.torus,r=e.circleCone;t&&this.cone.setColor(t),o&&this.cylinder.setColor(o),a&&to(this.torus,this.cone.material.color),r&&this.circleCone.setColor(r)},t.prototype.setAlpha=function(t){e.prototype.setAlpha.call(this,t),L(this.torus.material),this.torus.material.opacity=o.MathUtils.clamp(t,0,1),this.circleCone.setAlpha(t)},t}(co),fo=function(e){function t(t,a){void 0===a&&(a=Ht);var r=e.call(this,{sources:[t],options:B(B({},Ht),a)})||this;return r.primitiveX=null,r.primitiveY=null,r.object=new o.Group,r}return S(t,e),t.getNewPrimitive=function(e){var t=e.type,o=null;return t===st.arrow?o=new co:t===st.arrowWithCircle?o=new bo:void 0,o},t.prototype.getOrUpdatePrimitive=function(e,o){var a,r,i=null===e||(null===e||void 0===e?void 0:e.type)!==o;if(i){e&&(null===(a=this.object)||void 0===a?void 0:a.remove(e));var n=t.getNewPrimitive({type:o});return n&&(null===(r=this.object)||void 0===r?void 0:r.add(n)),n}return e},t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.primitiveX=this.getOrUpdatePrimitive(this.primitiveX,st.arrow),this.primitiveY=this.getOrUpdatePrimitive(this.primitiveY,st.arrowWithCircle);var o={color:this.options.forceColor,alpha:this.options.alpha,headLength:this.options.headLength*this.options.forceArrowScale,headRadius:this.options.headRadius*this.options.arrowWidth,shaftLength:this.options.shaftLength*this.options.forceArrowScale,shaftRadius:this.options.shaftRadius*this.options.arrowWidth,type:st.arrow},a={color:this.options.torqueColor,alpha:this.options.alpha,arc:this.options.arc,circleConeRadius:this.options.circleConeRadius*this.options.arrowWidth,circleConeLength:this.options.circleConeLength*this.options.arrowWidth,circleRadius:this.options.circleRadius*this.options.torqueArrowScale,headLength:this.options.headLength*this.options.torqueArrowScale,headRadius:this.options.headRadius*this.options.arrowWidth,shaftLength:this.options.shaftLength*this.options.torqueArrowScale,shaftRadius:this.options.shaftRadius*this.options.arrowWidth,tube:this.options.tube*this.options.arrowWidth,tubularSegments:this.options.tubularSegments,type:st.arrowWithCircle};Kt(this.primitiveX,o),Kt(this.primitiveY,a)},t.prototype.update=function(t){var a,r;e.prototype.update.call(this,t);var i=t.wrench,n=i.force,s=i.torque,l=new o.Vector3(1,0,0),d=new o.Vector3(n.x,n.y,n.z).normalize(),p=new o.Vector3(s.x,s.y,s.z).normalize(),c=new o.Quaternion().setFromUnitVectors(l,d),m=new o.Quaternion().setFromUnitVectors(l,p);null===(a=this.primitiveX)||void 0===a?void 0:a.setTransform({translation:{y:0,x:0,z:0},rotation:c}),null===(r=this.primitiveY)||void 0===r?void 0:r.setTransform({translation:{y:0,x:0,z:0},rotation:m})},t}(go),Eo=function(e){function t(t,o,a){void 0===a&&(a=Ft);var r=e.call(this,t,o,le,B(B({},Ft),a))||this;return r.object=new oo,r.line=new uo(null,!0),r.updateOptions(B(B({},Ft),a)),r}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t);var a=this.options,r=a.alpha,i=a.color;this.line.setColor(new o.Color(i)),this.line.setAlpha(r)},t.prototype.update=function(t){e.prototype.update.call(this,t);var o=t.polygon.points;o.push(o[0]),this.line.updatePoints(o),this.object.add(this.line)},t}(Jt),_o=function(e){function t(t){var a=e.call(this)||this;a.geometry=new o.Geometry,a.material=new o.Material;var r=new o.FontLoader;return a.material=new o.MeshBasicMaterial({color:14540253}),r.load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/fonts/helvetiker_regular.typeface.json",function(e){a.geometry=new o.TextGeometry(t,{font:e,size:.05,height:.005,curveSegments:12,bevelEnabled:!1,bevelThickness:10,bevelSize:8,bevelSegments:5})}),a.rotateX(v/2),a.rotateY(Math.PI),a}return S(t,e),t}(ao),To=function(e){function t(a){var r=e.call(this)||this;r.arrow=new co,r.add(new mo(.015,.25));var i=new _o(a);return i.rotateY(Math.PI).translateX(.03).translateY(.03),r.add(i),r.arrow.setHeadDimensions({length:.3*ct/2,radius:.1*mt/2}),r.arrow.setShaftDimensions({length:.85*lt,radius:.05*dt/6}),r.arrow.setColor({cone:new o.Color("#FF1493"),cylinder:new o.Color(yt)}),r.add(r.arrow),r.name=t.getName(a),r}return S(t,e),t.getName=function(e){return"tf-"+e},t}(oo),vo=function(e){function t(t,a){void 0===a&&(a=qt);var r=e.call(this,{sources:[t],options:B(B({},qt),a)})||this;return r.object=new o.Group,r.object.name="tf-tree",r}return S(t,e),t.prototype.update=function(e){var t,a=this,r=e.transforms;r.forEach(function(e){var t=e.header.frame_id,r=e.child_frame_id,i=e.transform,n=C([a.getFrameOrCreate(r),a.getFrameOrCreate(t)],2),s=n[0],l=n[1];if(l.add(s),s.setTransform(i),.1>s.position.length())s.arrow.visible=!1;else{s.arrow.lookAt(l.getWorldPosition(new o.Vector3)),s.arrow.rotateY(-v/2),s.arrow.visible=!0;var d=s.arrow.cone.scale.y;s.arrow.setShaftDimensions({length:s.position.length()-d})}}),null===(t=this.object)||void 0===t?void 0:t.children.forEach(function(e){e.arrow.visible=!1})},t.prototype.getFrameOrCreate=function(e){var t,o,a=null===(t=this.object)||void 0===t?void 0:t.getObjectByName(To.getName(e));if(a)return a;var r=new To(e);return null===(o=this.object)||void 0===o?void 0:o.add(r),r},t}(go),u="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis,h=Y(function(e,t){(function(t,o){e.exports=o(G,a,r,i)})(u,function(e,t,o,a){function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var o,a=0;a<t.length;a++)o=t[a],o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}function s(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function c(e,t){return c=Object.setPrototypeOf||function o(e,t){return e.__proto__=t,e},c(e,t)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return t&&("object"==typeof t||"function"==typeof t)?t:m(e)}function h(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=d(e),null!==e););return e}function g(e,t,o){return g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function a(e,t,o){var r=h(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(o):i.value}},g(e,t,o||e)}function y(e,t){return T(e)||O(e,t)||P()}function f(e){return _(e)||S(e)||A()}function _(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function T(e){if(Array.isArray(e))return e}function S(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function O(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var o=[],a=!0,r=!1,i=void 0;try{for(var n,s=e[Symbol.iterator]();!(a=(n=s.next()).done)&&(o.push(n.value),!(t&&o.length===t));a=!0);}catch(e){r=!0,i=e}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw i}}return o}}function A(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function P(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function C(){for(var e,t=Object.getPrototypeOf(this),o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];var i=(e=t.clone).call.apply(e,[this].concat(a));return i.isURDFCollider=!0,i}function M(e){e.isURDFCollider=!0,e.clone=C}function R(e){return e?e.trim().split(/\s+/g).map(function(e){return parseFloat(e)}):[0,0,0]}function j(e,t){var o=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2];o||e.rotation.set(0,0,0),D.set(t[0],t[1],t[2],"ZYX"),I.setFromEuler(D),I.multiply(e.quaternion),e.quaternion.copy(I)}var L=function(e){function t(){var e,o;i(this,t);for(var a=arguments.length,r=Array(a),n=0;n<a;n++)r[n]=arguments[n];return o=u(this,(e=d(t)).call.apply(e,[this].concat(r))),o.isURDFLink=!0,o.type="URDFLink",o.urdfNode=null,o}return l(t,e),s(t,[{key:"show",value:function e(){this.visible=!0}},{key:"hide",value:function e(){this.visible=!1}},{key:"delete",value:function e(){var t=this;this.parent.remove(this),this.children.map(function(e){t.remove(e)})}},{key:"copy",value:function a(e,o){return g(d(t.prototype),"copy",this).call(this,e,o),this.urdfNode=e.urdfNode,this}}]),t}(e.Object3D),N=function(t){function o(){var e,t;i(this,o);for(var a=arguments.length,r=Array(a),n=0;n<a;n++)r[n]=arguments[n];return t=u(this,(e=d(o)).call.apply(e,[this].concat(r))),t.isURDFJoint=!0,t.type="URDFJoint",t.urdfNode=null,t.jointValue=null,t.jointType="fixed",t.axis=null,t.limit={lower:0,upper:0},t.ignoreLimits=!1,t.origPosition=null,t.origQuaternion=null,t}return l(o,t),s(o,[{key:"jointType",get:function e(){return this._jointType},set:function t(e){this.jointType!==e&&(this._jointType=e,"fixed"===e||"continuous"===e||"revolute"===e||"prismatic"===e?this.jointValue=0:"planar"===e?this.jointValue=[,,].fill(0):"floating"===e?this.jointValue=[,,,,,,].fill(0):void 0)}},{key:"angle",get:function e(){return this.jointValue}}]),s(o,[{key:"copy",value:function a(e,t){return g(d(o.prototype),"copy",this).call(this,e,t),this.urdfNode=e.urdfNode,this.jointType=e.jointType,this.axis=e.axis?e.axis.clone():null,this.limit.lower=e.limit.lower,this.limit.upper=e.limit.upper,this.ignoreLimits=!1,this.jointValue=Array.isArray(e.jointValue)?f(e.jointValue):e.jointValue,this.origPosition=e.origPosition?e.origPosition.clone():null,this.origQuaternion=e.origQuaternion?e.origQuaternion.clone():null,this}},{key:"setAngle",value:function e(){return this.setOffset.apply(this,arguments)}},{key:"setOffset",value:function t(){for(var o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];switch(a=a.map(function(e){return parseFloat(e)}),this.origPosition&&this.origQuaternion||(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone()),this.jointType){case"fixed":break;case"continuous":case"revolute":{var i=a[0];if(null==i)break;if(i===this.jointValue)break;this.ignoreLimits||"revolute"!==this.jointType||(i=E(this.limit.upper,i),i=b(this.limit.lower,i));var n=new e.Quaternion().setFromAxisAngle(this.axis,i);this.quaternion.multiplyQuaternions(this.origQuaternion,n),this.jointValue=i,this.matrixWorldNeedsUpdate=!0;break}case"prismatic":{var s=a[0];if(null==s)break;if(s===this.jointValue)break;this.ignoreLimits||(s=E(this.limit.upper,s),s=b(this.limit.lower,s)),this.position.copy(this.origPosition),this.position.addScaledVector(this.axis,s),this.jointValue=s,this.worldMatrixNeedsUpdate=!0;break}case"floating":case"planar":console.warn("'".concat(this.jointType,"' joint not yet supported"));}return this.jointValue}}]),o}(e.Object3D),x=function(e){function t(){var e,o;i(this,t);for(var a=arguments.length,r=Array(a),n=0;n<a;n++)r[n]=arguments[n];return o=u(this,(e=d(t)).call.apply(e,[this].concat(r))),o.isURDFRobot=!0,o.urdfNode=null,o.urdfRobotNode=null,o.robotName=null,o.links=null,o.joints=null,o}return l(t,e),s(t,[{key:"copy",value:function a(e,o){var r=this;return g(d(t.prototype),"copy",this).call(this,e,o),this.urdfRobotNode=e.urdfRobotNode,this.robotName=e.robotName,this.links={},this.joints={},this.traverse(function(t){t.isURDFJoint&&t.name in e.joints&&(r.joints[t.name]=t),t.isURDFLink&&t.name in e.links&&(r.links[t.name]=t)}),this}},{key:"setAngle",value:function t(e){var o=this.joints[e];if(o){for(var a=arguments.length,r=Array(1<a?a-1:0),i=1;i<a;i++)r[i-1]=arguments[i];return o.setAngle.apply(o,r)}return null}},{key:"setAngles",value:function t(e){for(var o in e)this.setAngle(o,e[o])}}]),t}(L),I=new e.Quaternion,D=new e.Euler,k=function(){function n(t){var o=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];i(this,n),this.manager=t||e.DefaultLoadingManager,this.allowMeshBVH=o,this.retryMap={}}return s(n,[{key:"load",value:function n(t,o,a,r,i){var s,l=this,d=this.manager,p=e.LoaderUtils.extractUrlBase(t),c=this.manager.resolveURL(t),m={},u=function e(){},h=function e(){},g=function e(){};d.onError&&(u=d.onProgress.bind(d)),d.onProgress&&(h=d.onProgress.bind(d)),d.onLoad&&(g=d.onLoad.bind(d));var y=this;d.onError=function(e){m[e]="Error in loading resource",r&&r({url:e,retry:y.retryMap[e]}),u(e)},d.onProgress=function(e,t,o){a&&a(e,t,o),h(e,t,o)},d.onLoad=function(){if(o){var e=0===Object.keys(m).length?void 0:m;o(s,e)}g()},i=Object.assign({workingPath:p},i),d.itemStart(c),fetch(c,i.fetchOptions).then(function(e){return e.text()}).then(function(e){s=l.parse(e,i),window.model=s,d.itemEnd(c)})["catch"](function(t){console.error("URDFLoader: Error parsing file.",t),d.itemError(c),d.itemEnd(c)})}},{key:"parse",value:function o(t){function i(e){if(!/^package:\/\//.test(e))return b?b+e:e;var t=e.replace(/^package:\/\//,"").split(/\/(.+)/),o=y(t,2),a=o[0],i=o[1];return"string"==typeof h?h.endsWith(a)?h+"/"+i:h+"/"+a+"/"+i:"object"===r(h)?a in h?h[a]+"/"+i:(console.error("URDFLoader : ".concat(a," not found in provided package list.")),null):void 0}function n(e){var t=this,o=f(e.children),a=o.filter(function(e){return"link"===e.nodeName.toLowerCase()}),r=o.filter(function(e){return"joint"===e.nodeName.toLowerCase()}),i=o.filter(function(e){return"material"===e.nodeName.toLowerCase()}),n=new x;return n.robotName=e.getAttribute("name"),n.urdfRobotNode=e,i.forEach(function(e){var o=e.getAttribute("name");A[o]=p.call(t,e)}),a.forEach(function(o){var a=o.getAttribute("name"),r=null===e.querySelector("child[link=\"".concat(a,"\"]"));S[a]=d.call(t,o,r?n:null)}),r.forEach(function(e){var o=e.getAttribute("name");O[o]=s.call(t,e)}),n.joints=O,n.links=S,n}function s(t){var o=f(t.children),a=t.getAttribute("type"),r=new N;r.urdfNode=t,r.name=t.getAttribute("name"),r.jointType=a;var i=null,s=null,l=[0,0,0],d=[0,0,0];o.forEach(function(e){var t=e.nodeName.toLowerCase();"origin"===t?(l=R(e.getAttribute("xyz")),d=R(e.getAttribute("rpy"))):"child"===t?s=S[e.getAttribute("link")]:"parent"===t?i=S[e.getAttribute("link")]:"limit"===t&&(r.limit.lower=parseFloat(e.getAttribute("lower")||r.limit.lower),r.limit.upper=parseFloat(e.getAttribute("upper")||r.limit.upper))}),i.add(r),r.add(s),j(r,d),r.position.set(l[0],l[1],l[2]);var p=o.filter(function(e){return"axis"===e.nodeName.toLowerCase()})[0];if(p){var c=p.getAttribute("xyz").split(/\s+/g).map(function(e){return parseFloat(e)});r.axis=new e.Vector3(c[0],c[1],c[2]),r.axis.normalize()}return r}function d(e){var t=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===o&&(o=new L);var a=f(e.children);if(o.name=e.getAttribute("name"),o.urdfNode=e,E){var r=a.filter(function(e){return"visual"===e.nodeName.toLowerCase()});r.forEach(function(e){return c.call(t,e,o,A)})}if(_){var i=a.filter(function(e){return"collision"===e.nodeName.toLowerCase()});i.forEach(function(e){return c.call(t,e,o)})}return o}function p(t){var o=this,a=f(t.children),r=new e.MeshPhongMaterial;return r.name=t.getAttribute("name")||"",a.forEach(function(t){var a=t.nodeName.toLowerCase();if("color"===a){var n=t.getAttribute("rgba").split(/\s/g).map(function(e){return parseFloat(e)});r.color.setRGB(n[0],n[1],n[2]),r.opacity=n[3],r.transparent=1>n[3]}else if("texture"===a){var s=new e.TextureLoader(T),l=t.getAttribute("filename"),d=i(l),p=function e(){o.retryMap[d]=function(){return s.load(d,function(){return null},function(){return null},e)}};r.map=s.load(d,function(){return null},function(){return null},p)}}),r}function c(t,o){var r=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},s="collision"===t.nodeName.toLowerCase(),l=[0,0,0],d=[0,0,0],c=[1,1,1],m=f(t.children),u=null,h=null,y=m.filter(function(e){return"material"===e.nodeName.toLowerCase()})[0];if(y){var b=y.getAttribute("name");u=b&&b in n?n[b]:p.call(this,y)}else u=new e.MeshPhongMaterial;m.forEach(function(t){var n=t.nodeName.toLowerCase();if("geometry"===n){var p=t.children[0].nodeName.toLowerCase();if("mesh"===p){var m=t.children[0].getAttribute("filename"),y=i(m);if(null!==y){var b=t.children[0].getAttribute("scale");b&&(c=R(b));var f=function n(t,i){i?(console.error("URDFLoader: Error loading mesh.",i),r.retryMap[y]=function(){return g(y,T,n)}):t&&(t instanceof e.Mesh&&(t.material=u,r.allowMeshBVH&&(t.raycast=a.acceleratedRaycast,t.geometry.boundsTree=new a.MeshBVH(t.geometry))),o.add(t),t.position.set(l[0],l[1],l[2]),t.rotation.set(0,0,0),t.scale.x*=c[0],t.scale.y*=c[1],t.scale.z*=c[2],j(t,d),s&&M(t))};g(y,T,f)}}else if("box"===p){h=new e.Mesh,h.geometry=new e.BoxBufferGeometry(1,1,1),h.material=u,r.allowMeshBVH&&(h.raycast=a.acceleratedRaycast,h.geometry.boundsTree=new a.MeshBVH(h.geometry));var E=R(t.children[0].getAttribute("size"));o.add(h),h.scale.set(E[0],E[1],E[2]),s&&M(h)}else if("sphere"===p){h=new e.Mesh,h.geometry=new e.SphereBufferGeometry(1,30,30),h.material=u,r.allowMeshBVH&&(h.raycast=a.acceleratedRaycast,h.geometry.boundsTree=new a.MeshBVH(h.geometry));var _=parseFloat(t.children[0].getAttribute("radius"))||0;h.scale.set(_,_,_),o.add(h),s&&M(h)}else if("cylinder"===p){h=new e.Mesh,h.geometry=new e.CylinderBufferGeometry(1,1,1,30),h.material=u,r.allowMeshBVH&&(h.raycast=a.acceleratedRaycast,h.geometry.boundsTree=new a.MeshBVH(h.geometry));var S=parseFloat(t.children[0].getAttribute("radius"))||0,O=parseFloat(t.children[0].getAttribute("length"))||0;h.scale.set(S,O,S),h.rotation.set(v/2,0,0),o.add(h),s&&M(h)}}else"origin"===n&&(l=R(t.getAttribute("xyz")),d=R(t.getAttribute("rpy")))}),h&&(j(h,d,!0),h.position.set(l[0],l[1],l[2]))}var m=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},h=u.packages||"",g=u.loadMeshCb||this.defaultMeshLoader.bind(this),b=u.workingPath||"",E=!("parseVisual"in u)||u.parseVisual,_=u.parseCollision||!1,T=this.manager,S={},O={},A={},P=function t(e){var o=new DOMParser,a=o.parseFromString(e,"text/xml"),r=f(a.children),i=r.filter(function(e){return"robot"===e.nodeName}).pop();return n.call(m,i)};return P(t)}},{key:"defaultMeshLoader",value:function n(a,r,i){if(/\.stl(?:\?|$)/i.test(a)){var s=new t.STLLoader(r);s.load(a,function(t){var o=new e.Mesh(t,new e.MeshPhongMaterial());i(o)})}else if(/\.dae(?:\?|$)/i.test(a)){var l=new o.ColladaLoader(r);l.load(a,function(e){return i(e.scene)})}else console.warn("URDFLoader: Could not load model at ".concat(a,".\nNo loader available"))}}]),n}();return k})}),f=function t(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}(h),So=function(e){function t(t,a,r){void 0===r&&(r=Xt);var i=e.call(this,o.DefaultLoadingManager)||this;return i.packages={},i.hide=function(){var e,t;R(i.object),Object.values(null!==(t=null===(e=i.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.hide()})},i.show=function(){var e,t;R(i.object),Object.values(null!==(t=null===(e=i.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.show()})},i.destroy=function(){var e,t,o,a;Object.values(null!==(t=null===(e=i.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.delete()}),null===(a=null===(o=i.object)||void 0===o?void 0:o.parent)||void 0===a?void 0:a.remove(i.object),i.object=void 0},i.reset=function(){},i.options=r,i.packages=r.packages,i.param=new V.Param({ros:t,name:a}),i.updateOptions=i.updateOptions.bind(i),i.getPackages=i.getPackages.bind(i),i.defaultLoadMeshCallback=i.defaultLoadMeshCallback.bind(i),i.onComplete=i.onComplete.bind(i),i.loadURDF=i.loadURDF.bind(i),i.loadFromParam=i.loadFromParam.bind(i),i}return S(t,e),t.prototype.onComplete=function(e){},t.prototype.loadFromParam=function(e,t){var o=this;void 0===e&&(e=this.onComplete),void 0===t&&(t={}),this.param.get(function(a){o.loadURDF(a,e,t)})},t.prototype.loadURDF=function(t,o,a){void 0===o&&(o=this.onComplete);var r=e.prototype.parse.call(this,t,B({packages:a.packages||this.packages,loadMeshCb:a.loadMeshCb||this.defaultLoadMeshCallback,fetchOptions:{mode:"cors",credentials:"same-origin"}},a));R(this.object),this.urdfObject=r,this.object.add(r),this.object.name=r.robotName,o(this.object)},t.prototype.defaultLoadMeshCallback=function(t,o,a){e.prototype.defaultMeshLoader.call(this,t,o,function(e){a(e)})},t.prototype.getPackages=function(e){this.param.get(function(t){var o=new DOMParser,a=o.parseFromString(t,"text/xml"),r=M(Array.from(a.querySelectorAll("mesh"))).map(function(e){var t,o=C(null===(t=null===e||void 0===e?void 0:e.getAttribute("filename"))||void 0===t?void 0:t.replace(/^package:\/\//,"").split(/\/(.+)/),1),a=o[0];return a});e(M(new Set(r)))})},t.prototype.updateOptions=function(e){this.options=B(B({},this.options),e)},t}(f),Oo=function(e){function t(t,o,a){void 0===a&&(a=Xt);var r=e.call(this,t,o,a)||this;return r.object=new oo,r.updateOptions(B(B({},Xt),a)),r}return S(t,e),t}(So),Ao=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.SphereGeometry(1,pt,pt),t.material=new o.MeshStandardMaterial,t.material.transparent=!0,t}return S(t,e),t}(ao),Po=function(e){function t(t,o){void 0===o&&(o=zt);var a=e.call(this,{sources:[t],options:B(B({},zt),o)})||this,r=a.options,i=r.alpha,n=r.color,s=r.radius;return a.object=new oo,a.sphere=new Ao,a.object.add(a.sphere),a.sphere.setColor(n),a.sphere.setAlpha(i),a.sphere.setScale({x:s,y:s,z:s}),a}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.point,r=a.x,i=a.y,n=a.z;null===(o=this.object)||void 0===o?void 0:o.position.set(r,i,n)},t}(go);window.WebAssembly||import("pcl-decoder").then(e=>{Ro.attachDecoder(e)});var Co=function(e,t){switch(t){case Ze.INT8:return e.getInt8;case Ze.UINT8:return e.getUint8;case Ze.INT16:return e.getInt16;case Ze.UINT16:return e.getUint16;case Ze.INT32:return e.getInt32;case Ze.UINT32:return e.getUint32;case Ze.FLOAT64:return e.getFloat64;case Ze.FLOAT32:default:return e.getFloat32;}},Mo=function(e,t,o,a){var r=e.attributes[t];F(r),r.updateRange={offset:0,count:3*a},r.count=a,r.array=o,r.needsUpdate=!0},Ro=function(){function e(){}return e.decode=function(e,t,a){var r=e.height*e.width,n=new Float32Array(3*r),s=new Float32Array(3*r),l=new Float32Array(3*r),d=Uint8Array.from(e.data).buffer,p=new DataView(d),c={},m={},u=new o.Color;e.fields.forEach(function(e){c[e.name]=e.offset,m[e.name]=Co(p,e.datatype)});for(var h,g=0;g<r;g++){if(h=g*e.point_step,void 0!==c.x&&void 0!==c.y&&void 0!==c.z&&(n[3*g]=m.x.call(p,h+c.x,!e.is_bigendian),n[3*g+1]=m.y.call(p,h+c.y,!e.is_bigendian),n[3*g+2]=m.z.call(p,h+c.z,!e.is_bigendian)),void 0!==c.rgb&&t===ot.RGB&&(s[3*g]=p.getUint8(h+c.rgb+2)/255,s[3*g+1]=p.getUint8(h+c.rgb+1)/255,s[3*g+2]=p.getUint8(h+c.rgb)/255),void 0!==c.intensity&&t===ot.INTENSITY){var y=m.intensity.call(p,h+c.intensity,!e.is_bigendian),b=E(y,360)/360;if(a){var f=u.setHSL(b,1,.5).toArray().map(function(e){return 255*e});s[3*g]=f[0]/255,s[3*g+1]=f[1]/255,s[3*g+2]=f[2]/255}else s[3*g]=b/360,s[3*g+1]=b/360,s[3*g+2]=b/360}void 0!==c.normal_x&&void 0!==c.normal_y&&void 0!==c.normal_z&&(l[3*g]=m.normal_x.call(p,h+c.normal_x,!e.is_bigendian),l[3*g+1]=m.normal_y.call(p,h+c.normal_y,!e.is_bigendian),l[3*g+2]=m.normal_z.call(p,h+c.normal_z,!e.is_bigendian))}return{positions:n,colors:s,normals:l}},e.attachDecoder=function(t){var o=t.get_memory,a=t.PCLDecoder,r=new a,i=o();e.decode=function(e,t,o){var a=e.height*e.width,n={},s=new Float32Array(3*a);e.fields.forEach(function(e){n[e.name]=e.offset});var l=new Uint8Array(i.buffer),d=r.get_copy_memory_ptr();l.set(e.data,d),r.compute(a,e.point_step,n.x,n.y,n.z,n.rgb||0,n.intensity||0,t===ot.INTENSITY,o);var p=r.get_position_memory_ptr(),c=r.get_color_memory_ptr(),m=new Float32Array(i.buffer,p,3*a),u=t===ot.INTENSITY&&!n.intensity||t===ot.RGB&&!n.rgb,h=u?new Float32Array(3*a):new Float32Array(i.buffer,c,3*a);return{positions:m,colors:h,normals:s}}},e}(),jo=function(e,t){if(void 0===t&&(t=Ut),!e)return{positions:new Float32Array(0),colors:new Float32Array(0),normals:new Float32Array(0)};var o=t.colorChannel,a=t.useRainbow,r=Ro.decode(e,o,a),i=r.colors,n=r.normals,s=r.positions;return{positions:s,colors:i,normals:n}},Lo=function(e){function t(t,a){void 0===a&&(a=Ut);var r=e.call(this,{sources:[t],options:B(B({},Ut),a)})||this;r.update=function(t){e.prototype.update.call(r,t);var o=jo(t,r.options),a=o.colors,i=o.normals,n=o.positions;r.updatePointCloudGeometry(n,a,i)};var i=new o.PointsMaterial({size:r.options.size,color:o.VertexColors}),n=new o.BufferGeometry;return n.setAttribute("position",new o.BufferAttribute(new Float32Array(3*K),3).setUsage(o.DynamicDrawUsage)),n.setAttribute("color",new o.BufferAttribute(new Float32Array(3*K),3).setUsage(o.DynamicDrawUsage)),n.setAttribute("normal",new o.BufferAttribute(new Float32Array(3*K),3).setUsage(o.DynamicDrawUsage)),n.setDrawRange(0,0),n.computeBoundingSphere(),r.object=new o.Points(n,i),r.object.frustumCulled=!1,r.updateOptions(B(B({},Ut),a)),r}return S(t,e),t.prototype.updatePointCloudGeometry=function(e,t,o){var a=Number.isNaN;R(this.object);var r=this.object,i=r.geometry,n=r.material;n.size===this.options.size||a(this.options.size)||(n.size=this.options.size,n.needsUpdate=!0);var s=E(K,y(e.length/3));z(i),i.setDrawRange(0,s),Mo(i,"position",e,s),Mo(i,"color",t,s),Mo(i,"normal",o,s)},t}(go),No=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.BoxGeometry,t.material=new o.MeshStandardMaterial,t}return S(t,e),t}(ao),xo=function(e){function t(t,a){void 0===a&&(a=5);var r=e.call(this)||this;return r.geometry=new o.Geometry,r.material=new o.LineBasicMaterial({linewidth:a,color:o.VertexColors}),r}return S(t,e),t.prototype.isValid=function(e){return e.length<=this.geometry.vertices.length},t.prototype.setColor=function(e){to(this,e)},t.prototype.updatePoints=function(e,t){this.geometry.vertices=e.map(function(e){var t=e.x,a=e.y,r=e.z;return new o.Vector3(t,a,r)}),this.geometry.verticesNeedUpdate=!0,0<t.length&&(this.geometry.colors=t.map(function(e){var t=e.r,a=e.g,r=e.b;return new o.Color(t,a,r)}),this.geometry.colorsNeedUpdate=!0)},t.prototype.setTransform=function(e){$t(this,e)},t}(o.LineSegments),Io=function(){function e(e,t){this.objectPool=e,this.Primitive=t}return e.prototype.setObjectDimension=function(e,t,o,a){var r=t.x,i=t.y,n=t.z;e.setColor(o),e.setScale(a),e.position.set(r,i,n)},e.prototype.reusePool=function(e,t,o){for(var a,r=o.scale,n=e.length,s=0;s<n;s++)a=this.objectPool.children[s],this.setObjectDimension(a,e[s],t[s],r);for(var s=n;s<this.objectPool.children.length;s++)this.objectPool.children[s].visible=!1},e.prototype.increasePool=function(e,t,o){for(var a,r=this.objectPool.children.length,n=o.scale,s=0;s<r;s++)a=this.objectPool.children[s],this.setObjectDimension(a,e[s],t[s],n);for(var s=r;s<e.length;s++){var l=new this.Primitive,d=e[s],p=d.x,c=d.y,m=d.z;l.setColor(t[s]),l.setScale(n),l.position.set(p,c,m),this.objectPool.add(l)}},e}(),Do=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.Geometry,t.material=new o.MeshBasicMaterial,t.objectCacher=new Io(t,Ao),t}return S(t,e),t.prototype.updatePoints=function(e,t,o){var a=B(B({},o),{subtype:Je.SPHERE});e.length<this.children.length?this.objectCacher.reusePool(e,t,a):this.objectCacher.increasePool(e,t,a)},t}(ao),ko=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.Geometry,t.material=new o.PointsMaterial({color:o.VertexColors}),t}return S(t,e),t.prototype.setTransform=function(e){$t(this,e)},t.prototype.updatePoints=function(e,t,a){var r=a.scale.x;this.material.size=r,this.geometry.vertices=e.map(function(e){return new o.Vector3(e.x,e.y,e.z)}),this.geometry.verticesNeedUpdate=!0,0<t.length&&(this.geometry.colors=t.map(function(e){return new o.Color(e.r,e.g,e.b)}),this.geometry.colorsNeedUpdate=!0)},t.prototype.setScale=function(e){this.material.size="number"==typeof e?e:e.x},t}(o.Points),wo=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.Geometry,t.material=new o.MeshBasicMaterial({color:o.FaceColors}),t.material.side=o.DoubleSide,t}return S(t,e),t.prototype.updatePoints=function(e,t,a){void 0===t&&(t=[]);var r=[],i=[],n=a.scale,s=n.x,d=n.y,p=n.z;this.scale.set(s,d,p);for(var c,m=0,u=e.length/3;m<u;m++){c=[e[3*m],e[3*m+1],e[3*m+2]],c.map(function(e){r.push(new o.Vector3(e.x,e.y,e.z))});var l=0===t.length?{r:1,g:0,b:0}:t[3*m];i.push(new o.Face3(3*m,3*m+2,3*m+1,new o.Vector3(),new o.Color(l.r,l.g,l.b)))}this.geometry.vertices=r,this.geometry.faces=i,this.geometry.computeFaceNormals(),this.geometry.computeVertexNormals(),this.geometry.elementsNeedUpdate=!0,this.geometry.verticesNeedUpdate=!0},t}(ao),Uo=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.Geometry,t.material=new o.MeshBasicMaterial,t.objectCacher=new Io(t,No),t}return S(t,e),t.prototype.updatePoints=function(e,t,o){var a=B(B({},o),{subType:Je.CUBE});e.length<this.children.length?this.objectCacher.reusePool(e,t,a):this.objectCacher.increasePool(e,t,a)},t}(ao),zo=function(e){function t(t){var a=e.call(this)||this;return a.color=new o.Color(1,1,1),a.text=new n(t,1,"#"+a.color.getHexString()),a.add(a.text),a}return S(t,e),t.prototype.setColor=function(e){var t=e.b,a=e.g,i=e.r;this.color.r===i&&this.color.g===a&&this.color.b===t||(this.color=new o.Color(i,a,t),this.text.color="#"+this.color.getHexString())},t}(ao),Fo=function(e){switch(e.type){case Je.CUBE:return new No;case Je.SPHERE:return new Ao;case Je.CYLINDER:{var t=new oo;return t.add(new lo),t}case Je.LINE_LIST:return new xo;case Je.LINE_STRIP:return new uo;case Je.SPHERE_LIST:return new Do;case Je.POINTS:return new ko;case Je.TRIANGLE_LIST:return new wo;case Je.CUBE_LIST:return new Uo;case Je.TEXT_VIEW_FACING:return new zo(e.text);case Je.ARROW:default:{var o=new co;return o.setHeadDimensions({radius:.1*mt,length:.3*ct}),o.setShaftDimensions({radius:.05*dt,length:.7*lt}),o}}},Yo=function(){function e(e){this.timeouts={},this.timeouts={},this.onTimeout=e}return e.prototype.track=function(e,t){var o=this;clearInterval(this.timeouts[e]),0===t||(this.timeouts[e]=window.setTimeout(function(){o.onTimeout(e)},1e3*t))},e.prototype.untrack=function(e){clearInterval(this.timeouts[e]),delete this.timeouts[e]},e.prototype.destroy=function(){var e,t,o=Object.keys(this.timeouts);try{for(var a,r=P(o),i=r.next();!i.done;i=r.next())a=i.value,clearInterval(this.timeouts[a]),delete this.timeouts[a]}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e}(),Vo=function(){function e(e,t){this.objectMap={},this.namespaces={},this.object=e,this.onChangeCb=t,this.markerLifetime=new Yo(this.onMarkerLifetimeOver.bind(this))}return e.prototype.onMarkerLifetimeOver=function(e){var t=this.objectMap[e];t&&this.removeObject(e)},e.prototype.getMarkerOrCreate=function(t){var o=e.getId(t);if(!this.objectMap[o]){var a=Fo(t);this.objectMap[o]=a,this.object.add(a)}else this.objectMap[o]instanceof xo&&!this.objectMap[o].isValid(t.points)&&(this.removeObject(o),this.objectMap[o]=Fo(t),this.object.add(this.objectMap[o]));return this.objectMap[o].visible=this.namespaces[t.ns],this.objectMap[o]},e.prototype.extractNameSpace=function(e){var t=e.split("-");return t[0]},e.prototype.updateOptions=function(e){var t=e.namespaces;for(var o in this.namespaces=t,this.objectMap)if(this.objectMap.hasOwnProperty(o)){var a=this.extractNameSpace(o);this.objectMap[o].visible=this.namespaces[a]}},e.prototype.onChange=function(){this.onChangeCb()},e.prototype.updateMarker=function(t){var o=t.color,a=t.colors,r=t.lifetime,i=t.points,n=t.pose,s=n.orientation,l=n.position,d=t.scale,p=this.getMarkerOrCreate(t),c=e.getId(t);this.markerLifetime.track(c,r.secs),p.updatePoints&&p.updatePoints(i,a,t),p.setTransform({translation:l,rotation:s}),p.setScale&&!p.updatePoints&&p.setScale({x:d.x,y:d.y,z:d.z}),p.setColor&&0>=a.length&&p.setColor(o);var m=t.ns;m in this.namespaces||(this.namespaces[m]=!0,this.onChange())},e.prototype.removeObject=function(e){var t,o=this.objectMap[e];null===(t=o.parent)||void 0===t?void 0:t.remove(o),delete this.objectMap[e]},e.prototype.reset=function(){var e=this;this.namespaces={},this.markerLifetime.destroy(),this.onChange(),Object.keys(this.objectMap).forEach(function(t){e.removeObject(t)})},e.getId=function(e){var t=e.ns,o=e.id;return t+"-"+o},e}(),Go=function(e){function t(t,o){void 0===o&&(o=xt);var a,r=e.call(this,{sources:[t],options:B(B({},xt),o)})||this;return r.reset=function(){r.markerManager.reset()},r.object=new oo,r.markerManager=new Vo(r.object,null!==(a=r.onNameSpaceChange)&&void 0!==a?a:function(){return null}),r}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.markerManager.updateOptions(this.options)},t.prototype.update=function(t){var o=this;e.prototype.update.call(this,t),t.markers.forEach(function(e){o.markerManager.updateMarker(e)})},t}(go),Ho=function(){function e(e){void 0===e&&(e={}),this.maxPts=e.max_pts||1e4,this.rootObject=e.rootObject||new o.Object3D}return e.prototype.setup=function(e,t,a){var r=this;this.rootObject.children.forEach(function(e){r.rootObject.remove(e)}),this.positions=new o.BufferAttribute(new Float32Array(3*this.maxPts),3,!1),this.colors=new o.BufferAttribute(new Float32Array(3*this.maxPts),3,!1);var i={};if(e===et.POINTS){var n=new o.TextureLoader().load("https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/circle.png");i={map:n,alphaTest:.5}}this.geometry=new o.BufferGeometry,this.geometry.setAttribute("position",this.positions.setUsage(o.DynamicDrawUsage)),this.geometry.setAttribute("color",this.colors.setUsage(o.DynamicDrawUsage)),this.material=new o.PointsMaterial(B({color:8947848,size:t},i)),this.material.transparent=!0,this.material.opacity=a,this.object=new o.Points(this.geometry,this.material),this.rootObject.add(this.object)},e.prototype.update=function(e){R(this.geometry),R(this.positions),R(this.colors),this.geometry.setDrawRange(0,e),this.positions.needsUpdate=!0,this.colors.needsUpdate=!0,this.positions.updateRange.count=e*this.positions.itemSize,this.colors.updateRange.count=e*this.colors.itemSize},e.prototype.setAlpha=function(e){R(this.material),this.material.opacity=e},e.prototype.setSize=function(e){R(this.material),this.material.size=e},e}(),Bo=function(e){function t(t,o){void 0===o&&(o=jt);var a=e.call(this,{sources:[t],options:B(B({},jt),o)})||this;return a.cachedMessage=null,a.points=new Ho,a.sphereList=new Do,a.cubeList=new Uo,a.object=new oo,a.object.add(a.points.rootObject),a.object.add(a.sphereList),a.object.add(a.cubeList),a}return S(t,e),t.prototype.getNormalizedIntensity=function(e){var t=this.options,o=t.maxIntensity,a=t.minIntensity;return(e-a)/(o-a)},t.prototype.applyIntensityTransform=function(e,t){var a,r=this.options,i=r.channelName,n=r.maxColor,s=r.minColor,l=t.x,d=t.y,p=t.z;i===rt.INTENSITY?a=this.getNormalizedIntensity(e):i===rt.X?a=this.getNormalizedIntensity(l):i===rt.Y?a=this.getNormalizedIntensity(d):i===rt.Z?a=this.getNormalizedIntensity(p):void 0;var c=new o.Color(s),m=new o.Color(n);R(a);var u=a*m.getHex()+(1-a)*c.getHex();return new o.Color(u)},t.prototype.getNormalizedAxisValue=function(e){var t=this.options,o=t.maxAxisValue,a=t.minAxisValue;return(e-a)/(o-a)},t.prototype.applyAxisColorTransform=function(e,t){var a,r=this.options,i=r.axis,n=r.maxAxisValue,s=r.minAxisValue,l=t.x,d=t.y,p=t.z;i===at.X?a=this.getNormalizedAxisValue(l):i===at.Y?a=this.getNormalizedAxisValue(d):i===at.Z?a=this.getNormalizedAxisValue(p):void 0,R(a);var c=a*n+(1-a)*s;return new o.Color(c)},t.prototype.colorTransformer=function(e,t){var a=this.options,r=a.colorTransformer,i=a.flatColor;return r===tt.INTENSITY?this.applyIntensityTransform(e,t):r===tt.AXIS_COLOR?this.applyAxisColorTransform(e,t):r===tt.FLAT_COLOR?new o.Color(i):null},t.prototype.setupPoints=function(e,t,o){R(o),R(this.points.colors),R(this.points.positions),I(this.points.colors.array),I(this.points.positions.array),this.points.colors.array[e]=o.r,this.points.positions.array[e++]=t.x,this.points.colors.array[e]=o.g,this.points.positions.array[e++]=t.y,this.points.colors.array[e]=o.b,this.points.positions.array[e++]=t.z},t.prototype.hideAllObjects=function(){this.points.rootObject.visible=!1,this.sphereList.visible=!1,this.cubeList.visible=!1},t.prototype.setStyleDimensions=function(e){var t=this.options,o=t.alpha,a=t.style,r=this.options.size,s=e.intensities,l=e.ranges,d=l.length,n=[],p=[];if(!(.001>r)&&r){this.hideAllObjects(),this.points.setup(a,r,o);for(var c,m=0,u=0;u<d;u++)if(c=e.ranges[u],c>=e.range_min&&c<=e.range_max){var h=e.angle_min+u*e.angle_increment,g={x:c*T(h),y:c*_(h),z:0},y=this.colorTransformer(s[u],g);switch(a){case et.POINTS:case et.SQUARES:case et.FLAT_SQUARES:{this.setupPoints(m,g,y),m+=3;break}default:n.push(g),p.push(y);}}var b={scale:{x:r,y:r,z:r}};switch(a){case et.SPHERES:{this.sphereList.visible=!0,this.sphereList.updatePoints(n,p,b);break}case et.BOXES:{this.cubeList.visible=!0,this.cubeList.updatePoints(n,p,b);break}default:this.points.rootObject.visible=!0,this.points.update(m/3);}}},t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.cachedMessage&&this.setStyleDimensions(this.cachedMessage)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.setStyleDimensions(t),this.cachedMessage=t},t}(go),Wo=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=new DataView(Uint8Array.from([l]).buffer).getUint8(0),p=4*(n+r*t);if(0<=d&&100>=d){var c=255-255*d/100;e.data[p]=c,e.data[++p]=c,e.data[++p]=c,e.data[++p]=255}else 101<=d&&127>=d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=0,e.data[++p]=255):128<=d&&254>=d?(e.data[p]=255,e.data[++p]=255*(d-128)/126,e.data[++p]=0,e.data[++p]=255):(e.data[p]=112,e.data[++p]=137,e.data[++p]=134,e.data[++p]=255)}},Xo=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=4*(n+r*t),p=new DataView(Uint8Array.from([l]).buffer),c=p.getUint8(0);e.data[d]=c,e.data[++d]=c,e.data[++d]=c,e.data[++d]=255}},qo=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=new DataView(Uint8Array.from([l]).buffer).getUint8(0),p=4*(n+r*t);if(0===d)e.data[p]=0,e.data[++p]=0,e.data[++p]=0,e.data[++p]=0;else if(1<=d&&98>=d){var c=255*d/100;e.data[p]=c,e.data[++p]=0,e.data[++p]=255-c,e.data[++p]=255}else 99===d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=255,e.data[++p]=255):100===d?(e.data[p]=255,e.data[++p]=0,e.data[++p]=255,e.data[++p]=255):100<d&&127>=d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=0,e.data[++p]=255):128<=d&&254>=d?(e.data[p]=255,e.data[++p]=255*(d-128)/126,e.data[++p]=0,e.data[++p]=255):(e.data[p]=112,e.data[++p]=137,e.data[++p]=134,e.data[++p]=255)}},Zo=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var o=t.getContext("2d");return null===o||void 0===o?void 0:o.putImageData(e,0,0),t},Qo=function(e,t,o,a){for(var r=e.data,n=e.height,s=e.step,l=Uint8Array.from(r),d=new DataView(l.buffer),p=0,c=0;c<s*n;c+=t){for(var m=0;m<o.length;m++)a.data[p++]=d.getUint8(c+o[m]);3===o.length&&(a.data[p++]=255)}},Ko=function(e){function t(){var t=e.call(this)||this;return t.geometry=new o.PlaneGeometry,t.material=new o.MeshBasicMaterial,t}return S(t,e),t}(ao),Jo=function(e){function t(t,o){void 0===o&&(o=Lt);var a=e.call(this,{sources:[t],options:B(B({},Lt),o)})||this;return a.cachedMessage=null,a.object=new Ko,j(a.object),L(a.object.material),a.object.material.transparent=!0,a.updateOptions(B(B({},Lt),o)),a}return S(t,e),t.prototype.updateOptions=function(t){j(this.object),L(this.object.material),e.prototype.updateOptions.call(this,t);var a=this.options,r=a.alpha,i=a.drawBehind;this.object.material.opacity=r,this.object.material.side=i?o.DoubleSide:o.FrontSide,this.object.material.needsUpdate=!0,this.cachedMessage&&this.setCanvasData(this.cachedMessage)},t.prototype.updateCanvasDimensions=function(e){var t,a,r,i=e.info,n=i.height,s=i.origin,l=s.orientation,d=l.w,p=l.x,c=l.y,m=l.z,u=s.position,h=u.x,g=u.y,y=u.z,b=i.resolution,f=i.width;null===(t=this.object)||void 0===t?void 0:t.scale.set(f*b,-1*n*b,1);var E=f*b/2+h,_=n*b/2+g;null===(a=this.object)||void 0===a?void 0:a.position.set(E,_,y||.01),null===(r=this.object)||void 0===r?void 0:r.quaternion.copy(new o.Quaternion(p,c,m,d).normalize())},t.prototype.setCanvasData=function(e){var t=this.options.colorScheme,a=e.data,r=e.info,i=r.height,n=r.width,s=new ImageData(n,i),l=null;t===$e.MAP?(Wo(s,n,i,a),l=Zo(s)):t===$e.CONST_MAP?(qo(s,n,i,a),l=Zo(s)):t===$e.RAW?(Xo(s,n,i,a),l=Zo(s)):void 0,j(this.object),N(this.object.material),l&&(this.object.material.map=new o.CanvasTexture(l),this.object.material.map.minFilter=o.NearestFilter,this.object.material.map.magFilter=o.NearestFilter,this.object.material.needsUpdate=!0),this.updateCanvasDimensions(e)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.setCanvasData(t),this.cachedMessage=t},t}(go),$o=function(e){function t(t,o){void 0===o&&(o=Dt);var a=e.call(this,{sources:[t],options:B(B({},Dt),o)})||this;return a.objectPool=[],a.keepSize=100,a.currentObjectIndex=-1,a.object=new oo,a}return S(t,e),t.prototype.setKeepSize=function(e){var t,o=[];if(0===e)return void(this.keepSize=0);if(e<this.keepSize&&e<this.objectPool.length){for(var a=this.objectPool.length-e,r=0;r<a;r++)null===(t=this.object)||void 0===t?void 0:t.remove(this.objectPool[r]);var n=this.objectPool.slice(this.objectPool.length-e,this.objectPool.length);o=M(n)}else o=M(this.objectPool);this.objectPool=o,this.keepSize=e,this.currentObjectIndex=this.objectPool.length-1},t.prototype.removeAllObjects=function(){var e=this;this.objectPool.forEach(function(t,o){var a;null===(a=t.parent)||void 0===a?void 0:a.remove(t),delete e.objectPool[o]}),this.objectPool=[]},t.prototype.checkToleranceThresholdExceed=function(e){if(0===this.objectPool.length)return!0;var t={position:this.objectPool[this.currentObjectIndex].position,quaternion:this.objectPool[this.currentObjectIndex].quaternion};return Qt(t,e,this.options)},t.prototype.getObject=function(){var e=this.options.type;return e===it.arrow?new co:e===it.axes?new mo:new o.Object3D},t.prototype.changeObjectPoolType=function(){var e=this,t=[];this.objectPool.forEach(function(o,a){var r,i,n=o.position,s=o.quaternion;null===(r=o.parent)||void 0===r?void 0:r.remove(o),delete e.objectPool[a];var l=e.getObject();l.position.set(n.x,n.y,n.z),l.quaternion.set(s.x,s.y,s.z,s.w),t.push(l),null===(i=e.object)||void 0===i?void 0:i.add(l),Kt(l,e.options)}),this.objectPool=t},t.prototype.updateOptions=function(t){var o=this,a=this.options.type;e.prototype.updateOptions.call(this,t);var r=this.options,i=r.keep,n=r.type;n!==a&&this.changeObjectPoolType(),this.objectPool.forEach(function(e){Kt(e,o.options)}),this.setKeepSize(i)},t.prototype.update=function(t){var a,r;if(e.prototype.update.call(this,t),!this.keepSize)return void this.removeAllObjects();var i=t.pose.pose,n=i.orientation,s=i.position,l={translation:s,rotation:n},d={position:new o.Vector3(s.x,s.y,s.z),quaternion:new o.Quaternion(n.x,n.y,n.z,n.w)},p=this.checkToleranceThresholdExceed(d);if(p){var c=this.getObject();if(Kt(c,this.options),this.objectPool.push(c),this.currentObjectIndex+=1,this.currentObjectIndex=o.MathUtils.clamp(this.currentObjectIndex,0,this.keepSize-1),null===(a=this.object)||void 0===a?void 0:a.add(c),$t(c,l),this.objectPool.length>this.keepSize){var m=this.objectPool[0];null===(r=this.object)||void 0===r?void 0:r.remove(m),delete this.objectPool[0];var u=this.objectPool.slice(1);this.objectPool=M(u)}}},t}(go),ea=function(e){function t(t,a){void 0===a&&(a=Bt);var r=e.call(this,{sources:[t],options:B(B({},Bt),a)})||this;return r.object=new o.Group,r}return S(t,e),t.prototype.update=function(t){R(this.object),e.prototype.update.call(this,t),this.object.children.forEach(function(e){var t;null===(t=e.parent)||void 0===t?void 0:t.remove(e)}),this.object.children=[];for(var o,a=0;a<t.poses.length;a++)o=yo.getNewPrimitive(this.options),o&&($t(o,{translation:t.poses[a].position,rotation:t.poses[a].orientation}),Kt(o,this.options),this.object.add(o))},t}(go),ta=function(e){function t(t,a){void 0===a&&(a=kt);var r=e.call(this,{sources:[t],options:B(B({},kt),a)})||this,i=r.options,n=i.alpha,s=i.color;return r.object=new oo,r.line=new uo(null,!0),r.line.setColor(new o.Color(s)),r.line.setAlpha(n),r}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t);var a=this.options,r=a.alpha,i=a.color;this.line.setColor(new o.Color(i)),this.line.setAlpha(r)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.poses,r=(a||[]).map(function(e){return e.pose.position});this.line.updatePoints(r),null===(o=this.object)||void 0===o?void 0:o.add(this.line)},t}(go),oa=function(e){function t(t,o){void 0===o&&(o=Mt);var a=e.call(this,{sources:[t],options:B(B({},Mt),o)})||this;a.hide=function(){R(a.object),a.object.style.visibility="hidden"},a.show=function(){R(a.object),a.object.style.visibility="visible"};var r=a.options,i=r.height,n=r.width;return a.object=document.createElement("canvas"),a.shadowObject=document.createElement("canvas"),a.object.width=n,a.object.height=i,a}return S(t,e),t.prototype.applyImageData=function(e){var t=e.encoding,o=e.height,a=e.width;R(this.object);var r=this.object.getContext("2d");R(r);var i=this.shadowObject.getContext("2d");R(i);var n=i.createImageData(a,o),s=a/o;switch(t){case"bayer_rggb8":case"bayer_bggr8":case"bayer_gbrg8":case"bayer_grbg8":case"bayer_rggb16":case"bayer_bggr16":case"bayer_gbrg16":case"bayer_grbg16":case"8UC1":case"8SC1":case"mono8":{Qo(e,1,[0,0,0],n);break}case"8UC3":case"8SC3":case"bgr8":{Qo(e,3,[2,1,0],n);break}case"8UC4":case"8SC4":case"bgra8":{Qo(e,4,[2,1,0,3],n);break}case"rgb8":{Qo(e,3,[0,1,2],n);break}case"rgba8":{Qo(e,4,[0,1,2,3],n);break}}r.clearRect(0,0,this.object.width,this.object.height),r.fillStyle="#000",r.fillRect(0,0,this.object.width,this.object.height),i.clearRect(0,0,this.shadowObject.width,this.shadowObject.height),i.putImageData(n,0,0);var l=this.object.width/s,d=this.object.height*s;s>=this.object.width/this.object.height?r.drawImage(this.shadowObject,0,0,a,o,0,(this.object.height-l)/2,this.object.width,l):r.drawImage(this.shadowObject,0,0,a,o,(this.object.width-d)/2,0,d,this.object.height)},t.prototype.updateDimensions=function(e,t){R(this.object),this.object.width=e,this.object.height=t},t.prototype.update=function(e){var t=e.height,o=e.width;this.shadowObject.width=o,this.shadowObject.height=t,this.applyImageData(e)},t}(go),aa=function(){function e(e){var t,o=this;this.hide=function(){R(o.object),D(o.object)?o.object.visible=!1:k(o.object)&&(o.object.style.visibility="hidden")},this.show=function(){R(o.object),D(o.object)?o.object.visible=!0:k(o.object)&&(o.object.style.visibility="visible")},this.destroy=function(){var e,t,a,r;D(o.object)?null===(t=null===(e=o.object)||void 0===e?void 0:e.parent)||void 0===t?void 0:t.remove(o.object):k(o.object)&&(null===(r=null===(a=o.object)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.removeChild(o.object)),o.object=void 0},this.reset=function(){},this.options=null!==(t=e.options)&&void 0!==t?t:{},this.updateOptions=this.updateOptions.bind(this)}return e.prototype.updateOptions=function(e){this.options=B(B({},this.options),e)},e}(),ra=function(e){function t(t,o){void 0===o&&(o=Rt);var a=e.call(this,{options:B(B({},Rt),o)})||this;a.hide=function(){R(a.object),a.object.style.visibility="hidden"},a.show=function(){R(a.object),a.object.style.visibility="visible"};var r=a.options,i=r.height,n=r.width;return a.url=t,a.object=document.createElement("img"),a.object.src=a.url,a.object.setAttribute("draggable","false"),a.object.width=n,a.object.height=i,a}return S(t,e),t}(aa),ia=function(e){function t(t,o){void 0===o&&(o=Nt);var a,r=e.call(this,{sources:[t],options:B(B({},Nt),o)})||this;return r.reset=function(){r.markerManager.reset()},r.object=new oo,r.markerManager=new Vo(r.object,null!==(a=r.onNameSpaceChange)&&void 0!==a?a:function(){return null}),r.updateOptions(B(B({},Nt),o)),r}return S(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.markerManager.updateOptions(this.options)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.markerManager.updateMarker(t)},t}(go),na=function(e){function t(t,a){void 0===a&&(a=Wt);var r=e.call(this,{sources:[t],options:B(B({},Wt),a)})||this,i=r.options,n=i.alpha,s=i.color;return r.object=new oo,r.cylinder=new lo(r.options.color,.01,.01),r.cylinder.rotateZ(v/2),r.object.add(r.cylinder),r.cylinder.setAlpha(n),r.cylinder.setColor(new o.Color(s)),r}return S(t,e),t.prototype.update=function(t){var a=Math.tan;e.prototype.update.call(this,t);var r=t.field_of_view,i=t.max_range,n=t.min_range;this.cylinder.geometry=new o.CylinderGeometry(n*a(r)/4,i*a(r)/4,i-n,pt,pt),this.cylinder.geometry.verticesNeedUpdate=!0,this.cylinder.position.setX(.5*(n+i))},t}(go),sa=Y(function(o,a){!function(a,e){o.exports=e()}(u,function(){var s=function(){function p(t){return u.appendChild(t.dom),t}function c(o){for(var e=0;e<u.children.length;e++)u.children[e].style.display=e===o?"block":"none";m=o}var m=0,u=document.createElement("div");u.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",u.addEventListener("click",function(t){t.preventDefault(),c(++m%u.children.length)},!1);var l=(performance||Date).now(),h=l,g=0,y=p(new s.Panel("FPS","#0ff","#002")),b=p(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var r=p(new s.Panel("MB","#f08","#201"));return c(0),{REVISION:16,dom:u,addPanel:p,showPanel:c,begin:function(){l=(performance||Date).now()},end:function(){g++;var o=(performance||Date).now();if(b.update(o-l,200),h+1e3<=o&&(y.update(1e3*g/(o-h),100),h=o,g=0,r)){var e=performance.memory;r.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return o},update:function(){l=this.end()},domElement:u,setMode:c}};return s.Panel=function(_,n,l){var i=1/0,T=0,S=g,f=S(window.devicePixelRatio||1),r=80*f,t=48*f,d=3*f,c=2*f,p=3*f,u=15*f,s=74*f,m=30*f,h=document.createElement("canvas");h.width=r,h.height=t,h.style.cssText="width:80px;height:48px";var y=h.getContext("2d");return y.font="bold "+9*f+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=l,y.fillRect(0,0,r,t),y.fillStyle=n,y.fillText(_,d,c),y.fillRect(p,u,s,m),y.fillStyle=l,y.globalAlpha=.9,y.fillRect(p,u,s,m),{dom:h,update:function(o,e){i=E(i,o),T=b(T,o),y.fillStyle=l,y.globalAlpha=1,y.fillRect(0,0,r,u),y.fillStyle=n,y.fillText(S(o)+" "+_+" ("+S(i)+"-"+S(T)+")",d,c),y.drawImage(h,p+f,u,s-f,m,p,u,s-f,m),y.fillRect(p+s-f,u,f,m),y.fillStyle=l,y.globalAlpha=.9,y.fillRect(p+s-f,u,f,S((1-o/e)*m))}}},s})}),la=function(e){function t(t){void 0===t&&(t=ft);var a=e.call(this)||this;return a.options=ft,a.vizWrapper=new o.Group,a.add(a.vizWrapper),a.stats=new sa,a.stats.showPanel(0),a.initLights(),a.initGrid(),a.updateOptions(t),a}return S(t,e),t.prototype.initLights=function(){var e=this;[[-1,0],[1,0],[0,-1],[0,1]].forEach(function(t){var a,r=new o.DirectionalLight(16777215,.4);a=C(t,2),r.position.x=a[0],r.position.y=a[1],r.position.z=1,e.add(r)});var t=new o.AmbientLight(16777215,.2);this.add(t)},t.prototype.initGrid=function(){this.grid=new o.GridHelper(0,0),this.add(this.grid)},t.prototype.addObject=function(e){this.vizWrapper.add(e)},t.prototype.addVisualization=function(e){var t=e.object;t&&(this.vizWrapper.getObjectById(t.id)||this.addObject(t))},t.prototype.getObjectByName=function(e){return this.vizWrapper.getObjectByName(e)},t.prototype.updateOptions=function(e){var t,a;void 0===e&&(e=ft),this.options=B(B({},ft),e);var r=this.options,i=r.backgroundColor,n=r.gridCenterlineColor,s=r.gridColor,l=r.gridDivisions,d=r.gridSize;null===(t=this.grid)||void 0===t?void 0:t.copy(new o.GridHelper(d,l,n,s)),null===(a=this.grid)||void 0===a?void 0:a.rotateX(-v/2),this.background=new o.Color(i)},t}(o.Scene),da=function(e){function t(t,o){void 0===o&&(o=Ct);var a=e.call(this)||this;return a.options=Ct,a.metaLoaded=!1,a.options=B(B({},Ct),o),a.url=t,a.animate=a.animate.bind(a),a.onMetaLoaded=a.onMetaLoaded.bind(a),a}return S(t,e),t.prototype.onMetaLoaded=function(){this.metaLoaded=!0,this.initStreamer()},t.prototype.isMjpeg=function(){var e=this.options.streamType;return"mjpeg"===e.toLowerCase()},t.prototype.initVideo=function(){var e=this.options,t=e.height,o=e.width;this.video=document.createElement(this.isMjpeg()?"img":"video"),this.video.width=o,this.video.height=t,this.video.addEventListener(this.isMjpeg()?"load":"loadedmetadata",this.onMetaLoaded,!1),this.isMjpeg()||(U(this.video),this.video.loop=!0),this.video.src=this.url,this.video.crossOrigin="Anonymous",this.video.setAttribute("crossorigin","Anonymous")},t.prototype.initStreamer=function(){var e=this.options,t=e.f,a=e.height,r=e.maxDepthPerTile,n=e.pointSize,s=e.varianceThreshold,d=e.whiteness,p=e.width,c=b(p,a)/1024;if(this.metaLoaded){this.texture=new o.Texture(this.video),this.geometry=new o.Geometry;for(var m=p/2,u=a/2,h=0,g=m*u;h<g;h+=1)this.geometry.vertices.push(new o.Vector3(h%m,h/m,0));this.material=new o.ShaderMaterial({uniforms:{map:{value:this.texture},width:{value:m},height:{value:u},focallength:{value:t},pointSize:{value:n},zOffset:{value:0},whiteness:{value:d},varianceThreshold:{value:s},maxDepthPerTile:{value:r},resolutionFactor:{value:c}},vertexShader:"uniform sampler2D map;\n\nuniform float width;\nuniform float height;\nuniform float nearClipping, farClipping;\n\nuniform float pointSize;\nuniform float zOffset;\n\nuniform float focallength;\nuniform float maxDepthPerTile;\nuniform float resolutionFactor;\n\nvarying vec2 vUvP;\nvarying vec2 colorP;\n\nvarying float depthVariance;\nvarying float maskVal;\n\nfloat sampleDepth(vec2 pos)\n  {\n    float depth;\n\n    vec2 vUv = vec2( pos.x / (width*2.0), pos.y / (height*2.0)+0.5 );\n    vec2 vUv2 = vec2( pos.x / (width*2.0)+0.5, pos.y / (height*2.0)+0.5 );\n\n    vec4 depthColor = texture2D( map, vUv );\n\n    depth = ( depthColor.r + depthColor.g + depthColor.b ) / 3.0 ;\n\n    if (depth>0.99)\n    {\n      vec4 depthColor2 = texture2D( map, vUv2 );\n      float depth2 = ( depthColor2.r + depthColor2.g + depthColor2.b ) / 3.0 ;\n      depth = 0.99+depth2;\n    }\n\n    return depth;\n  }\n\nfloat median(float a, float b, float c)\n  {\n    float r=a;\n\n    if ( (a<b) && (b<c) )\n    {\n      r = b;\n    }\n    if ( (a<c) && (c<b) )\n    {\n      r = c;\n    }\n    return r;\n  }\n\nfloat variance(float d1, float d2, float d3, float d4, float d5, float d6, float d7, float d8, float d9)\n  {\n    float mean = (d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9) / 9.0;\n    float t1 = (d1-mean);\n    float t2 = (d2-mean);\n    float t3 = (d3-mean);\n    float t4 = (d4-mean);\n    float t5 = (d5-mean);\n    float t6 = (d6-mean);\n    float t7 = (d7-mean);\n    float t8 = (d8-mean);\n    float t9 = (d9-mean);\n    float v = (t1*t1+t2*t2+t3*t3+t4*t4+t5*t5+t6*t6+t7*t7+t8*t8+t9*t9)/9.0;\n    return v;\n  }\n\nvec2 decodeDepth(vec2 pos)\n  {\n    vec2 ret;\n\n\n    float depth1 = sampleDepth(vec2(position.x-1.0, position.y-1.0));\n    float depth2 = sampleDepth(vec2(position.x, position.y-1.0));\n    float depth3 = sampleDepth(vec2(position.x+1.0, position.y-1.0));\n    float depth4 = sampleDepth(vec2(position.x-1.0, position.y));\n    float depth5 = sampleDepth(vec2(position.x, position.y));\n    float depth6 = sampleDepth(vec2(position.x+1.0, position.y));\n    float depth7 = sampleDepth(vec2(position.x-1.0, position.y+1.0));\n    float depth8 = sampleDepth(vec2(position.x, position.y+1.0));\n    float depth9 = sampleDepth(vec2(position.x+1.0, position.y+1.0));\n\n    float median1 = median(depth1, depth2, depth3);\n    float median2 = median(depth4, depth5, depth6);\n    float median3 = median(depth7, depth8, depth9);\n\n    ret.x = median(median1, median2, median3);\n    ret.y = variance(depth1, depth2, depth3, depth4, depth5, depth6, depth7, depth8, depth9);\n\n    return ret;\n\n  }\n\n\nvoid main() {\n\n  vUvP = vec2( position.x / (width*2.0), position.y / (height*2.0)+0.5 );\n  colorP = vec2( position.x / (width*2.0)+0.5 , position.y / (height*2.0)  );\n\n  vec4 pos = vec4(0.0,0.0,0.0,0.0);\n  depthVariance = 0.0;\n\n  if ( (vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>0.0))\n  {\n    vec2 smp = decodeDepth(vec2(position.x, position.y));\n    float depth = smp.x;\n    depthVariance = smp.y;\n\n    float z = -depth;\n\n    pos = vec4(\n      ( position.x / width - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength) * -1.0,\n      ( position.y / height - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength),\n      (- z + zOffset / 1000.0) * maxDepthPerTile,\n      1.0);\n\n    vec2 maskP = vec2( position.x / (width*2.0), position.y / (height*2.0)  );\n    vec4 maskColor = texture2D( map, maskP );\n    maskVal = ( maskColor.r + maskColor.g + maskColor.b ) / 3.0 ;\n  }\n\n  gl_PointSize = pointSize;\n  gl_Position = projectionMatrix * modelViewMatrix * pos;\n\n}",fragmentShader:"uniform sampler2D map;\nuniform float varianceThreshold;\nuniform float whiteness;\n\nvarying vec2 vUvP;\nvarying vec2 colorP;\n\nvarying float depthVariance;\nvarying float maskVal;\n\n\nvoid main() {\n\n  vec4 color;\n\n  if ( (depthVariance>varianceThreshold) || (maskVal>0.5) ||(vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>1.0))\n  {\n    discard;\n  }\n  else\n  {\n    color = texture2D( map, colorP );\n\n    float fader = whiteness /100.0;\n\n    color.r = color.r * (1.0-fader)+ fader;\n\n    color.g = color.g * (1.0-fader)+ fader;\n\n    color.b = color.b * (1.0-fader)+ fader;\n\n    color.a = 1.0;//smoothstep( 20000.0, -20000.0, gl_FragCoord.z / gl_FragCoord.w );\n  }\n\n  gl_FragColor = vec4( color.r, color.g, color.b, color.a );\n\n}"}),this.mesh=new o.Points(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.position.set(0,0,0),this.add(this.mesh),requestAnimationFrame(this.animate)}},t.prototype.animate=function(){var e;this.texture&&(this.isMjpeg()?this.texture.needsUpdate=!0:(U(this.video),this.video.readyState===this.video.HAVE_ENOUGH_DATA&&(this.texture.needsUpdate=!0)),(null===(e=this.video)||void 0===e?void 0:e.src)&&requestAnimationFrame(this.animate))},t.prototype.startStream=function(){this.isMjpeg()||(U(this.video),this.video.play())},t.prototype.stopStream=function(){var e;this.isMjpeg()||(U(this.video),this.video.pause()),null===(e=this.video)||void 0===e?void 0:e.removeAttribute("src")},t}(o.Object3D),pa=function(e){function t(t,o){void 0===o&&(o=Ct);var a=e.call(this,{sources:[],options:B(B({},Ct),o)})||this;return a.subscribe=function(){var e,t;null===(e=a.object)||void 0===e?void 0:e.initVideo(),null===(t=a.object)||void 0===t?void 0:t.startStream()},a.unsubscribe=function(){var e;null===(e=a.object)||void 0===e?void 0:e.stopStream()},a.url=t,a.object=new da(t,o),a}return S(t,e),t}(go),ca=function(e,t){function a(e){if(!1!==p.enabled){f.set(e.clientX,e.clientY);var t=f.x-E.x,o=f.y-E.y;g===h.ROTATE?p.rotate(m.set(-t,-o,0)):g===h.ZOOM?p.zoom(m.set(0,0,o)):g===h.PAN&&p.pan(m.set(-t,o,0)),E.set(e.clientX,e.clientY)}}function r(){t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),g=h.NONE}function i(e){e.preventDefault(),p.zoom(m.set(0,0,0<e.deltaY?1:-1))}function n(e){!1===p.enabled||(0===e.button?g=h.ROTATE:1===e.button?g=h.ZOOM:2===e.button&&(g=h.PAN),E.set(e.clientX,e.clientY),t.addEventListener("mousemove",a,!1),t.addEventListener("mouseup",r,!1),t.addEventListener("mouseout",r,!1),t.addEventListener("dblclick",r,!1))}function s(e){e.preventDefault()}function l(e){if(!1!==p.enabled){switch(e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),A=S[0].distanceTo(S[1]);}O[0].copy(S[0]),O[1].copy(S[1])}}function d(e){function t(e,t){var o=t[0];for(var a in t)o.distanceTo(e)>t[a].distanceTo(e)&&(o=t[a]);return o}if(!1!==p.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),p.rotate(S[0].sub(t(S[0],O)).multiplyScalar(-1));break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var o=S[0].distanceTo(S[1]);p.zoom(m.set(0,0,A-o)),A=o;var a=S[0].clone().sub(t(S[0],O)),r=S[1].clone().sub(t(S[1],O));a.x=-a.x,r.x=-r.x,p.pan(a.add(r));}O[0].copy(S[0]),O[1].copy(S[1])}}t=t===void 0?document:t,this.enabled=!0,this.center=new o.Vector3,this.panSpeed=.01,this.zoomSpeed=.05,this.rotationSpeed=.005;var p=this,c=new o.Vector3,m=new o.Vector3,u=new o.Box3,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},g=h.NONE,y=this.center,b=new o.Matrix3,f=new o.Vector2,E=new o.Vector2,_=new o.Spherical,T=new o.Sphere,v={type:"change"};this.focus=function(t){var o;u.setFromObject(t),!1===u.isEmpty()?(u.getCenter(y),o=u.getBoundingSphere(T).radius):(y.setFromMatrixPosition(t.matrixWorld),o=.1),m.set(0,0,1),m.applyQuaternion(e.quaternion),m.multiplyScalar(4*o),e.position.copy(y).add(m),p.dispatchEvent(v)},this.pan=function(t){var o=e.zoom;t.multiplyScalar(p.panSpeed/o),t.applyMatrix3(b.getNormalMatrix(e.matrix)),e.position.add(t),y.add(t),p.dispatchEvent(v)},this.zoom=function(t){e.zoom-=.1*((t.z||0)*e.zoom),e.updateProjectionMatrix(),p.dispatchEvent(v)},this.rotate=function(t){c.copy(e.position).sub(y),_.setFromCartesianCoords(-1*c.x,c.z,c.y),_.theta+=t.x*p.rotationSpeed,_.makeSafe();var o=c.setFromSpherical(_);c.set(-1*o.x,o.z,o.y),e.position.copy(y).add(c),e.lookAt(y),p.dispatchEvent(v)},t.addEventListener("contextmenu",s,!1),t.addEventListener("mousedown",n,!1),t.addEventListener("wheel",i,!1);var S=[new o.Vector3,new o.Vector3,new o.Vector3],O=[new o.Vector3,new o.Vector3,new o.Vector3],A=null;t.addEventListener("touchstart",l,!1),t.addEventListener("touchmove",d,!1),this.dispose=function(){t.removeEventListener("contextmenu",s,!1),t.removeEventListener("mousedown",n,!1),t.removeEventListener("wheel",i,!1),t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),t.removeEventListener("touchstart",l,!1),t.removeEventListener("touchmove",d,!1)}};ca.prototype=Object.create(o.EventDispatcher.prototype),ca.prototype.constructor=ca;var ma=window.ResizeObserver||s.ResizeObserver,ua=function(){function e(e,t){var o=this;void 0===t&&(t=ft),this.options=ft,this.previousWidth=0,this.previousHeight=0,this.options=B(B({},ft),t),this.scene=e||new la,this.ro=new ma(function(e){0<e.length&&o.onWindowResize()}),this.initCamera(),this.animate=this.animate.bind(this),this.onWindowResize=this.onWindowResize.bind(this)}return e.prototype.animate=function(){var e;this.scene.stats.begin(),this.scene.updateMatrixWorld(),R(this.camera),null===(e=this.renderer)||void 0===e?void 0:e.render(this.scene,this.camera),this.scene.stats.end(),requestAnimationFrame(this.animate)},e.prototype.initCamera=function(){this.camera=new o.OrthographicCamera(-100,100,100,-100,.1,1e3),this.camera.zoom=.5,this.camera.position.set(0,0,10),this.camera.up=new o.Vector3(0,0,1),this.camera.lookAt(new o.Vector3),this.scene.add(this.camera)},e.prototype.setContainer=function(e){this.container=e,this.initRenderer(e),this.controls=new ca(this.camera,this.container),this.controls.enableDamping=!0,this.ro.observe(this.container),requestAnimationFrame(this.animate),this.onWindowResize()},e.prototype.initRenderer=function(e){var t=new o.WebGLRenderer({antialias:!0});t.autoClear=!1,t.setPixelRatio(window.devicePixelRatio),R(this.container),t.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer=t,this.container.appendChild(t.domElement)},e.prototype.updateOptions=function(e){void 0===e&&(e=ft),this.options=B(B({},this.options),e),this.scene.updateOptions(this.options)},e.prototype.destroy=function(){this.ro.unobserve(this.container)},e.prototype.onWindowResize=function(){var e;R(this.container),R(this.camera);var t=this.container,o=t.offsetHeight,a=t.offsetWidth;if(10<m(a-this.previousWidth)||10<m(o-this.previousHeight)){var r=C([a/100,o/100],2),i=r[0],n=r[1];this.camera.left=-i/2,this.camera.right=i/2,this.camera.top=n/2,this.camera.bottom=-n/2,this.camera.updateProjectionMatrix(),null===(e=this.renderer)||void 0===e?void 0:e.setSize(a,o),this.previousWidth=a,this.previousHeight=o}},e.prototype.addVisualization=function(e){this.scene.addVisualization(e)},e}(),ha=function(e,t){function a(e){!1===p.enabled||(0===e.button?g=h.ROTATE:1===e.button?g=h.ZOOM:2===e.button&&(g=h.PAN),E.set(e.clientX,e.clientY),t.addEventListener("mousemove",r,!1),t.addEventListener("mouseup",i,!1),t.addEventListener("mouseout",i,!1),t.addEventListener("dblclick",i,!1))}function r(e){if(!1!==p.enabled){f.set(e.clientX,e.clientY);var t=f.x-E.x,o=f.y-E.y;g===h.ROTATE?p.rotate(m.set(-t,-o,0)):g===h.ZOOM?p.zoom(m.set(0,0,o)):g===h.PAN&&p.pan(m.set(-t,o,0)),E.set(e.clientX,e.clientY)}}function i(e){t.removeEventListener("mousemove",r,!1),t.removeEventListener("mouseup",i,!1),t.removeEventListener("mouseout",i,!1),t.removeEventListener("dblclick",i,!1),g=h.NONE}function n(e){e.preventDefault(),p.zoom(m.set(0,0,0<e.deltaY?1:-1))}function s(e){e.preventDefault()}function l(e){if(!1!==p.enabled){switch(e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),A=S[0].distanceTo(S[1]);}O[0].copy(S[0]),O[1].copy(S[1])}}function d(e){function t(e,t){var o=t[0];for(var a in t)o.distanceTo(e)>t[a].distanceTo(e)&&(o=t[a]);return o}if(!1!==p.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),p.rotate(S[0].sub(t(S[0],O)).multiplyScalar(-1));break;case 2:S[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),S[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var o=S[0].distanceTo(S[1]);p.zoom(m.set(0,0,A-o)),A=o;var a=S[0].clone().sub(t(S[0],O)),r=S[1].clone().sub(t(S[1],O));a.x=-a.x,r.x=-r.x,p.pan(a.add(r));}O[0].copy(S[0]),O[1].copy(S[1])}}t=t===void 0?document:t,this.enabled=!0,this.center=new o.Vector3,this.panSpeed=.002,this.zoomSpeed=.1,this.rotationSpeed=.005;var p=this,c=new o.Vector3,m=new o.Vector3,u=new o.Box3,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},g=h.NONE,y=this.center,b=new o.Matrix3,f=new o.Vector2,E=new o.Vector2,_=new o.Spherical,T=new o.Sphere,v={type:"change"};this.focus=function(t){var o;u.setFromObject(t),!1===u.isEmpty()?(u.getCenter(y),o=u.getBoundingSphere(T).radius):(y.setFromMatrixPosition(t.matrixWorld),o=.1),m.set(0,0,1),m.applyQuaternion(e.quaternion),m.multiplyScalar(4*o),e.position.copy(y).add(m),p.dispatchEvent(v)},this.pan=function(t){var o=e.position.distanceTo(y);t.multiplyScalar(o*p.panSpeed),t.applyMatrix3(b.getNormalMatrix(e.matrix)),e.position.add(t),y.add(t),p.dispatchEvent(v)},this.zoom=function(t){var o=e.position.distanceTo(y);t.multiplyScalar(o*p.zoomSpeed);t.length()>o||(t.applyMatrix3(b.getNormalMatrix(e.matrix)),e.position.add(t),p.dispatchEvent(v))},this.rotate=function(t){c.copy(e.position).sub(y),_.setFromCartesianCoords(-1*c.x,c.z,c.y),_.theta+=t.x*p.rotationSpeed,_.phi+=t.y*p.rotationSpeed,_.makeSafe();var o=c.setFromSpherical(_);c.set(-1*o.x,o.z,o.y),e.position.copy(y).add(c),e.lookAt(y),p.dispatchEvent(v)},this.dispose=function(){t.removeEventListener("contextmenu",s,!1),t.removeEventListener("mousedown",a,!1),t.removeEventListener("wheel",n,!1),t.removeEventListener("mousemove",r,!1),t.removeEventListener("mouseup",i,!1),t.removeEventListener("mouseout",i,!1),t.removeEventListener("dblclick",i,!1),t.removeEventListener("touchstart",l,!1),t.removeEventListener("touchmove",d,!1)},t.addEventListener("contextmenu",s,!1),t.addEventListener("mousedown",a,!1),t.addEventListener("wheel",n,!1);var S=[new o.Vector3,new o.Vector3,new o.Vector3],O=[new o.Vector3,new o.Vector3,new o.Vector3],A=null;t.addEventListener("touchstart",l,!1),t.addEventListener("touchmove",d,!1)};ha.prototype=Object.create(o.EventDispatcher.prototype),ha.prototype.constructor=ha;var ga=window.ResizeObserver||s.ResizeObserver,ya=function(){function e(e,t){var o=this;void 0===t&&(t={}),this.options={},this.previousWidth=0,this.previousHeight=0,this.options=B(B({},ft),t),this.scene=e||new la(this.options),this.ro=new ga(function(e){0<e.length&&o.onWindowResize()}),this.initCamera(),this.animate=this.animate.bind(this),this.onWindowResize=this.onWindowResize.bind(this)}return e.prototype.animate=function(){var e;this.scene.stats.begin(),this.scene.updateMatrixWorld(),R(this.camera),null===(e=this.renderer)||void 0===e?void 0:e.render(this.scene,this.camera),this.scene.stats.end(),requestAnimationFrame(this.animate)},e.prototype.initCamera=function(){this.camera=new o.PerspectiveCamera(50,1,.01,1e3),this.camera.position.set(0,5,10),this.camera.up=new o.Vector3(0,0,1),this.camera.lookAt(new o.Vector3),this.scene.add(this.camera)},e.prototype.setContainer=function(e){this.container=e,this.initRenderer(),this.controls=new ha(this.camera,this.container),this.controls.enableDamping=!0,this.ro.observe(this.container),requestAnimationFrame(this.animate),this.onWindowResize()},e.prototype.initRenderer=function(){var e=new o.WebGLRenderer({antialias:!0});e.autoClear=!1,e.setPixelRatio(window.devicePixelRatio),R(this.container),e.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer=e,this.container.appendChild(e.domElement)},e.prototype.updateOptions=function(e){void 0===e&&(e=ft),this.options=B(B({},this.options),e),this.scene.updateOptions(this.options)},e.prototype.destroy=function(){this.ro.unobserve(this.container)},e.prototype.onWindowResize=function(){var e;R(this.container),R(this.camera);var t=this.container,o=t.offsetHeight,a=t.offsetWidth;(10<m(a-this.previousWidth)||10<m(o-this.previousHeight))&&(this.camera.aspect=a/o,this.camera.updateProjectionMatrix(),null===(e=this.renderer)||void 0===e?void 0:e.setSize(a,o),this.previousWidth=a,this.previousHeight=o)},e.prototype.addVisualization=function(e){this.scene.addVisualization(e)},e}(),ba=function(e){function t(t,o){void 0===o&&(o={});var a=e.call(this,null,B(B({},Et),o))||this;return a.options={},a.framesList=[],a.ros=t,a.onFramesListUpdate=o.onFramesListUpdate||function(){},a.initRosEvents(),a.getTFMessages=a.getTFMessages.bind(a),a.setFrameTransform=a.setFrameTransform.bind(a),a.addRobot=a.addRobot.bind(a),a.onRosConnection=a.onRosConnection.bind(a),a}return S(t,e),t.prototype.initRosEvents=function(){var e=this;this.ros.on("connection",function(){e.onRosConnection()}),this.ros.isConnected&&this.onRosConnection()},t.prototype.onRosConnection=function(){var e=this;this.ros.getTopics(function(t){["/tf","/tf_static"].forEach(function(o){var a=new V.Topic({ros:e.ros,name:o,messageType:t.types[t.topics.indexOf(o)]});a.subscribe(e.getTFMessages)})})},t.prototype.getTFMessages=function(e){var t=this,o=e.transforms;o.forEach(function(e){var o=e.header.frame_id,a=e.child_frame_id,r=e.transform,i=r.rotation,n=i.w,s=i.x,l=i.y,d=i.z,p=r.translation,c=p.x,m=p.y,u=p.z,h=C([t.getObjectOrCreate(a+"-tf-connector"),t.getObjectOrCreate(o+"-tf-connector")],2),g=h[0],y=h[1];y.add(g),g.position.set(c,m,u),g.quaternion.set(s,l,d,n),[o,a].forEach(function(e){-1===t.framesList.indexOf(e+"-tf-connector")&&t.framesList.push(e+"-tf-connector")})}),this.setFrameTransform()},t.prototype.getObjectOrCreate=function(e){var t=this.scene.vizWrapper;-1===this.framesList.indexOf(e)&&(this.framesList.push(e),this.onFramesListUpdate(this.framesList));var a=t.getObjectByName(e);if(a)return a;var r=new o.Group;return r.name=e,this.scene.addObject(r),r},t.prototype.setFrameTransform=function(){var e=this,t=e.options.selectedFrame,a=e.scene.vizWrapper;if(t){var r=this.getObjectOrCreate(t);if(r){a.position.set(0,0,0),a.quaternion.set(0,0,0,1),a.updateMatrixWorld();var i=new o.Vector3,n=new o.Quaternion;r.getWorldQuaternion(n);var s=n.w,l=n.x,d=n.y,p=n.z;a.quaternion.set(-l,-d,-p,s),a.updateMatrixWorld(),r.getWorldPosition(i);var c=i.negate();a.position.set(c.x,c.y,c.z)}}},t.prototype.addVisualization=function(t){var o=this;e.prototype.addVisualization.call(this,t),t.onHeaderChange=function(e){var a=o.getObjectOrCreate(e+"-tf-connector");a.add(t.object)}},t.prototype.attachObjectOutsideTree=function(e){if(e.frameId){var t=this.getObjectOrCreate(e.frameId+"-tf-connector");t.attach(e)}},t.prototype.addRobot=function(t){var o=this;t.loadFromParam(function(){var a;e.prototype.addVisualization.call(o,t);var r=(null===(a=t.object)||void 0===a?void 0:a.children[0]).links,i=Object.keys(r);i.map(function(e){var t=r[e],a=o.getObjectOrCreate(e+"-tf-connector");a.add(t)})})},t.prototype.setFixedFrame=function(){},t}(ya),fa=function(){function e(e,t,o){this.markerManagerMap={},this.controlsMap={},this.objectMap={},this.namespaces={},this.callback=function(){return null},this.object=e,this.viewer=t,this.hideOtherHandlesOnSelect=o.hideOtherHandlesOnSelect,this.hideOtherControlsInstancesOnSelect=o.hideOtherControlsInstancesOnSelect,this.visible=o.visible,this.onChange=this.onChange.bind(this)}return e.prototype.getMarkerManagerOrCreate=function(e){var t=e;if(!this.markerManagerMap[t]||!this.objectMap[t]){var o=new oo;o.name=t||"",this.markerManagerMap[t]=new Vo(o,this.onChange),this.objectMap[t]=o,this.object.add(o)}return{manager:this.markerManagerMap[t],object:this.objectMap[t]}},e.prototype.onChange=function(){this.callback&&this.callback()},e.prototype.onNamespaceChange=function(e){this.callback=e},e.prototype.initMarkers=function(t,o,a){var r=this,i=t.controls,n=t.header.frame_id,s=t.name,l=t.pose,c=l.orientation,m=l.position,u=t.scale;0===u&&(u=1);var h=this.getMarkerManagerOrCreate(s),g=h.manager,y=h.object;y.visible=a,y.frameId=n,this.viewer.attachObjectOutsideTree&&this.viewer.attachObjectOutsideTree(y),y.setTransform({translation:m,rotation:c}),y.userData.control={frameId:t.header.frame_id,markerName:t.name},y.userData.handlesControlsMap={},i.forEach(function(t,n){var l,c,m=s;if(void 0===r.controlsMap[m]&&(r.controlsMap[m]=[]),(null===(l=r.controlsMap[m])||void 0===l?void 0:l.length)!==i.length){var h=t.orientation_mode===ae.FIXED?d.ANCHOR_MODE.FIXED:d.ANCHOR_MODE.INHERIT,b=o.anchor(y,{separationT:{x:.4,y:.4,z:.4},orientation:t.orientation,mode:h,hideOtherHandlesOnSelect:r.hideOtherHandlesOnSelect,hideOtherControlsInstancesOnSelect:r.hideOtherControlsInstancesOnSelect,showHelperPlane:!0});b.scale.set(u,u,u),b.visible=a,e.enableControls(y,t.interaction_mode,t.orientation_mode,t.name,b,p({seed:m+"-"+t.name+"-"+2*n})),null===(c=r.controlsMap[m])||void 0===c?void 0:c.push(b)}0<t.markers.length&&t.markers.forEach(function(e){g.updateMarker(e)})})},e.prototype.setVisible=function(e){this.visible=e;var t=Object.values(this.controlsMap);t.map(function(t){null===t||void 0===t?void 0:t.map(function(t){t.visible=e,t.object.visible=e})})},e.prototype.updatePose=function(e){var t=e.name,o=e.pose,a=this.objectMap[t];if(a&&o){var r=o.orientation,i=o.position;a.setTransform({translation:i,rotation:r})}},e.enableControls=function(t,a,r,i,n,s){var l;n.showAll(!1);var p=new o.Quaternion;n.getWorldQuaternion(p);var c=new o.Euler().setFromQuaternion(p),m=e.getAlignmentColor(c),u=null!==m&&void 0!==m?m:s;if(-1!==re.indexOf(r)&&a===ie.ROTATE_AXIS)return t.userData.handlesControlsMap=B(B({},t.userData.handlesControlsMap),(l={},l[d.DEFAULT_HANDLE_GROUP_NAME.ER]=i,l)),void n.showByNames([d.DEFAULT_HANDLE_GROUP_NAME.ER],!0);var h=[];switch(a){case ie.NONE:case ie.MENU:case ie.BUTTON:break;case ie.MOVE_AXIS:{h=[d.DEFAULT_HANDLE_GROUP_NAME.XPT,d.DEFAULT_HANDLE_GROUP_NAME.XNT],n.translationXP.setColor(u),n.translationXN.setColor(u);break}case ie.MOVE_PLANE:{h=[d.DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_YZ],n.pickPlaneYZ.setColor(u);break}case ie.ROTATE_AXIS:{h=[d.DEFAULT_HANDLE_GROUP_NAME.XR],n.rotationX.setColor(u);break}case ie.MOVE_ROTATE:{h=[d.DEFAULT_HANDLE_GROUP_NAME.XR,d.DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_YZ],n.pickPlaneYZ.setColor(u),n.rotationX.setColor(u);break}case ie.MOVE_3D:{h=[d.DEFAULT_HANDLE_GROUP_NAME.XPT,d.DEFAULT_HANDLE_GROUP_NAME.XNT,d.DEFAULT_HANDLE_GROUP_NAME.YPT,d.DEFAULT_HANDLE_GROUP_NAME.YNT,d.DEFAULT_HANDLE_GROUP_NAME.ZPT,d.DEFAULT_HANDLE_GROUP_NAME.ZNT,d.DEFAULT_HANDLE_GROUP_NAME.PICK];break}case ie.ROTATE_3D:{h=[d.DEFAULT_HANDLE_GROUP_NAME.XR,d.DEFAULT_HANDLE_GROUP_NAME.YR,d.DEFAULT_HANDLE_GROUP_NAME.ZR];break}case ie.MOVE_ROTATE_3D:{h=[d.DEFAULT_HANDLE_GROUP_NAME.PICK];break}}h.map(function(e){t.userData.handlesControlsMap[e]=i}),n.showByNames(h,!0)},e.getAlignmentColor=function(e){for(var t,o=c(10,-3),a=C(e.toArray(),3),r=a[0],n=a[1],s=a[2],l=-4;4>=l;l++){if(t=l*v/2,m(r-t)<o&&m(n)<o&&m(s)<o)return"red";if(m(n-t)<o&&m(r)<o&&m(s)<o)return"green";if(m(s-t)<o&&m(n)<o&&m(r)<o)return"blue"}return null},e.prototype.removeObject=function(e){var t,o=this.objectMap[e];null===(t=o.parent)||void 0===t?void 0:t.remove(o),delete this.objectMap[e]},e.prototype.reset=function(e){var t=this;this.onChange(),e&&Object.keys(this.objectMap).forEach(function(e){t.removeObject(e)})},e}(),Ea=function(e){function t(t,o,a,r){void 0===r&&(r=It);var i=e.call(this,t,o,Xe,B(B({},It),r))||this;i.init=!1,i.object=new oo,i.interactiveMarkersNames=new Set,i.interactiveMarkersFrameIds=new Set,i.clientId="amphion-"+g(Math.random()*c(10,8)),i.messageSequence=0,i.feedbackTopic=null,i.init=!1,i.viewer=a,i.updateOptions(B(B({},It),r)),i.interactiveMarkerManager=new fa(i.object,a,i.options);var n=i.options.publishThrottleRate;return i.debouncedPublish=l(i.publish.bind(i),n&&0<n?n:0),i.initFreeformControls(),i.publishManual=i.publishManual.bind(i),i}return S(t,e),t.prototype.hide=function(){e.prototype.hide.call(this),this.interactiveMarkerManager.setVisible(!1)},t.prototype.show=function(){e.prototype.show.call(this),this.interactiveMarkerManager.setVisible(!0)},t.prototype.destroy=function(){var t;e.prototype.destroy.call(this),null===(t=this.freeformControls)||void 0===t?void 0:t.destroy(),this.freeformControls=null,this.interactiveMarkerManager.reset(!0),this.interactiveMarkersNames=new Set},t.prototype.initFreeformControls=function(){var e=this,t=this.viewer,o=t.camera,a=t.controls,r=t.renderer,i=t.scene;R(o),R(r),this.freeformControls=new d.ControlsManager(o,r.domElement),i.add(this.freeformControls),this.freeformControls.listen(d.RAYCASTER_EVENTS.DRAG_START,function(){a.enabled=!1}),this.freeformControls.listen(d.RAYCASTER_EVENTS.DRAG,function(t,o){return e.debouncedPublish(t,o)}),this.freeformControls.listen(d.RAYCASTER_EVENTS.DRAG_STOP,function(t,o){e.debouncedPublish(t,o),a.enabled=!0})},t.makeInteractiveMarkerFeedbackMessage=function(e){var t=e.seq,o=e.frame_id,a=e.client_id,r=e.marker_name,i=e.control_name,n=e.position,s=e.quaternion;return new V.Message({header:{seq:t,frame_id:o,stamp:{secs:0,nsecs:0}},client_id:a,marker_name:r,control_name:i,pose:{position:{x:n.x,y:n.y,z:n.z},orientation:{x:s.x,y:s.y,z:s.z,w:s.w}},event_type:1,menu_entry_id:0,mouse_point:{x:0,y:0,z:0},mouse_point_valid:!1})},t.makeInteractiveMarkerFeedbackTopic=function(e,t){return new V.Topic({ros:e,name:t,messageType:qe})},t.prototype.publish=function(e,o){var a;if(e){var r=e.userData.control,i=r.frameId,n=r.markerName,s=e.userData.handlesControlsMap[o],l=t.makeInteractiveMarkerFeedbackMessage({seq:this.messageSequence,client_id:this.clientId,frame_id:i,marker_name:n,control_name:s,position:e.position,quaternion:e.quaternion});null!==this.feedbackTopic&&(null===(a=this.feedbackTopic)||void 0===a?void 0:a.publish(l)),this.messageSequence++}},t.prototype.publishManual=function(e){var o=t.makeInteractiveMarkerFeedbackMessage(B(B({seq:this.messageSequence,client_id:this.clientId},e),{frame_id:Array.from(this.interactiveMarkersFrameIds)[0],marker_name:Array.from(this.interactiveMarkersNames)[0]}));null!==this.feedbackTopic&&this.feedbackTopic.publish(o),this.messageSequence++},t.prototype.updateOptions=function(o){void 0===o.feedbackTopicName?this.feedbackTopic=null:(!this.feedbackTopic||this.feedbackTopic.name!==o.feedbackTopicName.name)&&(R(this.ros),this.feedbackTopic=t.makeInteractiveMarkerFeedbackTopic(this.ros,o.feedbackTopicName));var a=this.options.updateTopicName!==o.topicName&&this.init,r=this.topicName===this.options.updateTopicName;if(a&&void 0!==o.updateTopicName){var i=o.updateTopicName,n=i.messageType,s=i.name;this.changeTopic(s,n,!0)}else a&&r&&this.unsubscribe();e.prototype.updateOptions.call(this,o)},t.prototype.update=function(t){var o=this;if(e.prototype.update.call(this,t),t.markers&&0<t.markers.length&&(t.markers.forEach(function(e){o.interactiveMarkersNames.has(e.name)||o.interactiveMarkerManager.initMarkers(e,o.freeformControls,o.options.visible),o.interactiveMarkersNames.add(e.name),e.header&&o.interactiveMarkersFrameIds.add(e.header.frame_id),t.markers.forEach(function(e){o.interactiveMarkerManager.updatePose(e)})}),!this.init))if(this.init=!0,void 0!==this.options.updateTopicName){var a=this.options.updateTopicName,r=a.messageType,i=a.name;this.init=!0,this.changeTopic(i,r,!0)}else this.unsubscribe();if(t.poses&&0<t.poses.length&&t.poses.forEach(function(e){o.interactiveMarkerManager.updatePose(e)}),t.erases);},t.prototype.reset=function(){this.interactiveMarkerManager.reset(!1)},t}(Jt),Ta=require("rosbag").open,va=function(){function e(){var e=this;this.files=new Set,this.topics=[],this.readers={},this.addFile=function(t){return O(e,void 0,void 0,function(){return A(this,function(e){switch(e.label){case 0:if(this.files.has(t))throw new Error("file already exists in the bucket");return this.files.add(t),this.readers[t.name]={topics:{},queue:[]},[4,this.processFile(t)];case 1:return e.sent(),[2];}})})},this.removeFile=function(t,o){return O(e,void 0,void 0,function(){return A(this,function(e){if(!this.files.has(t))throw new Error("file does not exist in the bucket");return this.files.delete(t),clearTimeout(this.readers[t.name].timer),clearTimeout(this.readers[t.name].queueStartWaitTimer),this.readers[t.name]={topics:{},queue:[]},this.topics=this.topics.filter(function(e){return e.rosbagFileName!==t.name}),o(),[2]})})},this.addReader=function(t,o,a){var r,i=e.readers[o].topics;if(!i)throw new Error("add "+o+" to the bucket first");i[t]||(i[t]=new Set),null===(r=i[t])||void 0===r?void 0:r.add(a)},this.removeReader=function(t,o,a){var r,i,n=e.readers[o].topics;if(!n)throw new Error("add "+o+" to the bucket first");if(null===(r=n[t])||void 0===r||!r.has(a))throw new Error("reader has not yet been added to the bucket");null===(i=n[t])||void 0===i?void 0:i.delete(a)},this.processQueue=function(t){var o=e.readers[t.name].queue;return 0===o.length?void(e.readers[t.name].queueStartWaitTimer=window.setTimeout(function(){e.processQueue(t)},500)):void e.enqueueProcessing(0,t)},this.enqueueProcessing=function(t,o){var a=e.readers[o.name].queue,r=a[t],i=a[t+1];if(e.processBagReadResult(r,o),!i)return void e.enqueueProcessing(0,o);var n=r.timestamp,s=n.sec,l=n.nsec,d=i.timestamp,p=d.sec,m=d.nsec,u=y(s*c(10,3)+l/c(10,6)),h=y(p*c(10,3)+m/c(10,6)),g=0;h>u&&(g=h-u),4>g?e.enqueueProcessing(t+1,o):e.readers[o.name].timer=window.setTimeout(function(){e.enqueueProcessing(t+1,o)},g)},this.processBagReadResult=function(t,o){var a=e.readers[o.name].topics,r=a["*"],i=a[t.topic];null===r||void 0===r?void 0:r.forEach(function(e){return e(o,t)}),null===i||void 0===i?void 0:i.forEach(function(e){return e(o,t)})}}return e.prototype.processFile=function(e){return O(this,void 0,void 0,function(){var t,o=this;return A(this,function(a){switch(a.label){case 0:return[4,Ta(e)];case 1:return t=a.sent(),Object.keys(t.connections).forEach(function(a){var r=t.connections[a],i=r.topic,n=r.type,s=o.topics.findIndex(function(t){return t.name===i&&t.rosbagFileName===e.name});-1===s&&o.topics.push({name:i,messageType:n,rosbagFileName:e.name})}),t.readMessages({},function(t){o.readers[e.name].queue.push(t)}),this.processQueue(e),[2];}})})},e}(),Sa=function(){function e(e){var o,a=this;this.createdAt=new Date,this.isStreamPaused=!1,this.internalListener=null,this.listeners=new Set,this.addListener=function(e){return a.listeners.has(e)?{success:!1,reason:"listener already present"}:(a.listeners.add(e),a.stream.addListener(e),{success:!0})},this.removeListener=function(e){return a.listeners.has(e)?(a.listeners.delete(e),a.stream.removeListener(e),{success:!0}):{success:!1,reason:"listener not present"}},this.removeAllListeners=function(){return a.listeners.forEach(function(e){a.stream.removeListener(e)}),a.listeners.clear(),{success:!0}},this.pause=function(){return a.isStreamPaused=!0,{success:!0}},this.resume=function(){return a.isStreamPaused=!1,{success:!0}},this.hasMemory=!(null===(o=e.memory)||void 0===o)&&o,this.bucket=e.bucket,this.producer={start:function(t){a.internalListener=function(e,o){a.isStreamPaused||t.next(o.message)},a.bucket.addReader(e.topicName,e.fileName,a.internalListener)},stop:function(){a.internalListener&&a.bucket.removeReader(e.topicName,e.fileName,a.internalListener)}},this.stream=this.hasMemory?t.createWithMemory(this.producer):t.create(this.producer)}return e}();return{EditorControls:ha,CollisionObject:io,DepthCloud:pa,DisplayTrajectory:no,PlanningScene:so,Point:Po,PointCloud:Lo,Polygon:Eo,Pose:yo,Wrench:fo,PoseArray:ea,Tf:vo,RobotModel:Oo,MarkerArray:Go,LaserScan:Bo,Map:Jo,Odometry:$o,Path:ta,Image:oa,ImageStream:ra,Marker:ia,Range:na,Scene:la,Viewer2d:ua,Viewer3d:ya,TfViewer:ba,InteractiveMarkers:Ea,RosbagBucket:va,RosTopicDataSource:W,RosbagDataSource:Sa,CONSTANTS:Zt}});
//# sourceMappingURL=amphion.js.map
