import ROSLIB,{Topic}from"roslib";import xs from"xstream";import three,{Group as Group$1,Color,Mesh as Mesh$1,Material,MeshBasicMaterial,TorusGeometry,BufferGeometry,Object3D,BufferAttribute,Quaternion,MathUtils,BoxGeometry,MeshStandardMaterial,MeshPhongMaterial,CylinderGeometry,ConeGeometry,Vector3,Geometry,LineBasicMaterial,Line as Line$1,VertexColors,FontLoader,TextGeometry,DefaultLoadingManager,SphereGeometry,PointsMaterial,DynamicDrawUsage,Points as Points$2,LineSegments as LineSegments$1,Face3,FaceColors,DoubleSide,TextureLoader,PlaneGeometry,FrontSide,CanvasTexture,NearestFilter,DirectionalLight,AmbientLight,GridHelper,Scene as Scene$1,Texture,ShaderMaterial,EventDispatcher,Box3,Matrix3,Vector2,Spherical,Sphere as Sphere$1,OrthographicCamera,WebGLRenderer,PerspectiveCamera,Euler}from"three";import STLLoader from"three/examples/jsm/loaders/STLLoader.js";import ColladaLoader from"three/examples/jsm/loaders/ColladaLoader.js";import threeMeshBvh from"three-mesh-bvh";import SpriteText from"three-spritetext";import{ResizeObserver as ResizeObserver$2}from"@juggle/resize-observer";import debounce from"lodash.debounce";import{ANCHOR_MODE,DEFAULT_HANDLE_GROUP_NAME,ControlsManager,RAYCASTER_EVENTS}from"three-freeform-controls";import randomColor from"randomcolor";var extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},extendStatics(e,t)};function __extends(e,t){function o(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var __assign=function(){return __assign=Object.assign||function(e){for(var t,o=1,a=arguments.length;o<a;o++)for(var r in t=arguments[o],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},__assign.apply(this,arguments)};function __awaiter(e,t,o,a){return new(o||(o=Promise))(function(r,i){function n(e){try{l(a.next(e))}catch(t){i(t)}}function s(e){try{l(a["throw"](e))}catch(t){i(t)}}function l(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(n,s)}l((a=a.apply(e,t||[])).next())})}function __generator(e,o){function a(e){return function(t){return r([e,t])}}function r(t){if(i)throw new TypeError("Generator is already executing.");for(;d;)try{if(i=1,n&&(s=2&t[0]?n["return"]:t[0]?n["throw"]||((s=n["return"])&&s.call(n),0):n.next)&&!(s=s.call(n,t[1])).done)return s;switch((n=0,s)&&(t=[2&t[0],s.value]),t[0]){case 0:case 1:s=t;break;case 4:return d.label++,{value:t[1],done:!1};case 5:d.label++,n=t[1],t=[0];continue;case 7:t=d.ops.pop(),d.trys.pop();continue;default:if((s=d.trys,!(s=0<s.length&&s[s.length-1]))&&(6===t[0]||2===t[0])){d=0;continue}if(3===t[0]&&(!s||t[1]>s[0]&&t[1]<s[3])){d.label=t[1];break}if(6===t[0]&&d.label<s[1]){d.label=s[1],s=t;break}if(s&&d.label<s[2]){d.label=s[2],d.ops.push(t);break}s[2]&&d.ops.pop(),d.trys.pop();continue;}t=o.call(e,d)}catch(o){t=[6,o],n=0}finally{i=s=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}var i,n,s,l,d={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return l={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l}function __values(e){var t="function"==typeof Symbol&&e[Symbol.iterator],a=0;return t?t.call(e):{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}}}function __read(t,o){var a="function"==typeof Symbol&&t[Symbol.iterator];if(!a)return t;var s,l,d=a.call(t),i=[];try{for(;(void 0===o||0<o--)&&!(s=d.next()).done;)i.push(s.value)}catch(e){l={error:e}}finally{try{s&&!s.done&&(a=d["return"])&&a.call(d)}finally{if(l)throw l.error}}return i}function __spread(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}var RosTopicDataSource=function(){function e(e){var t,o=this;this.createdAt=new Date,this.isStreamLive=!1,this.isStreamPaused=!1,this.internalListener=null,this.listeners=new Set,this.rosConnectionHook=null,this.rosCloseHook=null,this.rosErrorHook=null,this.addRosHealthHooks=function(){o.rosCloseHook=function(){o.isStreamLive=!1,o.cleanStream("complete")},o.rosErrorHook=function(e){o.isStreamLive=!1,o.cleanStream("error",e)},o.ros.on("error",o.rosErrorHook),o.ros.on("close",o.rosCloseHook)},this.removeRosHealthHooks=function(){o.ros.off("error",o.rosErrorHook),o.ros.off("close",o.rosCloseHook),o.rosErrorHook=null,o.rosCloseHook=null},this.addListener=function(e){return o.listeners.has(e)?{success:!1,reason:"listener already present"}:(o.listeners.add(e),o.isStreamLive&&o.stream.addListener(e),{success:!0})},this.removeListener=function(e){return o.listeners.has(e)?(o.listeners.delete(e),o.stream.removeListener(e),{success:!0}):{success:!1,reason:"listener not present"}},this.cleanStream=function(e,t){"error"===e?o.stream.shamefullySendError(t):o.stream.shamefullySendComplete(),o.listeners.forEach(function(e){o.stream.removeListener(e)})},this.removeAllListeners=function(){return o.listeners.forEach(function(e){o.stream.removeListener(e)}),o.listeners.clear(),{success:!0}},this.pause=function(){return o.isStreamPaused=!0,{success:!0}},this.resume=function(){return o.isStreamPaused=!1,{success:!0}},this.ros=e.ros,this.hasMemory=!(null===(t=e.memory)||void 0===t)&&t;var a={ros:this.ros,name:e.topicName,messageType:e.messageType};e.compression&&(a.compression=e.compression),e.queueSize&&(a.queue_size=e.queueSize),e.queueLength&&(a.queue_length=e.queueLength),this.topic=new Topic(a),this.producer={start:function(e){o.rosCloseHook||o.rosErrorHook||o.addRosHealthHooks(),o.internalListener=function(t){o.isStreamPaused||e.next(t)},o.topic.subscribe(o.internalListener)},stop:function(){o.topic.unsubscribe(o.internalListener),o.removeRosHealthHooks()}},this.stream=this.hasMemory?xs.createWithMemory(this.producer):xs.create(this.producer),this.isStreamLive=!0,this.rosConnectionHook=function(){o.isStreamLive||(o.stream=o.hasMemory?xs.createWithMemory(o.producer):xs.create(o.producer),o.isStreamLive=!0,o.listeners.forEach(function(e){o.stream.addListener(e)}))},this.ros.on("connection",this.rosConnectionHook)}return e}(),OBJECT_TYPE_ARROW="Arrow",OBJECT_TYPE_ARROW_WITH_CIRCLE="ArrowWithCircle",OBJECT_TYPE_AXES="Axes",OBJECT_TYPE_FLAT_ARROW="FlatArrow",MAX_POINTCLOUD_POINTS=5e6,DEFAULT_BACKGROUND_COLOR=15790320,DEFAULT_GRID_SIZE=30,DEFAULT_GRID_DIVISIONS=30,DEFAULT_GRID_COLOR=11184810,DEFAULT_GRID_COLOR_CENTERLINE=7368816,INTERACTIVE_MARKER_ORIENTATION_MODES={INHERIT:0,FIXED:1,VIEW_FACING:2},UNSUPPORTED_INTERACTIVE_MARKER_ORIENTATION_MODES=[INTERACTIVE_MARKER_ORIENTATION_MODES.VIEW_FACING],INTERACTIVE_MARKER_INTERACTION_MODES={NONE:0,MENU:1,BUTTON:2,MOVE_AXIS:3,MOVE_PLANE:4,ROTATE_AXIS:5,MOVE_ROTATE:6,MOVE_3D:7,ROTATE_3D:8,MOVE_ROTATE_3D:9},MESSAGE_TYPE_ROBOT_MODEL="robot_description",MESSAGE_TYPE_ACCELSTAMPED="geometry_msgs/AccelStamped",MESSAGE_TYPE_POINTSTAMPED="geometry_msgs/PointStamped",MESSAGE_TYPE_POINTSTAMPED2="geometry_msgs/msg/PointStamped",MESSAGE_TYPE_POLYGONSTAMPED="geometry_msgs/PolygonStamped",MESSAGE_TYPE_POSEARRAY="geometry_msgs/PoseArray",MESSAGE_TYPE_POSEARRAY2="geometry_msgs/msg/PoseArray",MESSAGE_TYPE_POSECOVARIANCE="geometry_msgs/PoseWithCovariance",MESSAGE_TYPE_POSECOVARIANCE2="geometry_msgs/msg/PoseWithCovariance",MESSAGE_TYPE_POSESTAMPED="geometry_msgs/PoseStamped",MESSAGE_TYPE_POSESTAMPED2="geometry_msgs/msg/PoseStamped",MESSAGE_TYPE_TWISTSTAMPED="geometry_msgs/TwistStamped",MESSAGE_TYPE_VECTOR3STAMPED="geometry_msgs/Vector3Stamped",MESSAGE_TYPE_WRENCHSTAMPED="geometry_msgs/WrenchStamped",MESSAGE_TYPE_WRENCHSTAMPED2="geometry_msgs/msg/WrenchStamped",MESSAGE_TYPE_BOUNDINGVOLUME="moveit_msgs/BoundingVolume",MESSAGE_TYPE_COLLISION_OBJECT="moveit_msgs/CollisionObject",MESSAGE_TYPE_DISPLAYROBOTSTATE="moveit_msgs/DisplayRobotState",MESSAGE_TYPE_DISPLAYTRAJECTORY="moveit_msgs/DisplayTrajectory",MESSAGE_TYPE_PLANNINGSCENE="moveit_msgs/PlanningScene",MESSAGE_TYPE_OCCUPANCYGRID="nav_msgs/OccupancyGrid",MESSAGE_TYPE_OCCUPANCYGRID2="nav_msgs/msg/OccupancyGrid",MESSAGE_TYPE_ODOMETRY="nav_msgs/Odometry",MESSAGE_TYPE_ODOMETRY2="nav_msgs/msg/Odometry",MESSAGE_TYPE_PATH="nav_msgs/Path",MESSAGE_TYPE_PATH2="nav_msgs/msg/Path",MESSAGE_TYPE_COMPRESSEDIMAGE="sensor_msgs/CompressedImage",MESSAGE_TYPE_DISPLAYJOINTSTATE="sensor_msgs/JointState",MESSAGE_TYPE_IMAGE="sensor_msgs/Image",MESSAGE_TYPE_IMAGE2="sensor_msgs/msg/Image",MESSAGE_TYPE_LASERSCAN="sensor_msgs/LaserScan",MESSAGE_TYPE_LASERSCAN2="sensor_msgs/msg/LaserScan",MESSAGE_TYPE_MAGNETICFIELD="sensor_msgs/MagneticField",MESSAGE_TYPE_POINTCLOUD="sensor_msgs/PointCloud",MESSAGE_TYPE_POINTCLOUD2="sensor_msgs/PointCloud2",MESSAGE_TYPE_ROS2POINTCLOUD2="sensor_msgs/msg/PointCloud2",MESSAGE_TYPE_RANGE="sensor_msgs/Range",MESSAGE_TYPE_RANGE2="sensor_msgs/msg/Range",MESSAGE_TYPE_TF="tf/tfMessage",MESSAGE_TYPE_ROS2_TF="tf/msg/tfMessage",MESSAGE_TYPE_TF2="tf2_msgs/TFMessage",MESSAGE_TYPE_ROS2_TF2="tf2_msgs/msg/TFMessage",MESSAGE_TYPE_MARKER="visualization_msgs/Marker",MESSAGE_TYPE_MARKER2="visualization_msgs/msg/Marker",MESSAGE_TYPE_MARKERARRAY="visualization_msgs/MarkerArray",MESSAGE_TYPE_MARKERARRAY2="visualization_msgs/msg/MarkerArray",MESSAGE_TYPE_INTERACTIVEMARKER="visualization_msgs/InteractiveMarkerInit",MESSAGE_TYPE_INTERACTIVEMARKER2="visualization_msgs/msg/InteractiveMarkerInit",MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE="visualization_msgs/InteractiveMarkerUpdate",MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE2="visualization_msgs/msg/InteractiveMarkerUpdate",MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK="visualization_msgs/InteractiveMarkerFeedback",MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK2="visualization_msgs/msg/InteractiveMarkerFeedback",VIZ_TYPE_IMAGE="Image",VIZ_TYPE_INTERACTIVEMARKER="InteractiveMarker",VIZ_TYPE_LASERSCAN="LaserScan",VIZ_TYPE_MAP="Map",VIZ_TYPE_MARKER="Marker",VIZ_TYPE_MARKERARRAY="MarkerArray",VIZ_TYPE_ODOMETRY="Odometry",VIZ_TYPE_PATH="Path",VIZ_TYPE_POINT="Point",VIZ_TYPE_POINTCLOUD="PointCloud",VIZ_TYPE_POLYGON="Polygon",VIZ_TYPE_POSE="Pose",VIZ_TYPE_POSEARRAY="PoseArray",VIZ_TYPE_RANGE="Range",VIZ_TYPE_ROBOTMODEL="RobotModel",VIZ_TYPE_TF="Tf",VIZ_TYPE_WRENCH="Wrench",POINT_FIELD_DATATYPES={INT8:1,UINT8:2,INT16:3,UINT16:4,INT32:5,UINT32:6,FLOAT32:7,FLOAT64:8},COLLISION_OBJECT_OPERATIONS={ADD:0,REMOVE:1,APPEND:2,MOVE:3},SOLID_PRIMITIVE_TYPES={BOX:1,SPHERE:2,CYLINDER:3,CONE:4},MARKER_OBJECT_TYPES={ARROW:0,CUBE:1,SPHERE:2,CYLINDER:3,LINE_STRIP:4,LINE_LIST:5,CUBE_LIST:6,SPHERE_LIST:7,POINTS:8,TEXT_VIEW_FACING:9,MESH_RESOURCE:10,TRIANGLE_LIST:11},LINE_STYLES={LINES:"Lines",BILLBOARDS:"Billboards"},MAP_COLOR_SCHEMES={MAP:"map",CONST_MAP:"constmap",RAW:"raw"},LASERSCAN_STYLES={SQUARES:"squares",POINTS:"points",FLAT_SQUARES:"flat_squares",SPHERES:"spheres",BOXES:"boxes"},COLOR_TRANSFORMERS={INTENSITY:"Intensity",AXIS_COLOR:"AxisColor",FLAT_COLOR:"FlatColor"},DEPTHCLOUD_STREAMTYPES={VP8:"vp8",MJPEG:"mjpeg"},POINTCLOUD_COLOR_CHANNELS={RGB:"rgb",INTENSITY:"intensity"},AXES={X:"x",Y:"y",Z:"z"},INTENSITY_CHANNEL_OPTIONS=__assign({INTENSITY:"intensity"},AXES),ODOMETRY_OBJECT_TYPES={arrow:OBJECT_TYPE_ARROW,axes:OBJECT_TYPE_AXES},POSE_OBJECT_TYPES={arrow:OBJECT_TYPE_ARROW,axes:OBJECT_TYPE_AXES,flatArrow:OBJECT_TYPE_FLAT_ARROW},WRENCH_OBJECT_TYPES={arrow:OBJECT_TYPE_ARROW,arrowWithCircle:OBJECT_TYPE_ARROW_WITH_CIRCLE},DEFAULT_CYLINDER_HEIGHT=1,DEFAULT_CYLINDER_RADIUS=1,DEFAULT_RADIAL_SEGMENTS=32,DEFAULT_CONE_HEIGHT=1,DEFAULT_CONE_RADIUS=1,DEFAULT_COLOR_X_AXIS="#ff0000",DEFAULT_COLOR_Y_AXIS="#008000",DEFAULT_COLOR_Z_AXIS="#0000ff",DEFAULT_COLOR_ARROW="#f0ff00",DEFAULT_COLOR_LINE="#f0ff00",DEFAULT_OPTIONS_SCENE={backgroundColor:DEFAULT_BACKGROUND_COLOR,gridSize:DEFAULT_GRID_SIZE,gridDivisions:DEFAULT_GRID_DIVISIONS,gridColor:DEFAULT_GRID_COLOR,gridCenterlineColor:DEFAULT_GRID_COLOR_CENTERLINE},DEFAULT_OPTIONS_TF_VIEWER={selectedFrame:""},DEFAULT_OPTIONS_ARROW={shaftLength:1,shaftRadius:.05,headLength:.3,headRadius:.1},DEFAULT_OPTIONS_AXES={axesLength:1,axesRadius:.1},DEFAULT_OPTIONS_FLATARROW={arrowLength:.3},DEFAULT_OPTIONS_DISPLAYTRAJECTORY={robot:new Group$1,loop:!0},DEFAULT_OPTIONS_INTENSITY={channelName:INTENSITY_CHANNEL_OPTIONS.INTENSITY,useRainbow:!1,invertRainbow:!1,minColor:"#000000",maxColor:"#ffffff",autocomputeIntensityBounds:!1,maxIntensity:3730,minIntensity:388},DEFAULT_OPTIONS_COLLISION_OBJECT={},DEFAULT_OPITONS_AXIS_COLOR={axis:AXES.X,autocomputeValueBounds:!1,useFixedFrame:!1,minAxisValue:0,maxAxisValue:0},DEFAULT_OPTIONS_DEPTHCLOUD={streamType:DEPTHCLOUD_STREAMTYPES.MJPEG,f:526,maxDepthPerTile:1,pointSize:3,width:1024,height:1024,whiteness:0,varianceThreshold:16667e-9},DEFAULT_OPTIONS_IMAGE={queueSize:1,width:320,height:240,compression:"cbor"},DEFAULT_OPTIONS_IMAGE_STREAM={width:320,height:240},DEFAULT_OPTIONS_LASERSCAN=__assign(__assign({selectable:!1,style:LASERSCAN_STYLES.FLAT_SQUARES,size:.05,alpha:1,decayTime:0,queueSize:10,compression:"cbor",colorTransformer:COLOR_TRANSFORMERS.INTENSITY,flatColor:"#ffffff"},DEFAULT_OPTIONS_INTENSITY),DEFAULT_OPITONS_AXIS_COLOR),DEFAULT_OPTIONS_MAP={alpha:1,colorScheme:MAP_COLOR_SCHEMES.MAP,compression:"cbor",drawBehind:!1},DEFAULT_OPTIONS_MARKER={queueSize:1,namespaces:[]},DEFAULT_OPTIONS_MARKERARRAY={queueSize:1,namespaces:[],throttleRate:0},DEFAULT_OPTIONS_INTERACTIVE_MARKER={queueSize:1,namespaces:[],throttleRate:0,publishThrottleRate:0,hideOtherHandlesOnSelect:!0,hideOtherControlsInstancesOnSelect:!0},DEFAULT_OPTIONS_ODOMETRY=__assign(__assign(__assign(__assign({type:OBJECT_TYPE_ARROW,color:DEFAULT_COLOR_X_AXIS,alpha:1},DEFAULT_OPTIONS_ARROW),DEFAULT_OPTIONS_AXES),DEFAULT_OPTIONS_FLATARROW),{positionTolerance:.1,angleTolerance:.1,keep:100}),DEFAULT_OPTIONS_PATH={color:"#ffffff",alpha:1},DEFAULT_OPTIONS_PLANNINGSCENE={},DEFAULT_OPTIONS_POINTCLOUD={compression:"cbor",colorChannel:POINTCLOUD_COLOR_CHANNELS.RGB,size:.0125,useRainbow:!0,queueSize:1},DEFAULT_OPTIONS_POINT={color:"#ff0000",alpha:1,radius:.2},DEFAULT_OPTIONS_POLYGON={color:"#ffffff",alpha:1},DEFAULT_OPTIONS_POSE=__assign(__assign(__assign({color:DEFAULT_COLOR_X_AXIS,alpha:1},DEFAULT_OPTIONS_ARROW),DEFAULT_OPTIONS_AXES),{type:POSE_OBJECT_TYPES.arrow}),DEFAULT_OPTIONS_TORUS={circleRadius:.3,tube:.03,radialSegments:16,tubularSegments:100,arc:1.7*Math.PI},DEFAULT_OPTIONS_ARROW_WITH_CIRCLE=__assign(__assign(__assign({},DEFAULT_OPTIONS_ARROW),DEFAULT_OPTIONS_TORUS),{circleConeLength:.1,circleConeRadius:.1}),DEFAULT_OPTIONS_WRENCH=__assign(__assign({forceColor:DEFAULT_COLOR_X_AXIS,torqueColor:DEFAULT_COLOR_ARROW,alpha:1,forceArrowScale:1,torqueArrowScale:1,arrowWidth:1},DEFAULT_OPTIONS_ARROW_WITH_CIRCLE),{type:WRENCH_OBJECT_TYPES.arrow}),DEFAULT_OPTIONS_POSEARRAY=__assign(__assign(__assign(__assign({color:DEFAULT_COLOR_X_AXIS,alpha:1},DEFAULT_OPTIONS_ARROW),DEFAULT_OPTIONS_AXES),DEFAULT_OPTIONS_FLATARROW),{type:POSE_OBJECT_TYPES.arrow}),DEFAULT_OPTIONS_RANGE={color:DEFAULT_COLOR_X_AXIS,alpha:1},DEFAULT_OPTIONS_ROBOTMODEL={},DEFAULT_OPTIONS_TF={},SUPPORTED_MESSAGE_TYPES=[MESSAGE_TYPE_IMAGE,MESSAGE_TYPE_IMAGE2,MESSAGE_TYPE_LASERSCAN,MESSAGE_TYPE_LASERSCAN2,MESSAGE_TYPE_MARKER,MESSAGE_TYPE_MARKER2,MESSAGE_TYPE_MARKERARRAY,MESSAGE_TYPE_MARKERARRAY2,MESSAGE_TYPE_OCCUPANCYGRID,MESSAGE_TYPE_OCCUPANCYGRID2,MESSAGE_TYPE_ODOMETRY,MESSAGE_TYPE_ODOMETRY2,MESSAGE_TYPE_PATH,MESSAGE_TYPE_PATH2,MESSAGE_TYPE_PLANNINGSCENE,MESSAGE_TYPE_POINTCLOUD2,MESSAGE_TYPE_ROS2POINTCLOUD2,MESSAGE_TYPE_POLYGONSTAMPED,MESSAGE_TYPE_POSESTAMPED,MESSAGE_TYPE_POSESTAMPED2,MESSAGE_TYPE_POSEARRAY,MESSAGE_TYPE_POSEARRAY2,MESSAGE_TYPE_POSESTAMPED,MESSAGE_TYPE_POSESTAMPED2,MESSAGE_TYPE_ROBOT_MODEL,MESSAGE_TYPE_TF,MESSAGE_TYPE_ROS2_TF,MESSAGE_TYPE_TF2,MESSAGE_TYPE_ROS2_TF2],UNSUPPORTED_MESSAGE_TYPES=[MESSAGE_TYPE_ACCELSTAMPED,MESSAGE_TYPE_BOUNDINGVOLUME,MESSAGE_TYPE_COMPRESSEDIMAGE,MESSAGE_TYPE_DISPLAYJOINTSTATE,MESSAGE_TYPE_DISPLAYROBOTSTATE,MESSAGE_TYPE_DISPLAYTRAJECTORY,MESSAGE_TYPE_INTERACTIVEMARKER,MESSAGE_TYPE_MAGNETICFIELD,MESSAGE_TYPE_POINTCLOUD,MESSAGE_TYPE_POSECOVARIANCE,MESSAGE_TYPE_RANGE,MESSAGE_TYPE_TWISTSTAMPED,MESSAGE_TYPE_VECTOR3STAMPED,MESSAGE_TYPE_WRENCHSTAMPED],CONSTANTS=Object.freeze({__proto__:null,OBJECT_TYPE_ARROW:OBJECT_TYPE_ARROW,OBJECT_TYPE_ARROW_WITH_CIRCLE:OBJECT_TYPE_ARROW_WITH_CIRCLE,OBJECT_TYPE_AXES:OBJECT_TYPE_AXES,OBJECT_TYPE_FLAT_ARROW:OBJECT_TYPE_FLAT_ARROW,MAX_POINTCLOUD_POINTS:MAX_POINTCLOUD_POINTS,DEFAULT_BACKGROUND_COLOR:DEFAULT_BACKGROUND_COLOR,DEFAULT_GRID_SIZE:DEFAULT_GRID_SIZE,DEFAULT_GRID_DIVISIONS:DEFAULT_GRID_DIVISIONS,DEFAULT_GRID_COLOR:DEFAULT_GRID_COLOR,DEFAULT_GRID_COLOR_CENTERLINE:DEFAULT_GRID_COLOR_CENTERLINE,INTERACTIVE_MARKER_ORIENTATION_MODES:INTERACTIVE_MARKER_ORIENTATION_MODES,UNSUPPORTED_INTERACTIVE_MARKER_ORIENTATION_MODES:UNSUPPORTED_INTERACTIVE_MARKER_ORIENTATION_MODES,INTERACTIVE_MARKER_INTERACTION_MODES:INTERACTIVE_MARKER_INTERACTION_MODES,MESSAGE_TYPE_ROBOT_MODEL:MESSAGE_TYPE_ROBOT_MODEL,MESSAGE_TYPE_ACCELSTAMPED:MESSAGE_TYPE_ACCELSTAMPED,MESSAGE_TYPE_POINTSTAMPED:MESSAGE_TYPE_POINTSTAMPED,MESSAGE_TYPE_POINTSTAMPED2:MESSAGE_TYPE_POINTSTAMPED2,MESSAGE_TYPE_POLYGONSTAMPED:MESSAGE_TYPE_POLYGONSTAMPED,MESSAGE_TYPE_POSEARRAY:MESSAGE_TYPE_POSEARRAY,MESSAGE_TYPE_POSEARRAY2:MESSAGE_TYPE_POSEARRAY2,MESSAGE_TYPE_POSECOVARIANCE:MESSAGE_TYPE_POSECOVARIANCE,MESSAGE_TYPE_POSECOVARIANCE2:MESSAGE_TYPE_POSECOVARIANCE2,MESSAGE_TYPE_POSESTAMPED:MESSAGE_TYPE_POSESTAMPED,MESSAGE_TYPE_POSESTAMPED2:MESSAGE_TYPE_POSESTAMPED2,MESSAGE_TYPE_TWISTSTAMPED:MESSAGE_TYPE_TWISTSTAMPED,MESSAGE_TYPE_VECTOR3STAMPED:MESSAGE_TYPE_VECTOR3STAMPED,MESSAGE_TYPE_WRENCHSTAMPED:MESSAGE_TYPE_WRENCHSTAMPED,MESSAGE_TYPE_WRENCHSTAMPED2:MESSAGE_TYPE_WRENCHSTAMPED2,MESSAGE_TYPE_BOUNDINGVOLUME:MESSAGE_TYPE_BOUNDINGVOLUME,MESSAGE_TYPE_COLLISION_OBJECT:MESSAGE_TYPE_COLLISION_OBJECT,MESSAGE_TYPE_DISPLAYROBOTSTATE:MESSAGE_TYPE_DISPLAYROBOTSTATE,MESSAGE_TYPE_DISPLAYTRAJECTORY:MESSAGE_TYPE_DISPLAYTRAJECTORY,MESSAGE_TYPE_PLANNINGSCENE:MESSAGE_TYPE_PLANNINGSCENE,MESSAGE_TYPE_OCCUPANCYGRID:MESSAGE_TYPE_OCCUPANCYGRID,MESSAGE_TYPE_OCCUPANCYGRID2:MESSAGE_TYPE_OCCUPANCYGRID2,MESSAGE_TYPE_ODOMETRY:MESSAGE_TYPE_ODOMETRY,MESSAGE_TYPE_ODOMETRY2:MESSAGE_TYPE_ODOMETRY2,MESSAGE_TYPE_PATH:MESSAGE_TYPE_PATH,MESSAGE_TYPE_PATH2:MESSAGE_TYPE_PATH2,MESSAGE_TYPE_COMPRESSEDIMAGE:MESSAGE_TYPE_COMPRESSEDIMAGE,MESSAGE_TYPE_DISPLAYJOINTSTATE:MESSAGE_TYPE_DISPLAYJOINTSTATE,MESSAGE_TYPE_IMAGE:MESSAGE_TYPE_IMAGE,MESSAGE_TYPE_IMAGE2:MESSAGE_TYPE_IMAGE2,MESSAGE_TYPE_LASERSCAN:MESSAGE_TYPE_LASERSCAN,MESSAGE_TYPE_LASERSCAN2:MESSAGE_TYPE_LASERSCAN2,MESSAGE_TYPE_MAGNETICFIELD:MESSAGE_TYPE_MAGNETICFIELD,MESSAGE_TYPE_POINTCLOUD:MESSAGE_TYPE_POINTCLOUD,MESSAGE_TYPE_POINTCLOUD2:MESSAGE_TYPE_POINTCLOUD2,MESSAGE_TYPE_ROS2POINTCLOUD2:MESSAGE_TYPE_ROS2POINTCLOUD2,MESSAGE_TYPE_RANGE:MESSAGE_TYPE_RANGE,MESSAGE_TYPE_RANGE2:MESSAGE_TYPE_RANGE2,MESSAGE_TYPE_TF:MESSAGE_TYPE_TF,MESSAGE_TYPE_ROS2_TF:MESSAGE_TYPE_ROS2_TF,MESSAGE_TYPE_TF2:MESSAGE_TYPE_TF2,MESSAGE_TYPE_ROS2_TF2:MESSAGE_TYPE_ROS2_TF2,MESSAGE_TYPE_MARKER:MESSAGE_TYPE_MARKER,MESSAGE_TYPE_MARKER2:MESSAGE_TYPE_MARKER2,MESSAGE_TYPE_MARKERARRAY:MESSAGE_TYPE_MARKERARRAY,MESSAGE_TYPE_MARKERARRAY2:MESSAGE_TYPE_MARKERARRAY2,MESSAGE_TYPE_INTERACTIVEMARKER:MESSAGE_TYPE_INTERACTIVEMARKER,MESSAGE_TYPE_INTERACTIVEMARKER2:MESSAGE_TYPE_INTERACTIVEMARKER2,MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE:MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE,MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE2:MESSAGE_TYPE_INTERACTIVEMARKER_UPDATE2,MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK:MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK,MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK2:MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK2,VIZ_TYPE_IMAGE:VIZ_TYPE_IMAGE,VIZ_TYPE_INTERACTIVEMARKER:VIZ_TYPE_INTERACTIVEMARKER,VIZ_TYPE_LASERSCAN:VIZ_TYPE_LASERSCAN,VIZ_TYPE_MAP:VIZ_TYPE_MAP,VIZ_TYPE_MARKER:VIZ_TYPE_MARKER,VIZ_TYPE_MARKERARRAY:VIZ_TYPE_MARKERARRAY,VIZ_TYPE_ODOMETRY:VIZ_TYPE_ODOMETRY,VIZ_TYPE_PATH:VIZ_TYPE_PATH,VIZ_TYPE_POINT:VIZ_TYPE_POINT,VIZ_TYPE_POINTCLOUD:VIZ_TYPE_POINTCLOUD,VIZ_TYPE_POLYGON:VIZ_TYPE_POLYGON,VIZ_TYPE_POSE:VIZ_TYPE_POSE,VIZ_TYPE_POSEARRAY:VIZ_TYPE_POSEARRAY,VIZ_TYPE_RANGE:VIZ_TYPE_RANGE,VIZ_TYPE_ROBOTMODEL:VIZ_TYPE_ROBOTMODEL,VIZ_TYPE_TF:VIZ_TYPE_TF,VIZ_TYPE_WRENCH:VIZ_TYPE_WRENCH,POINT_FIELD_DATATYPES:POINT_FIELD_DATATYPES,COLLISION_OBJECT_OPERATIONS:COLLISION_OBJECT_OPERATIONS,SOLID_PRIMITIVE_TYPES:SOLID_PRIMITIVE_TYPES,MARKER_OBJECT_TYPES:MARKER_OBJECT_TYPES,LINE_STYLES:LINE_STYLES,MAP_COLOR_SCHEMES:MAP_COLOR_SCHEMES,LASERSCAN_STYLES:LASERSCAN_STYLES,COLOR_TRANSFORMERS:COLOR_TRANSFORMERS,POINTCLOUD_COLOR_CHANNELS:POINTCLOUD_COLOR_CHANNELS,AXES:AXES,INTENSITY_CHANNEL_OPTIONS:INTENSITY_CHANNEL_OPTIONS,ODOMETRY_OBJECT_TYPES:ODOMETRY_OBJECT_TYPES,POSE_OBJECT_TYPES:POSE_OBJECT_TYPES,WRENCH_OBJECT_TYPES:WRENCH_OBJECT_TYPES,DEFAULT_CYLINDER_HEIGHT:DEFAULT_CYLINDER_HEIGHT,DEFAULT_CYLINDER_RADIUS:DEFAULT_CYLINDER_RADIUS,DEFAULT_RADIAL_SEGMENTS:DEFAULT_RADIAL_SEGMENTS,DEFAULT_CONE_HEIGHT:DEFAULT_CONE_HEIGHT,DEFAULT_CONE_RADIUS:DEFAULT_CONE_RADIUS,DEFAULT_COLOR_X_AXIS:DEFAULT_COLOR_X_AXIS,DEFAULT_COLOR_Y_AXIS:DEFAULT_COLOR_Y_AXIS,DEFAULT_COLOR_Z_AXIS:DEFAULT_COLOR_Z_AXIS,DEFAULT_COLOR_ARROW:DEFAULT_COLOR_ARROW,DEFAULT_COLOR_LINE:DEFAULT_COLOR_LINE,DEFAULT_OPTIONS_SCENE:DEFAULT_OPTIONS_SCENE,DEFAULT_OPTIONS_TF_VIEWER:DEFAULT_OPTIONS_TF_VIEWER,DEFAULT_OPTIONS_ARROW:DEFAULT_OPTIONS_ARROW,DEFAULT_OPTIONS_AXES:DEFAULT_OPTIONS_AXES,DEFAULT_OPTIONS_FLATARROW:DEFAULT_OPTIONS_FLATARROW,DEFAULT_OPTIONS_DISPLAYTRAJECTORY:DEFAULT_OPTIONS_DISPLAYTRAJECTORY,DEFAULT_OPTIONS_COLLISION_OBJECT:DEFAULT_OPTIONS_COLLISION_OBJECT,DEFAULT_OPTIONS_DEPTHCLOUD:DEFAULT_OPTIONS_DEPTHCLOUD,DEFAULT_OPTIONS_IMAGE:DEFAULT_OPTIONS_IMAGE,DEFAULT_OPTIONS_IMAGE_STREAM:DEFAULT_OPTIONS_IMAGE_STREAM,DEFAULT_OPTIONS_LASERSCAN:DEFAULT_OPTIONS_LASERSCAN,DEFAULT_OPTIONS_MAP:DEFAULT_OPTIONS_MAP,DEFAULT_OPTIONS_MARKER:DEFAULT_OPTIONS_MARKER,DEFAULT_OPTIONS_MARKERARRAY:DEFAULT_OPTIONS_MARKERARRAY,DEFAULT_OPTIONS_INTERACTIVE_MARKER:DEFAULT_OPTIONS_INTERACTIVE_MARKER,DEFAULT_OPTIONS_ODOMETRY:DEFAULT_OPTIONS_ODOMETRY,DEFAULT_OPTIONS_PATH:DEFAULT_OPTIONS_PATH,DEFAULT_OPTIONS_PLANNINGSCENE:DEFAULT_OPTIONS_PLANNINGSCENE,DEFAULT_OPTIONS_POINTCLOUD:DEFAULT_OPTIONS_POINTCLOUD,DEFAULT_OPTIONS_POINT:DEFAULT_OPTIONS_POINT,DEFAULT_OPTIONS_POLYGON:DEFAULT_OPTIONS_POLYGON,DEFAULT_OPTIONS_POSE:DEFAULT_OPTIONS_POSE,DEFAULT_OPTIONS_TORUS:DEFAULT_OPTIONS_TORUS,DEFAULT_OPTIONS_ARROW_WITH_CIRCLE:DEFAULT_OPTIONS_ARROW_WITH_CIRCLE,DEFAULT_OPTIONS_WRENCH:DEFAULT_OPTIONS_WRENCH,DEFAULT_OPTIONS_POSEARRAY:DEFAULT_OPTIONS_POSEARRAY,DEFAULT_OPTIONS_RANGE:DEFAULT_OPTIONS_RANGE,DEFAULT_OPTIONS_ROBOTMODEL:DEFAULT_OPTIONS_ROBOTMODEL,DEFAULT_OPTIONS_TF:DEFAULT_OPTIONS_TF,SUPPORTED_MESSAGE_TYPES:SUPPORTED_MESSAGE_TYPES,UNSUPPORTED_MESSAGE_TYPES:UNSUPPORTED_MESSAGE_TYPES}),checkToleranceThresholdExceed=function(e,t,o){var a=o.angleTolerance,r=o.positionTolerance,i=t.position,n=t.quaternion,s=e.position,l=e.quaternion,d=s.distanceTo(i)>r,p=l.angleTo(n)>a;return d||p},setObjectDimension=function(e,t){switch(t.type){case OBJECT_TYPE_ARROW:{var o=t.alpha,a=t.color,r=t.headLength,i=t.headRadius,n=t.shaftLength,s=t.shaftRadius;e.setHeadDimensions({radius:i,length:r}),e.setShaftDimensions({radius:s,length:n}),e.setAlpha(o),e.setColor({cone:new Color(a),cylinder:new Color(a)});break}case OBJECT_TYPE_AXES:{var l=t.axesLength,d=t.axesRadius;e.setLength(l),e.setRadius(d);break}case OBJECT_TYPE_FLAT_ARROW:{var p=t.arrowLength,c=t.color;e.setLength(p),e.setColor(new Color(c));break}case OBJECT_TYPE_ARROW_WITH_CIRCLE:var m=t.alpha,u=t.circleConeLength,h=t.circleConeRadius,g=t.circleRadius,y=t.color,b=t.headLength,f=t.headRadius,E=t.shaftLength,v=t.shaftRadius,T=t.tube;e.setHeadDimensions({radius:f,length:b}),e.setShaftDimensions({radius:v,length:E}),e.setTorusDimensions({radius:g,tube:T}),e.setCircleConeDimensions({radius:h,length:u}),e.setAlpha(m),e.setColor({cone:new Color(y),cylinder:new Color(y),torus:new Color(y),circleCone:new Color(y)});}};function assertIsDefined(e){if(e===void 0||null===e)throw new TypeError("Expected 'val' to be defined, but received "+e)}function assertIsMesh(e){if(!(e instanceof Mesh$1))throw new TypeError("Expected 'val' to be mesh")}function assertIsMaterial(e){if(!(e instanceof Material))throw new TypeError("Expected 'val' to be Material")}function assertIsMeshBasicMaterial(e){if(!(e instanceof MeshBasicMaterial))throw new TypeError("Expected 'val' to be MeshBasicMaterial")}function assertIsMaterialWithColor(e){if(!("color"in e))throw new TypeError("Expected 'val' to be MeshBasicMaterial with color")}function assertBehavesLikeArray(e){if(e.length===void 0)throw new TypeError("Expected 'val' to be an array")}function isObject3D(e){return e instanceof Object3D}function isHTMLElement(e){return e instanceof HTMLElement}function assertIsTorusGeometry(e){if(!(e instanceof TorusGeometry))throw new Error("the provided geometry was not TorusGeometry")}function assertIsHTMLVideoElement(e){if(!(e instanceof HTMLVideoElement))throw new Error("the provided element must be an HTMLVideoElement")}function assertIsBufferGeometry(e){if(!(e instanceof BufferGeometry))throw new Error("the provided attribute must be an BufferGeometry")}function assertIsBufferAttribute(e){if(!(e instanceof BufferAttribute))throw new Error("the provided attribute must be an BufferAttribute")}var LegacyCore=function(){function e(e,t,o,a){void 0===a&&(a={});var r=a.onHeaderChange;this.options=a,this.ros=e,this.headerFrameId="",e&&t&&this.changeTopic(t,o,!1),this.onHeaderChange=r||function(){},this.update=this.update.bind(this)}return e.prototype.hide=function(){assertIsDefined(this.object),this.object.visible=!1},e.prototype.show=function(){assertIsDefined(this.object),this.object.visible=!0},e.prototype.destroy=function(){this.unsubscribe(),this.object&&this.object.parent&&(this.object.parent.remove(this.object),this.object=null)},e.prototype.reset=function(){},e.prototype.subscribe=function(){var e=this;this.dataSourceInstances&&this.dataSourceInstances.forEach(function(o){var t={next:e.update,error:function(e){return console.log(e)},complete:function(){return console.log("stream complete")}};o.addListener(t)})},e.prototype.unsubscribe=function(){this.dataSourceInstances&&this.dataSourceInstances.forEach(function(e){e.removeAllListeners()})},e.prototype.update=function(e){var t=e.header?e.header.frame_id:"";t!==this.headerFrameId&&(this.headerFrameId=t,this.onHeaderChange(this.headerFrameId))},e.prototype.updateOptions=function(e){this.options=__assign(__assign({},this.options),e)},e.prototype.changeTopic=function(e,t,o){var a=this;void 0===o&&(o=!0);var r=this.options,i=r.compression,n=r.queueSize,s=r.throttleRate;o&&this.unsubscribe(),this.topicName=e,this.messageType=t||this.messageType,this.dataSourceInstances=(Array.isArray(e)?e:[{name:e,messageType:t}]).map(function(e){var t=e.name,o=e.messageType;return new RosTopicDataSource({ros:a.ros,topicName:t,messageType:o,compression:i||"none",throttleRate:s||0,queueSize:n||10})}),o&&(this.reset(),this.subscribe())},e}(),setTransform=function(e,t){var o=t.translation,a=o.x,r=o.y,i=o.z,n=t.rotation,s=n.w,l=n.x,d=n.y,p=n.z;e.position.set(a,r,i),e.quaternion.copy(new Quaternion(l,d,p,s).normalize())},setScale=function(e,t){var o=t.x,a=t.y,r=t.z;e.scale.set(o,a,r)},setColor=function(e,t){assertIsMaterialWithColor(e.material),"string"==typeof t||"number"==typeof t?e.material.color=new Color(t):e.material.color.setRGB(t.r,t.g,t.b)},Group=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setTransform=function(e){setTransform(this,e)},t.prototype.setScale=function(e){setScale(this,e)},t.prototype.setColor=function(e){this.children.forEach(function(t){setColor(t,e)})},t}(Group$1),Mesh=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.setTransform=function(e){setTransform(this,e)},t.prototype.setScale=function(e){e&&setScale(this,e)},t.prototype.setColor=function(e){e&&setColor(this,e)},t.prototype.setAlpha=function(e){if(Array.isArray(this.material))this.material.forEach(function(t){t.opacity=MathUtils.clamp(e,0,1)});else{debugger;this.material.opacity=MathUtils.clamp(e,0,1)}},t}(Mesh$1),Box=function(e){function t(){var t=e.call(this)||this;return t.geometry=new BoxGeometry,t.material=new MeshStandardMaterial,t}return __extends(t,e),t}(Mesh),CollisionObject=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_COLLISION_OBJECT);var r=e.call(this,null!==t&&void 0!==t?t:null,null!==o&&void 0!==o?o:null,MESSAGE_TYPE_COLLISION_OBJECT,__assign(__assign({},DEFAULT_OPTIONS_COLLISION_OBJECT),a))||this;return r.object=new Group,r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_COLLISION_OBJECT),a)),r}return __extends(t,e),t.prototype.update=function(o){var a,r;e.prototype.update.call(this,o);var i=o.id,n=o.operation,s=o.primitive_poses,l=o.primitives,d=this.object.getObjectByName(i);switch(n){case COLLISION_OBJECT_OPERATIONS.ADD:{d&&(null===(a=d.parent)||void 0===a?void 0:a.remove(d));var p=new Group;p.name=i,l.forEach(function(e,o){var a=t.getNewPrimitive(e);null===a||void 0===a?void 0:a.setTransform({translation:s[o].position,rotation:s[o].orientation}),a&&p.add(a)}),this.object.add(p);break}case COLLISION_OBJECT_OPERATIONS.REMOVE:{d&&(null===(r=d.parent)||void 0===r?void 0:r.remove(d));break}case COLLISION_OBJECT_OPERATIONS.APPEND:{l.forEach(function(e,o){var a=t.getNewPrimitive(e);null===a||void 0===a?void 0:a.setTransform({translation:s[o].position,rotation:s[o].orientation}),a&&(null===d||void 0===d?void 0:d.add(a))});break}}},t.getNewPrimitive=function(e){var t=e.type,o=e.dimensions;switch(t){case SOLID_PRIMITIVE_TYPES.BOX:var a=new Box,r=__read(o,3),i=r[0],n=r[1],s=r[2];return a.setScale({x:i,y:n,z:s}),a;default:return null;}},t}(LegacyCore),DisplayTrajectory=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_DISPLAYTRAJECTORY);var r=e.call(this,t,o,MESSAGE_TYPE_DISPLAYTRAJECTORY,a)||this;r.pointsUpdateIds=[],r.object=new Group,r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_DISPLAYTRAJECTORY),a));var i=r.options.robot;return r.robotClone=i.clone(!0),Object.keys(r.robotClone.links).forEach(function(e){var t=r.robotClone.links[e];t.traverse(function(e){e.material&&(e.material=new MeshPhongMaterial({color:"#ff0000"}))})}),r}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),t.loop&&this.lastMessage?this.update(this.lastMessage,!0):this.resetLoopback()},t.prototype.resetLoopback=function(){clearTimeout(this.loopbackId),clearTimeout(this.poseRemovalId),this.pointsUpdateIds&&this.pointsUpdateIds.map(function(e){return clearTimeout(e)}),this.pointsUpdateIds=[],this.robotClone&&this.robotClone.parent&&this.robotClone.parent.remove(this.robotClone)},t.prototype.update=function(t,o){var a,r=this,i=this.options.loop;this.resetLoopback(),o||(this.lastMessage=t),e.prototype.update.call(this,t);var n=__read(t.trajectory,1),s=n[0].joint_trajectory,l=s.joint_names,d=s.points,p=t.trajectory_start.joint_state,c=p.name,m=p.position;if(null===(a=this.object)||void 0===a?void 0:a.add(this.robotClone),c.forEach(function(e,t){var o=r.robotClone.getObjectByName(e);o&&o.setAngle(m[t])}),d.forEach(function(e){var t=e.positions,o=e.time_from_start,a=o.nsec,i=o.secs;r.pointsUpdateIds.push(window.setTimeout(function(){l.forEach(function(e,o){var a=r.robotClone.getObjectByName(e);a&&a.setAngle(t[o])})},1e3*i+a/1e6))}),0<d.length){var u=d[d.length-1].time_from_start,h=u.nsec,g=u.secs;this.poseRemovalId=window.setTimeout(function(){var e;null===(e=r.robotClone.parent)||void 0===e?void 0:e.remove(r.robotClone),i&&(r.loopbackId=window.setTimeout(function(){r.lastMessage&&r.update(r.lastMessage,!0)},1e3))},1e3*g+h/1e6)}},t}(LegacyCore),PlanningScene=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_PLANNINGSCENE);var r=e.call(this,t,o,MESSAGE_TYPE_PLANNINGSCENE,__assign(__assign({},DEFAULT_OPTIONS_PLANNINGSCENE),a))||this;return r.collisionObjectViz=new CollisionObject,r.attachedCollisionObjects=new Map,r.object=new Group,r.object.add(r.collisionObjectViz.object),r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_PLANNINGSCENE),a)),r}return __extends(t,e),t.prototype.update=function(t){var o,a,r=this;e.prototype.update.call(this,t);var i=t.robot_state,n=i.attached_collision_objects,s=void 0===n?[]:n,l=i.is_diff,d=i.joint_state,p=d.name,c=d.position,m=t.world.collision_objects;if(m.forEach(function(e){r.collisionObjectViz.update(e)}),s.length&&s.map(function(e){var t,o=e.link_name,a=e.object,i=new CollisionObject,n=null===(t=r.object)||void 0===t?void 0:t.getObjectByName(o);assertIsDefined(n),i.object=n,i.update(a),r.attachedCollisionObjects.set(a.id,i)}),!l){var u=s.map(function(e){var t=e.object.id;return t});try{for(var h=__values(this.attachedCollisionObjects.entries()),g=h.next();!g.done;g=h.next()){var y=__read(g.value,2),b=y[0],f=y[1];-1===u.indexOf(b)&&(f.update({id:b,operation:COLLISION_OBJECT_OPERATIONS.REMOVE}),this.attachedCollisionObjects.delete(b))}}catch(e){o={error:e}}finally{try{g&&!g.done&&(a=h.return)&&a.call(h)}finally{if(o)throw o.error}}}p.forEach(function(e,t){var o,a=null===(o=r.object)||void 0===o?void 0:o.getObjectByName(e);a&&a.setAngle(c[t])})},t}(LegacyCore),Cylinder=function(e){var t=Math.PI;function o(o,a,r){void 0===o&&(o=DEFAULT_COLOR_ARROW),void 0===a&&(a=DEFAULT_CYLINDER_RADIUS),void 0===r&&(r=DEFAULT_CYLINDER_HEIGHT);var i=e.call(this)||this;return i.geometry=new CylinderGeometry(a,a,r,DEFAULT_RADIAL_SEGMENTS),i.material=new MeshStandardMaterial({color:o}),i.material.transparent=!0,i.rotateX(t/2),i}return __extends(o,e),o}(Mesh),Cone=function(e){function t(t){void 0===t&&(t=DEFAULT_COLOR_X_AXIS);var o=e.call(this)||this;return o.geometry=new ConeGeometry(DEFAULT_CONE_RADIUS,DEFAULT_CONE_HEIGHT,DEFAULT_RADIAL_SEGMENTS),o.material=new MeshStandardMaterial({color:t}),o.material.transparent=!0,o}return __extends(t,e),t}(Mesh),Arrow=function(e){var t=Math.PI;function o(){var o=e.call(this)||this;return o.cone=new Cone(DEFAULT_COLOR_X_AXIS),o.cylinder=new Cylinder(DEFAULT_COLOR_X_AXIS),o.cone.rotateZ(-t/2),o.cylinder.rotateZ(-t/2),o.cone.setScale({x:DEFAULT_CONE_RADIUS,y:DEFAULT_CONE_HEIGHT,z:DEFAULT_CONE_RADIUS}),o.cylinder.setScale({x:DEFAULT_CYLINDER_RADIUS,y:DEFAULT_CYLINDER_HEIGHT,z:DEFAULT_CYLINDER_RADIUS}),o.cylinder.translateY(o.cylinder.scale.y/2),o.cone.translateY(o.cylinder.scale.y+o.cone.scale.y/2),o.add(o.cone),o.add(o.cylinder),o}return __extends(o,e),o.prototype.setTransform=function(e){setTransform(this,e)},o.prototype.setColor=function(e){var t=e.cone,o=e.cylinder;t&&this.cone.setColor(t),o&&this.cylinder.setColor(o)},o.prototype.setHeadDimensions=function(e){var t=e.radius,o=e.length;if(t){var a=this.cone.scale.y;this.cone.setScale({x:t,y:a,z:t})}if(o){var r=this.cone.scale,i=r.x,n=r.z;this.cone.setScale({x:i,y:o,z:n}),this.cone.position.set(0,0,0),this.cone.translateY(this.cylinder.scale.y+o/2)}},o.prototype.setShaftDimensions=function(e){var t=e.radius,o=e.length;if(t){var a=this.cylinder.scale.y;this.cylinder.setScale({x:t,y:a,z:t})}if(o){var r=this.cylinder.scale,i=r.x,n=r.z;this.cylinder.setScale({x:i,y:o,z:n}),this.cylinder.position.set(0,0,0),this.cylinder.translateY(o/2),this.setHeadDimensions({length:this.cone.scale.y})}},o.prototype.setAlpha=function(e){this.cylinder.setAlpha(e),this.cone.setAlpha(e)},o.prototype.setScale=function(e){var t=e.x,o=__read([t/2,t/2],2),a=o[0],r=o[1];setScale(this,{x:t,y:a,z:r})},o}(Group$1),Axes=function(e){var t=Math.PI;function o(o,a){void 0===o&&(o=DEFAULT_CYLINDER_RADIUS),void 0===a&&(a=DEFAULT_CYLINDER_HEIGHT);var r=e.call(this)||this;return r.objectType=OBJECT_TYPE_AXES,r.x=new Cylinder(DEFAULT_COLOR_X_AXIS,o,a),r.y=new Cylinder(DEFAULT_COLOR_Y_AXIS,o,a),r.z=new Cylinder(DEFAULT_COLOR_Z_AXIS,o,a),r.x.translateX(a/2),r.y.translateZ(-a/2),r.z.translateY(a/2),r.x.rotateZ(-t/2),r.y.rotateX(t/2),r.add(r.x),r.add(r.y),r.add(r.z),r}return __extends(o,e),o.prototype.setLength=function(e){var t=+(""+e);[this.x,this.y,this.z].forEach(function(e){e.position.set(0,0,0),e.scale.setY(t)}),this.x.translateY(t/2),this.y.translateY(-t/2),this.z.translateY(t/2)},o.prototype.setRadius=function(e){var t=+(""+e);this.children.forEach(function(e){e.scale.setX(t),e.scale.setZ(t)})},o}(Group),Line=function(e){function t(t,o){void 0===t&&(t=DEFAULT_COLOR_LINE),void 0===o&&(o=!1);var a=e.call(this)||this;a.geometry=new Geometry,a.geometry.vertices.push(new Vector3(0,0,0));var r={};return o||(r.vertexColors=VertexColors),a.material=new LineBasicMaterial(__assign({},r)),a.material.transparent=!0,a.setColor(t),a}return __extends(t,e),t.prototype.setColor=function(e){e&&setColor(this,e)},t.prototype.updatePoints=function(e,t){void 0===t&&(t=[]),this.geometry.vertices=e.map(function(e){var t=e.x,o=e.y,a=e.z;return new Vector3(t,o,a)}),this.geometry.verticesNeedUpdate=!0;var o=[];t.forEach(function(e){if("string"==typeof e||"number"==typeof e)o.push(new Color(e));else if(e){var t=e.r,a=e.g,r=e.b;o.push(new Color(t,a,r))}}),this.geometry.colors=o,this.geometry.colorsNeedUpdate=!0},t.prototype.setTransform=function(e){setTransform(this,e)},t.prototype.setAlpha=function(e){assertIsMaterial(this.material),this.material.opacity=e},t}(Line$1),LineArrow=function(e){function t(){var t=e.call(this)||this;return t.objectType=OBJECT_TYPE_FLAT_ARROW,t.arrowTop=new Line(16711680,!0),t.topPoints=[],t.arrowLength=new Line(16711680,!0),t.topPoints.push(new Vector3(2,1,0)),t.topPoints.push(new Vector3(3,0,0)),t.topPoints.push(new Vector3(2,-1,0)),t.arrowTop.updatePoints(t.topPoints),t.add(t.arrowTop),t.arrowLength.updatePoints([new Vector3(0,0,0),new Vector3(3,0,0)]),t.add(t.arrowLength),t.scale.set(.1,.1,.1),t}return __extends(t,e),t.prototype.setLength=function(e){this.scale.set(e,e,e)},t.prototype.setColor=function(e){var t=e.r,o=e.g,a=e.b;this.arrowTop.material.color.setRGB(t,o,a),this.arrowLength.material.color.setRGB(t,o,a)},t}(Group),LiveCore=function(){function e(e){var t,o=this;this.onHeaderChange=function(e){},this.headerFrameId="",this.hide=function(){assertIsDefined(o.object),isObject3D(o.object)?o.object.visible=!1:isHTMLElement(o.object)&&(o.object.style.visibility="hidden")},this.show=function(){assertIsDefined(o.object),isObject3D(o.object)?o.object.visible=!0:isHTMLElement(o.object)&&(o.object.style.visibility="visible")},this.destroy=function(){var e,t,a,r;o.unsubscribe(),isObject3D(o.object)?null===(t=null===(e=o.object)||void 0===e?void 0:e.parent)||void 0===t?void 0:t.remove(o.object):isHTMLElement(o.object)&&(null===(r=null===(a=o.object)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.removeChild(o.object)),o.object=void 0},this.reset=function(){},this.subscribe=function(){o.sources.forEach(function(e){var t={next:o.update,error:function(e){return console.log(e)},complete:function(){}};e.addListener(t)})},this.unsubscribe=function(){o.sources.forEach(function(e){e.removeAllListeners()})},this.sources=e.sources,this.options=null!==(t=e.options)&&void 0!==t?t:{},this.update=this.update.bind(this),this.updateOptions=this.updateOptions.bind(this)}return e.prototype.update=function(e){var t,o,a=null!==(o=null===(t=e.header)||void 0===t?void 0:t.frame_id)&&void 0!==o?o:"";a!==this.headerFrameId&&(this.headerFrameId=a,this.onHeaderChange(this.headerFrameId))},e.prototype.updateOptions=function(e){this.options=__assign(__assign({},this.options),e)},e.prototype.changeSources=function(e){this.unsubscribe(),this.sources=e,this.subscribe()},e}(),Pose=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_POSE);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_POSE),o)})||this;return a.object=new Group$1,a.primitive=null,a.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_POSE),o)),a}return __extends(t,e),t.getNewPrimitive=function(e){var t=e.type,o=null;return t===POSE_OBJECT_TYPES.arrow?o=new Arrow:t===POSE_OBJECT_TYPES.axes?o=new Axes:t===POSE_OBJECT_TYPES.flatArrow?o=new LineArrow:void 0,o},t.prototype.updateOptions=function(o){var a,r,i;e.prototype.updateOptions.call(this,o);var n=this.options.type;if((null===(a=this.primitive)||void 0===a?void 0:a.type)!==n&&(null===(r=this.object)||void 0===r?void 0:r.remove(this.primitive),this.primitive=null),!this.primitive){var s=t.getNewPrimitive(this.options);s&&(this.primitive=s,null===(i=this.object)||void 0===i?void 0:i.add(this.primitive))}setObjectDimension(this.primitive,this.options)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.pose,r=a.orientation,i=a.position;null===(o=this.primitive)||void 0===o?void 0:o.setTransform({translation:i,rotation:r})},t}(LiveCore),ArrowWithCircle=function(e){var t=Math.sin,o=Math.cos,a=Math.PI;function r(){var r=e.call(this)||this;r.circleCone=new Cone(DEFAULT_COLOR_X_AXIS),r.material=new MeshStandardMaterial({color:r.cone.material.color}),r.add(r.circleCone),r.material.transparent=!0;var i=DEFAULT_OPTIONS_TORUS,n=new TorusGeometry(i.circleRadius,i.tube,i.radialSegments,i.tubularSegments,i.arc);return r.torus=new Mesh(n,r.material),r.add(r.torus),r.circleCone.rotateX(n.parameters.arc),r.circleCone.translateZ(-o(-n.parameters.arc)*n.parameters.radius),r.circleCone.translateY(-t(-n.parameters.arc)*n.parameters.radius),r.circleCone.translateX(r.cylinder.scale.y/2),r.torus.translateX(r.cylinder.scale.y/2),r.torus.rotateY(a/2),r}return __extends(r,e),r.prototype.setTorusDimensions=function(e){var t=e.radius,o=e.tube,r=DEFAULT_OPTIONS_TORUS;this.torus.geometry=new TorusGeometry(t,o,r.radialSegments,r.tubularSegments,r.arc),this.torus.position.set(0,0,0),this.torus.rotation.set(0,0,0),this.torus.translateX(this.cylinder.scale.y/2),this.torus.rotateY(a/2)},r.prototype.setCircleConeDimensions=function(e){var a=e.radius,r=e.length,i=+(""+a),n=+(""+r);if(assertIsTorusGeometry(this.torus.geometry),i){var s=this.circleCone.scale.y;this.circleCone.setScale({x:a,y:s,z:a})}if(n){var l=this.circleCone.scale,d=l.x,p=l.z;this.circleCone.setScale({x:d,y:n,z:p})}this.circleCone.position.set(0,0,0),this.circleCone.rotation.set(0,0,0),this.circleCone.translateX(this.cylinder.scale.y/2),this.circleCone.translateZ(-o(-this.torus.geometry.parameters.arc)*this.torus.geometry.parameters.radius),this.circleCone.translateY(-t(-this.torus.geometry.parameters.arc)*this.torus.geometry.parameters.radius),this.circleCone.rotateX(this.torus.geometry.parameters.arc)},r.prototype.setColor=function(e){var t=e.cone,o=e.cylinder,a=e.torus,r=e.circleCone;t&&this.cone.setColor(t),o&&this.cylinder.setColor(o),a&&setColor(this.torus,this.cone.material.color),r&&this.circleCone.setColor(r)},r.prototype.setAlpha=function(t){e.prototype.setAlpha.call(this,t),assertIsMaterial(this.torus.material),this.torus.material.opacity=MathUtils.clamp(t,0,1),this.circleCone.setAlpha(t)},r}(Arrow),Wrench=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_WRENCH);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_WRENCH),o)})||this;return a.primitiveX=null,a.primitiveY=null,a.object=new Group$1,a}return __extends(t,e),t.getNewPrimitive=function(e){var t=e.type,o=null;return t===WRENCH_OBJECT_TYPES.arrow?o=new Arrow:t===WRENCH_OBJECT_TYPES.arrowWithCircle?o=new ArrowWithCircle:void 0,o},t.prototype.getOrUpdatePrimitive=function(e,o){var a,r,i=null===e||(null===e||void 0===e?void 0:e.type)!==o;if(i){e&&(null===(a=this.object)||void 0===a?void 0:a.remove(e));var n=t.getNewPrimitive({type:o});return n&&(null===(r=this.object)||void 0===r?void 0:r.add(n)),n}return e},t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.primitiveX=this.getOrUpdatePrimitive(this.primitiveX,WRENCH_OBJECT_TYPES.arrow),this.primitiveY=this.getOrUpdatePrimitive(this.primitiveY,WRENCH_OBJECT_TYPES.arrowWithCircle);var o={color:this.options.forceColor,alpha:this.options.alpha,headLength:this.options.headLength*this.options.forceArrowScale,headRadius:this.options.headRadius*this.options.arrowWidth,shaftLength:this.options.shaftLength*this.options.forceArrowScale,shaftRadius:this.options.shaftRadius*this.options.arrowWidth,type:WRENCH_OBJECT_TYPES.arrow},a={color:this.options.torqueColor,alpha:this.options.alpha,arc:this.options.arc,circleConeRadius:this.options.circleConeRadius*this.options.arrowWidth,circleConeLength:this.options.circleConeLength*this.options.arrowWidth,circleRadius:this.options.circleRadius*this.options.torqueArrowScale,headLength:this.options.headLength*this.options.torqueArrowScale,headRadius:this.options.headRadius*this.options.arrowWidth,shaftLength:this.options.shaftLength*this.options.torqueArrowScale,shaftRadius:this.options.shaftRadius*this.options.arrowWidth,tube:this.options.tube*this.options.arrowWidth,tubularSegments:this.options.tubularSegments,type:WRENCH_OBJECT_TYPES.arrowWithCircle};setObjectDimension(this.primitiveX,o),setObjectDimension(this.primitiveY,a)},t.prototype.update=function(t){var o,a;e.prototype.update.call(this,t);var r=t.wrench,i=r.force,n=r.torque,s=new Vector3(1,0,0),l=new Vector3(i.x,i.y,i.z).normalize(),d=new Vector3(n.x,n.y,n.z).normalize(),p=new Quaternion().setFromUnitVectors(s,l),c=new Quaternion().setFromUnitVectors(s,d);null===(o=this.primitiveX)||void 0===o?void 0:o.setTransform({translation:{y:0,x:0,z:0},rotation:p}),null===(a=this.primitiveY)||void 0===a?void 0:a.setTransform({translation:{y:0,x:0,z:0},rotation:c})},t}(LiveCore),Polygon=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_POLYGON);var r=e.call(this,t,o,MESSAGE_TYPE_POLYGONSTAMPED,__assign(__assign({},DEFAULT_OPTIONS_POLYGON),a))||this;return r.object=new Group,r.line=new Line(null,!0),r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_POLYGON),a)),r}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t);var o=this.options,a=o.alpha,r=o.color;this.line.setColor(new Color(r)),this.line.setAlpha(a)},t.prototype.update=function(t){e.prototype.update.call(this,t);var o=t.polygon.points;o.push(o[0]),this.line.updatePoints(o),this.object.add(this.line)},t}(LegacyCore),Text=function(e){var t=Math.PI;function o(o){var a=e.call(this)||this;a.geometry=new Geometry,a.material=new Material;var r=new FontLoader;return a.material=new MeshBasicMaterial({color:14540253}),r.load("https://raw.githubusercontent.com/mrdoob/three.js/dev/examples/fonts/helvetiker_regular.typeface.json",function(e){a.geometry=new TextGeometry(o,{font:e,size:.05,height:.005,curveSegments:12,bevelEnabled:!1,bevelThickness:10,bevelSize:8,bevelSegments:5})}),a.rotateX(t/2),a.rotateY(Math.PI),a}return __extends(o,e),o}(Mesh),TfFrame=function(e){function t(o){var a=e.call(this)||this;a.arrow=new Arrow,a.add(new Axes(.015,.25));var r=new Text(o);return r.rotateY(Math.PI).translateX(.03).translateY(.03),a.add(r),a.arrow.setHeadDimensions({length:.3*DEFAULT_CONE_HEIGHT/2,radius:.1*DEFAULT_CONE_RADIUS/2}),a.arrow.setShaftDimensions({length:.85*DEFAULT_CYLINDER_HEIGHT,radius:.05*DEFAULT_CYLINDER_RADIUS/6}),a.arrow.setColor({cone:new Color("#FF1493"),cylinder:new Color(DEFAULT_COLOR_ARROW)}),a.add(a.arrow),a.name=t.getName(o),a}return __extends(t,e),t.getName=function(e){return"tf-"+e},t}(Group),Tf=function(e){var t=Math.PI;function o(t,o){void 0===o&&(o=DEFAULT_OPTIONS_TF);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_TF),o)})||this;return a.object=new Group$1,a.object.name="tf-tree",a}return __extends(o,e),o.prototype.update=function(e){var o,a=this,r=e.transforms;r.forEach(function(e){var o=e.header.frame_id,r=e.child_frame_id,i=e.transform,n=__read([a.getFrameOrCreate(r),a.getFrameOrCreate(o)],2),s=n[0],l=n[1];if(l.add(s),s.setTransform(i),.1>s.position.length())s.arrow.visible=!1;else{s.arrow.lookAt(l.getWorldPosition(new Vector3)),s.arrow.rotateY(-t/2),s.arrow.visible=!0;var d=s.arrow.cone.scale.y;s.arrow.setShaftDimensions({length:s.position.length()-d})}}),null===(o=this.object)||void 0===o?void 0:o.children.forEach(function(e){e.arrow.visible=!1})},o.prototype.getFrameOrCreate=function(e){var t,o,a=null===(t=this.object)||void 0===t?void 0:t.getObjectByName(TfFrame.getName(e));if(a)return a;var r=new TfFrame(e);return null===(o=this.object)||void 0===o?void 0:o.add(r),r},o}(LiveCore),commonjsGlobal="undefined"==typeof globalThis?"undefined"==typeof window?"undefined"==typeof global?"undefined"==typeof self?{}:self:global:window:globalThis;function unwrapExports(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}var URDFLoader=createCommonjsModule(function(e,t){var o=Math.max,a=Math.min,r=Math.PI;(function(t,o){e.exports=o(three,STLLoader,ColladaLoader,threeMeshBvh)})(commonjsGlobal,function(e,t,i,s){function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var o,a=0;a<t.length;a++)o=t[a],o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}function c(e,t,o){return t&&p(e.prototype,t),o&&p(e,o),e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf:function t(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function h(e,t){return h=Object.setPrototypeOf||function o(e,t){return e.__proto__=t,e},h(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return t&&("object"==typeof t||"function"==typeof t)?t:g(e)}function b(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&(e=u(e),null!==e););return e}function f(e,t,o){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function a(e,t,o){var r=b(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(o):i.value}},f(e,t,o||e)}function E(e,t){return _(e)||O(e,t)||A()}function v(e){return T(e)||S(e)||P()}function T(e){if(Array.isArray(e)){for(var t=0,o=Array(e.length);t<e.length;t++)o[t]=e[t];return o}}function _(e){if(Array.isArray(e))return e}function S(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function O(e,t){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)){var o=[],a=!0,r=!1,i=void 0;try{for(var n,s=e[Symbol.iterator]();!(a=(n=s.next()).done)&&(o.push(n.value),!(t&&o.length===t));a=!0);}catch(e){r=!0,i=e}finally{try{a||null==s["return"]||s["return"]()}finally{if(r)throw i}}return o}}function P(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function A(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function C(){for(var e,t=Object.getPrototypeOf(this),o=arguments.length,a=Array(o),r=0;r<o;r++)a[r]=arguments[r];var i=(e=t.clone).call.apply(e,[this].concat(a));return i.isURDFCollider=!0,i}function j(e){e.isURDFCollider=!0,e.clone=C}function R(e){return e?e.trim().split(/\s+/g).map(function(e){return parseFloat(e)}):[0,0,0]}function M(e,t){var o=!!(2<arguments.length&&arguments[2]!==void 0)&&arguments[2];o||e.rotation.set(0,0,0),k.set(t[0],t[1],t[2],"ZYX"),x.setFromEuler(k),x.multiply(e.quaternion),e.quaternion.copy(x)}var I=function(e){function t(){var e,o;d(this,t);for(var a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];return o=y(this,(e=u(t)).call.apply(e,[this].concat(r))),o.isURDFLink=!0,o.type="URDFLink",o.urdfNode=null,o}return m(t,e),c(t,[{key:"show",value:function e(){this.visible=!0}},{key:"hide",value:function e(){this.visible=!1}},{key:"delete",value:function e(){var t=this;this.parent.remove(this),this.children.map(function(e){t.remove(e)})}},{key:"copy",value:function a(e,o){return f(u(t.prototype),"copy",this).call(this,e,o),this.urdfNode=e.urdfNode,this}}]),t}(e.Object3D),L=function(t){function r(){var e,t;d(this,r);for(var o=arguments.length,a=Array(o),i=0;i<o;i++)a[i]=arguments[i];return t=y(this,(e=u(r)).call.apply(e,[this].concat(a))),t.isURDFJoint=!0,t.type="URDFJoint",t.urdfNode=null,t.jointValue=null,t.jointType="fixed",t.axis=null,t.limit={lower:0,upper:0},t.ignoreLimits=!1,t.origPosition=null,t.origQuaternion=null,t}return m(r,t),c(r,[{key:"jointType",get:function e(){return this._jointType},set:function t(e){this.jointType!==e&&(this._jointType=e,"fixed"===e||"continuous"===e||"revolute"===e||"prismatic"===e?this.jointValue=0:"planar"===e?this.jointValue=[,,].fill(0):"floating"===e?this.jointValue=[,,,,,,].fill(0):void 0)}},{key:"angle",get:function e(){return this.jointValue}}]),c(r,[{key:"copy",value:function o(e,t){return f(u(r.prototype),"copy",this).call(this,e,t),this.urdfNode=e.urdfNode,this.jointType=e.jointType,this.axis=e.axis?e.axis.clone():null,this.limit.lower=e.limit.lower,this.limit.upper=e.limit.upper,this.ignoreLimits=!1,this.jointValue=Array.isArray(e.jointValue)?v(e.jointValue):e.jointValue,this.origPosition=e.origPosition?e.origPosition.clone():null,this.origQuaternion=e.origQuaternion?e.origQuaternion.clone():null,this}},{key:"setAngle",value:function e(){return this.setOffset.apply(this,arguments)}},{key:"setOffset",value:function t(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];switch(i=i.map(function(e){return parseFloat(e)}),this.origPosition&&this.origQuaternion||(this.origPosition=this.position.clone(),this.origQuaternion=this.quaternion.clone()),this.jointType){case"fixed":break;case"continuous":case"revolute":{var s=i[0];if(null==s)break;if(s===this.jointValue)break;this.ignoreLimits||"revolute"!==this.jointType||(s=a(this.limit.upper,s),s=o(this.limit.lower,s));var l=new e.Quaternion().setFromAxisAngle(this.axis,s);this.quaternion.multiplyQuaternions(this.origQuaternion,l),this.jointValue=s,this.matrixWorldNeedsUpdate=!0;break}case"prismatic":{var d=i[0];if(null==d)break;if(d===this.jointValue)break;this.ignoreLimits||(d=a(this.limit.upper,d),d=o(this.limit.lower,d)),this.position.copy(this.origPosition),this.position.addScaledVector(this.axis,d),this.jointValue=d,this.worldMatrixNeedsUpdate=!0;break}case"floating":case"planar":console.warn("'".concat(this.jointType,"' joint not yet supported"));}return this.jointValue}}]),r}(e.Object3D),N=function(e){function t(){var e,o;d(this,t);for(var a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];return o=y(this,(e=u(t)).call.apply(e,[this].concat(r))),o.isURDFRobot=!0,o.urdfNode=null,o.urdfRobotNode=null,o.robotName=null,o.links=null,o.joints=null,o}return m(t,e),c(t,[{key:"copy",value:function a(e,o){var r=this;return f(u(t.prototype),"copy",this).call(this,e,o),this.urdfRobotNode=e.urdfRobotNode,this.robotName=e.robotName,this.links={},this.joints={},this.traverse(function(t){t.isURDFJoint&&t.name in e.joints&&(r.joints[t.name]=t),t.isURDFLink&&t.name in e.links&&(r.links[t.name]=t)}),this}},{key:"setAngle",value:function t(e){var o=this.joints[e];if(o){for(var a=arguments.length,r=Array(1<a?a-1:0),i=1;i<a;i++)r[i-1]=arguments[i];return o.setAngle.apply(o,r)}return null}},{key:"setAngles",value:function t(e){for(var o in e)this.setAngle(o,e[o])}}]),t}(I),x=new e.Quaternion,k=new e.Euler,w=function(){function o(t){var a=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];d(this,o),this.manager=t||e.DefaultLoadingManager,this.allowMeshBVH=a,this.retryMap={}}return c(o,[{key:"load",value:function n(t,o,a,r,i){var s,l=this,d=this.manager,p=e.LoaderUtils.extractUrlBase(t),c=this.manager.resolveURL(t),m={},u=function e(){},h=function e(){},g=function e(){};d.onError&&(u=d.onProgress.bind(d)),d.onProgress&&(h=d.onProgress.bind(d)),d.onLoad&&(g=d.onLoad.bind(d));var y=this;d.onError=function(e){m[e]="Error in loading resource",r&&r({url:e,retry:y.retryMap[e]}),u(e)},d.onProgress=function(e,t,o){a&&a(e,t,o),h(e,t,o)},d.onLoad=function(){if(o){var e=0===Object.keys(m).length?void 0:m;o(s,e)}g()},i=Object.assign({workingPath:p},i),d.itemStart(c),fetch(c,i.fetchOptions).then(function(e){return e.text()}).then(function(e){s=l.parse(e,i),window.model=s,d.itemEnd(c)})["catch"](function(t){console.error("URDFLoader: Error parsing file.",t),d.itemError(c),d.itemEnd(c)})}},{key:"parse",value:function o(t){function a(e){if(!/^package:\/\//.test(e))return y?y+e:e;var t=e.replace(/^package:\/\//,"").split(/\/(.+)/),o=E(t,2),a=o[0],r=o[1];return"string"==typeof h?h.endsWith(a)?h+"/"+r:h+"/"+a+"/"+r:"object"===l(h)?a in h?h[a]+"/"+r:(console.error("URDFLoader : ".concat(a," not found in provided package list.")),null):void 0}function i(e){var t=this,o=v(e.children),a=o.filter(function(e){return"link"===e.nodeName.toLowerCase()}),r=o.filter(function(e){return"joint"===e.nodeName.toLowerCase()}),i=o.filter(function(e){return"material"===e.nodeName.toLowerCase()}),s=new N;return s.robotName=e.getAttribute("name"),s.urdfRobotNode=e,i.forEach(function(e){var o=e.getAttribute("name");O[o]=p.call(t,e)}),a.forEach(function(o){var a=o.getAttribute("name"),r=null===e.querySelector("child[link=\"".concat(a,"\"]"));_[a]=d.call(t,o,r?s:null)}),r.forEach(function(e){var o=e.getAttribute("name");S[o]=n.call(t,e)}),s.joints=S,s.links=_,s}function n(t){var o=v(t.children),a=t.getAttribute("type"),r=new L;r.urdfNode=t,r.name=t.getAttribute("name"),r.jointType=a;var i=null,s=null,l=[0,0,0],d=[0,0,0];o.forEach(function(e){var t=e.nodeName.toLowerCase();"origin"===t?(l=R(e.getAttribute("xyz")),d=R(e.getAttribute("rpy"))):"child"===t?s=_[e.getAttribute("link")]:"parent"===t?i=_[e.getAttribute("link")]:"limit"===t&&(r.limit.lower=parseFloat(e.getAttribute("lower")||r.limit.lower),r.limit.upper=parseFloat(e.getAttribute("upper")||r.limit.upper))}),i.add(r),r.add(s),M(r,d),r.position.set(l[0],l[1],l[2]);var p=o.filter(function(e){return"axis"===e.nodeName.toLowerCase()})[0];if(p){var c=p.getAttribute("xyz").split(/\s+/g).map(function(e){return parseFloat(e)});r.axis=new e.Vector3(c[0],c[1],c[2]),r.axis.normalize()}return r}function d(e){var t=this,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;null===o&&(o=new I);var a=v(e.children);if(o.name=e.getAttribute("name"),o.urdfNode=e,b){var r=a.filter(function(e){return"visual"===e.nodeName.toLowerCase()});r.forEach(function(e){return c.call(t,e,o,O)})}if(f){var i=a.filter(function(e){return"collision"===e.nodeName.toLowerCase()});i.forEach(function(e){return c.call(t,e,o)})}return o}function p(t){var o=this,r=v(t.children),i=new e.MeshPhongMaterial;return i.name=t.getAttribute("name")||"",r.forEach(function(t){var r=t.nodeName.toLowerCase();if("color"===r){var n=t.getAttribute("rgba").split(/\s/g).map(function(e){return parseFloat(e)});i.color.setRGB(n[0],n[1],n[2]),i.opacity=n[3],i.transparent=1>n[3]}else if("texture"===r){var s=new e.TextureLoader(T),l=t.getAttribute("filename"),d=a(l),p=function e(){o.retryMap[d]=function(){return s.load(d,function(){return null},function(){return null},e)}};i.map=s.load(d,function(){return null},function(){return null},p)}}),i}function c(t,o){var i=this,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},l="collision"===t.nodeName.toLowerCase(),d=[0,0,0],c=[0,0,0],m=[1,1,1],u=v(t.children),h=null,y=null,b=u.filter(function(e){return"material"===e.nodeName.toLowerCase()})[0];if(b){var f=b.getAttribute("name");h=f&&f in n?n[f]:p.call(this,b)}else h=new e.MeshPhongMaterial;u.forEach(function(t){var n=t.nodeName.toLowerCase();if("geometry"===n){var p=t.children[0].nodeName.toLowerCase();if("mesh"===p){var u=t.children[0].getAttribute("filename"),b=a(u);if(null!==b){var f=t.children[0].getAttribute("scale");f&&(m=R(f));var E=function r(t,a){a?(console.error("URDFLoader: Error loading mesh.",a),i.retryMap[b]=function(){return g(b,T,r)}):t&&(t instanceof e.Mesh&&(t.material=h,i.allowMeshBVH&&(t.raycast=s.acceleratedRaycast,t.geometry.boundsTree=new s.MeshBVH(t.geometry))),o.add(t),t.position.set(d[0],d[1],d[2]),t.rotation.set(0,0,0),t.scale.x*=m[0],t.scale.y*=m[1],t.scale.z*=m[2],M(t,c),l&&j(t))};g(b,T,E)}}else if("box"===p){y=new e.Mesh,y.geometry=new e.BoxBufferGeometry(1,1,1),y.material=h,i.allowMeshBVH&&(y.raycast=s.acceleratedRaycast,y.geometry.boundsTree=new s.MeshBVH(y.geometry));var v=R(t.children[0].getAttribute("size"));o.add(y),y.scale.set(v[0],v[1],v[2]),l&&j(y)}else if("sphere"===p){y=new e.Mesh,y.geometry=new e.SphereBufferGeometry(1,30,30),y.material=h,i.allowMeshBVH&&(y.raycast=s.acceleratedRaycast,y.geometry.boundsTree=new s.MeshBVH(y.geometry));var _=parseFloat(t.children[0].getAttribute("radius"))||0;y.scale.set(_,_,_),o.add(y),l&&j(y)}else if("cylinder"===p){y=new e.Mesh,y.geometry=new e.CylinderBufferGeometry(1,1,1,30),y.material=h,i.allowMeshBVH&&(y.raycast=s.acceleratedRaycast,y.geometry.boundsTree=new s.MeshBVH(y.geometry));var S=parseFloat(t.children[0].getAttribute("radius"))||0,O=parseFloat(t.children[0].getAttribute("length"))||0;y.scale.set(S,O,S),y.rotation.set(r/2,0,0),o.add(y),l&&j(y)}}else"origin"===n&&(d=R(t.getAttribute("xyz")),c=R(t.getAttribute("rpy")))}),y&&(M(y,c,!0),y.position.set(d[0],d[1],d[2]))}var m=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},h=u.packages||"",g=u.loadMeshCb||this.defaultMeshLoader.bind(this),y=u.workingPath||"",b=!("parseVisual"in u)||u.parseVisual,f=u.parseCollision||!1,T=this.manager,_={},S={},O={},P=function t(e){var o=new DOMParser,a=o.parseFromString(e,"text/xml"),r=v(a.children),n=r.filter(function(e){return"robot"===e.nodeName}).pop();return i.call(m,n)};return P(t)}},{key:"defaultMeshLoader",value:function n(o,a,r){if(/\.stl(?:\?|$)/i.test(o)){var s=new t.STLLoader(a);s.load(o,function(t){var o=new e.Mesh(t,new e.MeshPhongMaterial());r(o)})}else if(/\.dae(?:\?|$)/i.test(o)){var l=new i.ColladaLoader(a);l.load(o,function(e){return r(e.scene)})}else console.warn("URDFLoader: Could not load model at ".concat(o,".\nNo loader available"))}}]),o}();return w})}),URDFLoader$1=unwrapExports(URDFLoader),URDFCore=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_ROBOTMODEL);var r=e.call(this,DefaultLoadingManager)||this;return r.packages={},r.hide=function(){var e,t;assertIsDefined(r.object),Object.values(null!==(t=null===(e=r.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.hide()})},r.show=function(){var e,t;assertIsDefined(r.object),Object.values(null!==(t=null===(e=r.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.show()})},r.destroy=function(){var e,t,o,a;Object.values(null!==(t=null===(e=r.urdfObject)||void 0===e?void 0:e.links)&&void 0!==t?t:[]).forEach(function(e){e.delete()}),null===(a=null===(o=r.object)||void 0===o?void 0:o.parent)||void 0===a?void 0:a.remove(r.object),r.object=void 0},r.reset=function(){},r.options=a,r.packages=a.packages,r.param=new ROSLIB.Param({ros:t,name:o}),r.updateOptions=r.updateOptions.bind(r),r.getPackages=r.getPackages.bind(r),r.defaultLoadMeshCallback=r.defaultLoadMeshCallback.bind(r),r.onComplete=r.onComplete.bind(r),r.loadURDF=r.loadURDF.bind(r),r.loadFromParam=r.loadFromParam.bind(r),r}return __extends(t,e),t.prototype.onComplete=function(e){},t.prototype.loadFromParam=function(e,t){var o=this;void 0===e&&(e=this.onComplete),void 0===t&&(t={}),this.param.get(function(a){o.loadURDF(a,e,t)})},t.prototype.loadURDF=function(t,o,a){void 0===o&&(o=this.onComplete);var r=e.prototype.parse.call(this,t,__assign({packages:a.packages||this.packages,loadMeshCb:a.loadMeshCb||this.defaultLoadMeshCallback,fetchOptions:{mode:"cors",credentials:"same-origin"}},a));assertIsDefined(this.object),this.urdfObject=r,this.object.add(r),this.object.name=r.robotName,o(this.object)},t.prototype.defaultLoadMeshCallback=function(t,o,a){e.prototype.defaultMeshLoader.call(this,t,o,function(e){a(e)})},t.prototype.getPackages=function(e){this.param.get(function(t){var o=new DOMParser,a=o.parseFromString(t,"text/xml"),r=__spread(Array.from(a.querySelectorAll("mesh"))).map(function(e){var t,o=__read(null===(t=null===e||void 0===e?void 0:e.getAttribute("filename"))||void 0===t?void 0:t.replace(/^package:\/\//,"").split(/\/(.+)/),1),a=o[0];return a});e(__spread(new Set(r)))})},t.prototype.updateOptions=function(e){this.options=__assign(__assign({},this.options),e)},t}(URDFLoader$1),RobotModel=function(e){function t(t,o,a){void 0===a&&(a=DEFAULT_OPTIONS_ROBOTMODEL);var r=e.call(this,t,o,a)||this;return r.object=new Group,r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_ROBOTMODEL),a)),r}return __extends(t,e),t}(URDFCore),Sphere=function(e){function t(){var t=e.call(this)||this;return t.geometry=new SphereGeometry(1,DEFAULT_RADIAL_SEGMENTS,DEFAULT_RADIAL_SEGMENTS),t.material=new MeshStandardMaterial,t.material.transparent=!0,t}return __extends(t,e),t}(Mesh),Point=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_POINT);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_POINT),o)})||this,r=a.options,i=r.alpha,n=r.color,s=r.radius;return a.object=new Group,a.sphere=new Sphere,a.object.add(a.sphere),a.sphere.setColor(n),a.sphere.setAlpha(i),a.sphere.setScale({x:s,y:s,z:s}),a}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.point,r=a.x,i=a.y,n=a.z;null===(o=this.object)||void 0===o?void 0:o.position.set(r,i,n)},t}(LiveCore),getAccessorForDataType=function(e,t){switch(t){case POINT_FIELD_DATATYPES.INT8:return e.getInt8;case POINT_FIELD_DATATYPES.UINT8:return e.getUint8;case POINT_FIELD_DATATYPES.INT16:return e.getInt16;case POINT_FIELD_DATATYPES.UINT16:return e.getUint16;case POINT_FIELD_DATATYPES.INT32:return e.getInt32;case POINT_FIELD_DATATYPES.UINT32:return e.getUint32;case POINT_FIELD_DATATYPES.FLOAT64:return e.getFloat64;case POINT_FIELD_DATATYPES.FLOAT32:default:return e.getFloat32;}},updateGeometryAttribute=function(e,t,o,a){var r=e.attributes[t];assertIsBufferAttribute(r),r.updateRange={offset:0,count:3*a},r.count=a,r.array=o,r.needsUpdate=!0},PCLDecoder=function(){var e=Math.min;function t(){}return t.decode=function(t,o,a){var r=t.height*t.width,n=new Float32Array(3*r),s=new Float32Array(3*r),l=new Float32Array(3*r),d=Uint8Array.from(t.data).buffer,p=new DataView(d),c={},m={},u=new Color;t.fields.forEach(function(e){c[e.name]=e.offset,m[e.name]=getAccessorForDataType(p,e.datatype)});for(var h,g=0;g<r;g++){if(h=g*t.point_step,void 0!==c.x&&void 0!==c.y&&void 0!==c.z&&(n[3*g]=m.x.call(p,h+c.x,!t.is_bigendian),n[3*g+1]=m.y.call(p,h+c.y,!t.is_bigendian),n[3*g+2]=m.z.call(p,h+c.z,!t.is_bigendian)),void 0!==c.rgb&&o===POINTCLOUD_COLOR_CHANNELS.RGB&&(s[3*g]=p.getUint8(h+c.rgb+2)/255,s[3*g+1]=p.getUint8(h+c.rgb+1)/255,s[3*g+2]=p.getUint8(h+c.rgb)/255),void 0!==c.intensity&&o===POINTCLOUD_COLOR_CHANNELS.INTENSITY){var y=m.intensity.call(p,h+c.intensity,!t.is_bigendian),b=e(y,360)/360;if(a){var f=u.setHSL(b,1,.5).toArray().map(function(e){return 255*e});s[3*g]=f[0]/255,s[3*g+1]=f[1]/255,s[3*g+2]=f[2]/255}else s[3*g]=b/360,s[3*g+1]=b/360,s[3*g+2]=b/360}void 0!==c.normal_x&&void 0!==c.normal_y&&void 0!==c.normal_z&&(l[3*g]=m.normal_x.call(p,h+c.normal_x,!t.is_bigendian),l[3*g+1]=m.normal_y.call(p,h+c.normal_y,!t.is_bigendian),l[3*g+2]=m.normal_z.call(p,h+c.normal_z,!t.is_bigendian))}return{positions:n,colors:s,normals:l}},t.attachDecoder=function(e){var o=e.get_memory,a=e.PCLDecoder,r=new a,i=o();t.decode=function(e,t,o){var a=e.height*e.width,n={},s=new Float32Array(3*a);e.fields.forEach(function(e){n[e.name]=e.offset});var l=new Uint8Array(i.buffer),d=r.get_copy_memory_ptr();l.set(e.data,d),r.compute(a,e.point_step,n.x,n.y,n.z,n.rgb||0,n.intensity||0,t===POINTCLOUD_COLOR_CHANNELS.INTENSITY,o);var p=r.get_position_memory_ptr(),c=r.get_color_memory_ptr(),m=new Float32Array(i.buffer,p,3*a),u=t===POINTCLOUD_COLOR_CHANNELS.INTENSITY&&!n.intensity||t===POINTCLOUD_COLOR_CHANNELS.RGB&&!n.rgb,h=u?new Float32Array(3*a):new Float32Array(i.buffer,c,3*a);return{positions:m,colors:h,normals:s}}},t}(),editPointCloudPoints=function(e,t){if(void 0===t&&(t=DEFAULT_OPTIONS_POINTCLOUD),!e)return{positions:new Float32Array(0),colors:new Float32Array(0),normals:new Float32Array(0)};var o=t.colorChannel,a=t.useRainbow,r=PCLDecoder.decode(e,o,a),i=r.colors,n=r.normals,s=r.positions;return{positions:s,colors:i,normals:n}},PointCloud=function(e){var t=Math.floor,o=Math.min;function a(t,o){void 0===o&&(o=DEFAULT_OPTIONS_POINTCLOUD);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_POINTCLOUD),o)})||this;a.update=function(t){e.prototype.update.call(a,t);var o=editPointCloudPoints(t,a.options),r=o.colors,i=o.normals,n=o.positions;a.updatePointCloudGeometry(n,r,i)};var r=new PointsMaterial({size:a.options.size,color:VertexColors}),i=new BufferGeometry;return i.setAttribute("position",new BufferAttribute(new Float32Array(3*MAX_POINTCLOUD_POINTS),3).setUsage(DynamicDrawUsage)),i.setAttribute("color",new BufferAttribute(new Float32Array(3*MAX_POINTCLOUD_POINTS),3).setUsage(DynamicDrawUsage)),i.setAttribute("normal",new BufferAttribute(new Float32Array(3*MAX_POINTCLOUD_POINTS),3).setUsage(DynamicDrawUsage)),i.setDrawRange(0,0),i.computeBoundingSphere(),a.object=new Points$2(i,r),a.object.frustumCulled=!1,a.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_POINTCLOUD),o)),a}return __extends(a,e),a.prototype.updatePointCloudGeometry=function(e,a,r){var i=Number.isNaN;assertIsDefined(this.object);var n=this.object,s=n.geometry,d=n.material;d.size===this.options.size||i(this.options.size)||(d.size=this.options.size,d.needsUpdate=!0);var p=o(MAX_POINTCLOUD_POINTS,t(e.length/3));assertIsBufferGeometry(s),s.setDrawRange(0,p),updateGeometryAttribute(s,"position",e,p),updateGeometryAttribute(s,"color",a,p),updateGeometryAttribute(s,"normal",r,p)},a}(LiveCore),Cube=function(e){function t(){var t=e.call(this)||this;return t.geometry=new BoxGeometry,t.material=new MeshStandardMaterial,t}return __extends(t,e),t}(Mesh),LineSegments=function(e){function t(t,o){void 0===o&&(o=5);var a=e.call(this)||this;return a.geometry=new Geometry,a.material=new LineBasicMaterial({linewidth:o,color:VertexColors}),a}return __extends(t,e),t.prototype.isValid=function(e){return e.length<=this.geometry.vertices.length},t.prototype.setColor=function(e){setColor(this,e)},t.prototype.updatePoints=function(e,t){this.geometry.vertices=e.map(function(e){var t=e.x,o=e.y,a=e.z;return new Vector3(t,o,a)}),this.geometry.verticesNeedUpdate=!0,0<t.length&&(this.geometry.colors=t.map(function(e){var t=e.r,o=e.g,a=e.b;return new Color(t,o,a)}),this.geometry.colorsNeedUpdate=!0)},t.prototype.setTransform=function(e){setTransform(this,e)},t}(LineSegments$1),ObjectCacher=function(){function e(e,t){this.objectPool=e,this.Primitive=t}return e.prototype.setObjectDimension=function(e,t,o,a){var r=t.x,i=t.y,n=t.z;e.setColor(o),e.setScale(a),e.position.set(r,i,n)},e.prototype.reusePool=function(e,t,o){for(var a,r=o.scale,n=e.length,s=0;s<n;s++)a=this.objectPool.children[s],this.setObjectDimension(a,e[s],t[s],r);for(var s=n;s<this.objectPool.children.length;s++)this.objectPool.children[s].visible=!1},e.prototype.increasePool=function(e,t,o){for(var a,r=this.objectPool.children.length,n=o.scale,s=0;s<r;s++)a=this.objectPool.children[s],this.setObjectDimension(a,e[s],t[s],n);for(var s=r;s<e.length;s++){var l=new this.Primitive,d=e[s],p=d.x,c=d.y,m=d.z;l.setColor(t[s]),l.setScale(n),l.position.set(p,c,m),this.objectPool.add(l)}},e}(),SphereList=function(e){function t(){var t=e.call(this)||this;return t.geometry=new Geometry,t.material=new MeshBasicMaterial,t.objectCacher=new ObjectCacher(t,Sphere),t}return __extends(t,e),t.prototype.updatePoints=function(e,t,o){var a=__assign(__assign({},o),{subtype:MARKER_OBJECT_TYPES.SPHERE});e.length<this.children.length?this.objectCacher.reusePool(e,t,a):this.objectCacher.increasePool(e,t,a)},t}(Mesh),Points=function(e){function t(){var t=e.call(this)||this;return t.geometry=new Geometry,t.material=new PointsMaterial({color:VertexColors}),t}return __extends(t,e),t.prototype.setTransform=function(e){setTransform(this,e)},t.prototype.updatePoints=function(e,t,o){var a=o.scale.x;this.material.size=a,this.geometry.vertices=e.map(function(e){return new Vector3(e.x,e.y,e.z)}),this.geometry.verticesNeedUpdate=!0,0<t.length&&(this.geometry.colors=t.map(function(e){return new Color(e.r,e.g,e.b)}),this.geometry.colorsNeedUpdate=!0)},t.prototype.setScale=function(e){this.material.size="number"==typeof e?e:e.x},t}(Points$2),TriangleList=function(e){function t(){var t=e.call(this)||this;return t.geometry=new Geometry,t.material=new MeshBasicMaterial({color:FaceColors}),t.material.side=DoubleSide,t}return __extends(t,e),t.prototype.updatePoints=function(e,t,o){void 0===t&&(t=[]);var a=[],r=[],i=o.scale,n=i.x,s=i.y,d=i.z;this.scale.set(n,s,d);for(var p,c=0,m=e.length/3;c<m;c++){p=[e[3*c],e[3*c+1],e[3*c+2]],p.map(function(e){a.push(new Vector3(e.x,e.y,e.z))});var l=0===t.length?{r:1,g:0,b:0}:t[3*c];r.push(new Face3(3*c,3*c+2,3*c+1,new Vector3(),new Color(l.r,l.g,l.b)))}this.geometry.vertices=a,this.geometry.faces=r,this.geometry.computeFaceNormals(),this.geometry.computeVertexNormals(),this.geometry.elementsNeedUpdate=!0,this.geometry.verticesNeedUpdate=!0},t}(Mesh),CubeList=function(e){function t(){var t=e.call(this)||this;return t.geometry=new Geometry,t.material=new MeshBasicMaterial,t.objectCacher=new ObjectCacher(t,Cube),t}return __extends(t,e),t.prototype.updatePoints=function(e,t,o){var a=__assign(__assign({},o),{subType:MARKER_OBJECT_TYPES.CUBE});e.length<this.children.length?this.objectCacher.reusePool(e,t,a):this.objectCacher.increasePool(e,t,a)},t}(Mesh),ViewFacingText=function(e){function t(t){var o=e.call(this)||this;return o.color=new Color(1,1,1),o.text=new SpriteText(t,1,"#"+o.color.getHexString()),o.add(o.text),o}return __extends(t,e),t.prototype.setColor=function(e){var t=e.b,o=e.g,a=e.r;this.color.r===a&&this.color.g===o&&this.color.b===t||(this.color=new Color(a,o,t),this.text.color="#"+this.color.getHexString())},t}(Mesh),getNewPrimitive=function(e){switch(e.type){case MARKER_OBJECT_TYPES.CUBE:return new Cube;case MARKER_OBJECT_TYPES.SPHERE:return new Sphere;case MARKER_OBJECT_TYPES.CYLINDER:{var t=new Group;return t.add(new Cylinder),t}case MARKER_OBJECT_TYPES.LINE_LIST:return new LineSegments;case MARKER_OBJECT_TYPES.LINE_STRIP:return new Line;case MARKER_OBJECT_TYPES.SPHERE_LIST:return new SphereList;case MARKER_OBJECT_TYPES.POINTS:return new Points;case MARKER_OBJECT_TYPES.TRIANGLE_LIST:return new TriangleList;case MARKER_OBJECT_TYPES.CUBE_LIST:return new CubeList;case MARKER_OBJECT_TYPES.TEXT_VIEW_FACING:return new ViewFacingText(e.text);case MARKER_OBJECT_TYPES.ARROW:default:{var o=new Arrow;return o.setHeadDimensions({radius:.1*DEFAULT_CONE_RADIUS,length:.3*DEFAULT_CONE_HEIGHT}),o.setShaftDimensions({radius:.05*DEFAULT_CYLINDER_RADIUS,length:.7*DEFAULT_CYLINDER_HEIGHT}),o}}},MarkerLifetime=function(){function e(e){this.timeouts={},this.timeouts={},this.onTimeout=e}return e.prototype.track=function(e,t){var o=this;clearInterval(this.timeouts[e]),0===t||(this.timeouts[e]=window.setTimeout(function(){o.onTimeout(e)},1e3*t))},e.prototype.untrack=function(e){clearInterval(this.timeouts[e]),delete this.timeouts[e]},e.prototype.destroy=function(){var e,t,o=Object.keys(this.timeouts);try{for(var a,r=__values(o),i=r.next();!i.done;i=r.next())a=i.value,clearInterval(this.timeouts[a]),delete this.timeouts[a]}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}},e}(),MarkerManager=function(){function e(e,t){this.objectMap={},this.namespaces={},this.object=e,this.onChangeCb=t,this.markerLifetime=new MarkerLifetime(this.onMarkerLifetimeOver.bind(this))}return e.prototype.onMarkerLifetimeOver=function(e){var t=this.objectMap[e];t&&this.removeObject(e)},e.prototype.getMarkerOrCreate=function(t){var o=e.getId(t);if(!this.objectMap[o]){var a=getNewPrimitive(t);this.objectMap[o]=a,this.object.add(a)}else this.objectMap[o]instanceof LineSegments&&!this.objectMap[o].isValid(t.points)&&(this.removeObject(o),this.objectMap[o]=getNewPrimitive(t),this.object.add(this.objectMap[o]));return this.objectMap[o].visible=this.namespaces[t.ns],this.objectMap[o]},e.prototype.extractNameSpace=function(e){var t=e.split("-");return t[0]},e.prototype.updateOptions=function(e){var t=e.namespaces;for(var o in this.namespaces=t,this.objectMap)if(this.objectMap.hasOwnProperty(o)){var a=this.extractNameSpace(o);this.objectMap[o].visible=this.namespaces[a]}},e.prototype.onChange=function(){this.onChangeCb()},e.prototype.updateMarker=function(t){var o=t.color,a=t.colors,r=t.lifetime,i=t.points,n=t.pose,s=n.orientation,l=n.position,d=t.scale,p=this.getMarkerOrCreate(t),c=e.getId(t);this.markerLifetime.track(c,r.secs),p.updatePoints&&p.updatePoints(i,a,t),p.setTransform({translation:l,rotation:s}),p.setScale&&!p.updatePoints&&p.setScale({x:d.x,y:d.y,z:d.z}),p.setColor&&0>=a.length&&p.setColor(o);var m=t.ns;m in this.namespaces||(this.namespaces[m]=!0,this.onChange())},e.prototype.removeObject=function(e){var t,o=this.objectMap[e];null===(t=o.parent)||void 0===t?void 0:t.remove(o),delete this.objectMap[e]},e.prototype.reset=function(){var e=this;this.namespaces={},this.markerLifetime.destroy(),this.onChange(),Object.keys(this.objectMap).forEach(function(t){e.removeObject(t)})},e.getId=function(e){var t=e.ns,o=e.id;return t+"-"+o},e}(),MarkerArray=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_MARKERARRAY);var a,r=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_MARKERARRAY),o)})||this;return r.reset=function(){r.markerManager.reset()},r.object=new Group,r.markerManager=new MarkerManager(r.object,null!==(a=r.onNameSpaceChange)&&void 0!==a?a:function(){return null}),r}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.markerManager.updateOptions(this.options)},t.prototype.update=function(t){var o=this;e.prototype.update.call(this,t),t.markers.forEach(function(e){o.markerManager.updateMarker(e)})},t}(LiveCore),Points$1=function(){function e(e){void 0===e&&(e={}),this.maxPts=e.max_pts||1e4,this.rootObject=e.rootObject||new Object3D}return e.prototype.setup=function(e,t,o){var a=this;this.rootObject.children.forEach(function(e){a.rootObject.remove(e)}),this.positions=new BufferAttribute(new Float32Array(3*this.maxPts),3,!1),this.colors=new BufferAttribute(new Float32Array(3*this.maxPts),3,!1);var r={};if(e===LASERSCAN_STYLES.POINTS){var i=new TextureLoader().load("https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/sprites/circle.png");r={map:i,alphaTest:.5}}this.geometry=new BufferGeometry,this.geometry.setAttribute("position",this.positions.setUsage(DynamicDrawUsage)),this.geometry.setAttribute("color",this.colors.setUsage(DynamicDrawUsage)),this.material=new PointsMaterial(__assign({color:8947848,size:t},r)),this.material.transparent=!0,this.material.opacity=o,this.object=new Points$2(this.geometry,this.material),this.rootObject.add(this.object)},e.prototype.update=function(e){assertIsDefined(this.geometry),assertIsDefined(this.positions),assertIsDefined(this.colors),this.geometry.setDrawRange(0,e),this.positions.needsUpdate=!0,this.colors.needsUpdate=!0,this.positions.updateRange.count=e*this.positions.itemSize,this.colors.updateRange.count=e*this.colors.itemSize},e.prototype.setAlpha=function(e){assertIsDefined(this.material),this.material.opacity=e},e.prototype.setSize=function(e){assertIsDefined(this.material),this.material.size=e},e}(),LaserScan=function(e){var t=Math.sin,o=Math.cos;function a(t,o){void 0===o&&(o=DEFAULT_OPTIONS_LASERSCAN);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_LASERSCAN),o)})||this;return a.cachedMessage=null,a.points=new Points$1,a.sphereList=new SphereList,a.cubeList=new CubeList,a.object=new Group,a.object.add(a.points.rootObject),a.object.add(a.sphereList),a.object.add(a.cubeList),a}return __extends(a,e),a.prototype.getNormalizedIntensity=function(e){var t=this.options,o=t.maxIntensity,a=t.minIntensity;return(e-a)/(o-a)},a.prototype.applyIntensityTransform=function(e,t){var o,a=this.options,r=a.channelName,i=a.maxColor,n=a.minColor,s=t.x,l=t.y,d=t.z;r===INTENSITY_CHANNEL_OPTIONS.INTENSITY?o=this.getNormalizedIntensity(e):r===INTENSITY_CHANNEL_OPTIONS.X?o=this.getNormalizedIntensity(s):r===INTENSITY_CHANNEL_OPTIONS.Y?o=this.getNormalizedIntensity(l):r===INTENSITY_CHANNEL_OPTIONS.Z?o=this.getNormalizedIntensity(d):void 0;var p=new Color(n),c=new Color(i);assertIsDefined(o);var m=o*c.getHex()+(1-o)*p.getHex();return new Color(m)},a.prototype.getNormalizedAxisValue=function(e){var t=this.options,o=t.maxAxisValue,a=t.minAxisValue;return(e-a)/(o-a)},a.prototype.applyAxisColorTransform=function(e,t){var o,a=this.options,r=a.axis,i=a.maxAxisValue,n=a.minAxisValue,s=t.x,l=t.y,d=t.z;r===AXES.X?o=this.getNormalizedAxisValue(s):r===AXES.Y?o=this.getNormalizedAxisValue(l):r===AXES.Z?o=this.getNormalizedAxisValue(d):void 0,assertIsDefined(o);var p=o*i+(1-o)*n;return new Color(p)},a.prototype.colorTransformer=function(e,t){var o=this.options,a=o.colorTransformer,r=o.flatColor;return a===COLOR_TRANSFORMERS.INTENSITY?this.applyIntensityTransform(e,t):a===COLOR_TRANSFORMERS.AXIS_COLOR?this.applyAxisColorTransform(e,t):a===COLOR_TRANSFORMERS.FLAT_COLOR?new Color(r):null},a.prototype.setupPoints=function(e,t,o){assertIsDefined(o),assertIsDefined(this.points.colors),assertIsDefined(this.points.positions),assertBehavesLikeArray(this.points.colors.array),assertBehavesLikeArray(this.points.positions.array),this.points.colors.array[e]=o.r,this.points.positions.array[e++]=t.x,this.points.colors.array[e]=o.g,this.points.positions.array[e++]=t.y,this.points.colors.array[e]=o.b,this.points.positions.array[e++]=t.z},a.prototype.hideAllObjects=function(){this.points.rootObject.visible=!1,this.sphereList.visible=!1,this.cubeList.visible=!1},a.prototype.setStyleDimensions=function(e){var a=this.options,r=a.alpha,s=a.style,l=this.options.size,d=e.intensities,p=e.ranges,c=p.length,n=[],m=[];if(!(.001>l)&&l){this.hideAllObjects(),this.points.setup(s,l,r);for(var u,h=0,g=0;g<c;g++)if(u=e.ranges[g],u>=e.range_min&&u<=e.range_max){var y=e.angle_min+g*e.angle_increment,b={x:u*o(y),y:u*t(y),z:0},f=this.colorTransformer(d[g],b);switch(s){case LASERSCAN_STYLES.POINTS:case LASERSCAN_STYLES.SQUARES:case LASERSCAN_STYLES.FLAT_SQUARES:{this.setupPoints(h,b,f),h+=3;break}default:n.push(b),m.push(f);}}var E={scale:{x:l,y:l,z:l}};switch(s){case LASERSCAN_STYLES.SPHERES:{this.sphereList.visible=!0,this.sphereList.updatePoints(n,m,E);break}case LASERSCAN_STYLES.BOXES:{this.cubeList.visible=!0,this.cubeList.updatePoints(n,m,E);break}default:this.points.rootObject.visible=!0,this.points.update(h/3);}}},a.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.cachedMessage&&this.setStyleDimensions(this.cachedMessage)},a.prototype.update=function(t){e.prototype.update.call(this,t),this.setStyleDimensions(t),this.cachedMessage=t},a}(LiveCore),populateImageDataFromNavMsg=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=new DataView(Uint8Array.from([l]).buffer).getUint8(0),p=4*(n+r*t);if(0<=d&&100>=d){var c=255-255*d/100;e.data[p]=c,e.data[++p]=c,e.data[++p]=c,e.data[++p]=255}else 101<=d&&127>=d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=0,e.data[++p]=255):128<=d&&254>=d?(e.data[p]=255,e.data[++p]=255*(d-128)/126,e.data[++p]=0,e.data[++p]=255):(e.data[p]=112,e.data[++p]=137,e.data[++p]=134,e.data[++p]=255)}},populateRawImageDataFromNavMsg=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=4*(n+r*t),p=new DataView(Uint8Array.from([l]).buffer),c=p.getUint8(0);e.data[d]=c,e.data[++d]=c,e.data[++d]=c,e.data[++d]=255}},populateConstImageDataFromNavMsg=function(e,t,o,a){for(var r=0;r<o;r++)for(var n=0;n<t;n++){var s=n+(o-r-1)*t,l=a[s],d=new DataView(Uint8Array.from([l]).buffer).getUint8(0),p=4*(n+r*t);if(0===d)e.data[p]=0,e.data[++p]=0,e.data[++p]=0,e.data[++p]=0;else if(1<=d&&98>=d){var c=255*d/100;e.data[p]=c,e.data[++p]=0,e.data[++p]=255-c,e.data[++p]=255}else 99===d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=255,e.data[++p]=255):100===d?(e.data[p]=255,e.data[++p]=0,e.data[++p]=255,e.data[++p]=255):100<d&&127>=d?(e.data[p]=0,e.data[++p]=255,e.data[++p]=0,e.data[++p]=255):128<=d&&254>=d?(e.data[p]=255,e.data[++p]=255*(d-128)/126,e.data[++p]=0,e.data[++p]=255):(e.data[p]=112,e.data[++p]=137,e.data[++p]=134,e.data[++p]=255)}},imageDataToCanvas=function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height;var o=t.getContext("2d");return null===o||void 0===o?void 0:o.putImageData(e,0,0),t},populateImageDataFromImageMsg=function(e,t,o,a){for(var r=e.data,n=e.height,s=e.step,l=Uint8Array.from(r),d=new DataView(l.buffer),p=0,c=0;c<s*n;c+=t){for(var m=0;m<o.length;m++)a.data[p++]=d.getUint8(c+o[m]);3===o.length&&(a.data[p++]=255)}},Plane=function(e){function t(){var t=e.call(this)||this;return t.geometry=new PlaneGeometry,t.material=new MeshBasicMaterial,t}return __extends(t,e),t}(Mesh),Map$1=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_MAP);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_MAP),o)})||this;return a.cachedMessage=null,a.object=new Plane,assertIsMesh(a.object),assertIsMaterial(a.object.material),a.object.material.transparent=!0,a.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_MAP),o)),a}return __extends(t,e),t.prototype.updateOptions=function(t){assertIsMesh(this.object),assertIsMaterial(this.object.material),e.prototype.updateOptions.call(this,t);var o=this.options,a=o.alpha,r=o.drawBehind;this.object.material.opacity=a,this.object.material.side=r?DoubleSide:FrontSide,this.object.material.needsUpdate=!0,this.cachedMessage&&this.setCanvasData(this.cachedMessage)},t.prototype.updateCanvasDimensions=function(e){var t,o,a,r=e.info,i=r.height,n=r.origin,s=n.orientation,l=s.w,d=s.x,p=s.y,c=s.z,m=n.position,u=m.x,h=m.y,g=m.z,y=r.resolution,b=r.width;null===(t=this.object)||void 0===t?void 0:t.scale.set(b*y,-1*i*y,1);var f=b*y/2+u,E=i*y/2+h;null===(o=this.object)||void 0===o?void 0:o.position.set(f,E,g||.01),null===(a=this.object)||void 0===a?void 0:a.quaternion.copy(new Quaternion(d,p,c,l).normalize())},t.prototype.setCanvasData=function(e){var t=this.options.colorScheme,o=e.data,a=e.info,r=a.height,i=a.width,n=new ImageData(i,r),s=null;t===MAP_COLOR_SCHEMES.MAP?(populateImageDataFromNavMsg(n,i,r,o),s=imageDataToCanvas(n)):t===MAP_COLOR_SCHEMES.CONST_MAP?(populateConstImageDataFromNavMsg(n,i,r,o),s=imageDataToCanvas(n)):t===MAP_COLOR_SCHEMES.RAW?(populateRawImageDataFromNavMsg(n,i,r,o),s=imageDataToCanvas(n)):void 0,assertIsMesh(this.object),assertIsMeshBasicMaterial(this.object.material),s&&(this.object.material.map=new CanvasTexture(s),this.object.material.map.minFilter=NearestFilter,this.object.material.map.magFilter=NearestFilter,this.object.material.needsUpdate=!0),this.updateCanvasDimensions(e)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.setCanvasData(t),this.cachedMessage=t},t}(LiveCore),Odometry=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_ODOMETRY);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_ODOMETRY),o)})||this;return a.objectPool=[],a.keepSize=100,a.currentObjectIndex=-1,a.object=new Group,a}return __extends(t,e),t.prototype.setKeepSize=function(e){var t,o=[];if(0===e)return void(this.keepSize=0);if(e<this.keepSize&&e<this.objectPool.length){for(var a=this.objectPool.length-e,r=0;r<a;r++)null===(t=this.object)||void 0===t?void 0:t.remove(this.objectPool[r]);var n=this.objectPool.slice(this.objectPool.length-e,this.objectPool.length);o=__spread(n)}else o=__spread(this.objectPool);this.objectPool=o,this.keepSize=e,this.currentObjectIndex=this.objectPool.length-1},t.prototype.removeAllObjects=function(){var e=this;this.objectPool.forEach(function(t,o){var a;null===(a=t.parent)||void 0===a?void 0:a.remove(t),delete e.objectPool[o]}),this.objectPool=[]},t.prototype.checkToleranceThresholdExceed=function(e){if(0===this.objectPool.length)return!0;var t={position:this.objectPool[this.currentObjectIndex].position,quaternion:this.objectPool[this.currentObjectIndex].quaternion};return checkToleranceThresholdExceed(t,e,this.options)},t.prototype.getObject=function(){var e=this.options.type;return e===ODOMETRY_OBJECT_TYPES.arrow?new Arrow:e===ODOMETRY_OBJECT_TYPES.axes?new Axes:new Object3D},t.prototype.changeObjectPoolType=function(){var e=this,t=[];this.objectPool.forEach(function(o,a){var r,i,n=o.position,s=o.quaternion;null===(r=o.parent)||void 0===r?void 0:r.remove(o),delete e.objectPool[a];var l=e.getObject();l.position.set(n.x,n.y,n.z),l.quaternion.set(s.x,s.y,s.z,s.w),t.push(l),null===(i=e.object)||void 0===i?void 0:i.add(l),setObjectDimension(l,e.options)}),this.objectPool=t},t.prototype.updateOptions=function(t){var o=this,a=this.options.type;e.prototype.updateOptions.call(this,t);var r=this.options,i=r.keep,n=r.type;n!==a&&this.changeObjectPoolType(),this.objectPool.forEach(function(e){setObjectDimension(e,o.options)}),this.setKeepSize(i)},t.prototype.update=function(t){var o,a;if(e.prototype.update.call(this,t),!this.keepSize)return void this.removeAllObjects();var r=t.pose.pose,i=r.orientation,n=r.position,s={translation:n,rotation:i},l={position:new Vector3(n.x,n.y,n.z),quaternion:new Quaternion(i.x,i.y,i.z,i.w)},d=this.checkToleranceThresholdExceed(l);if(d){var p=this.getObject();if(setObjectDimension(p,this.options),this.objectPool.push(p),this.currentObjectIndex+=1,this.currentObjectIndex=MathUtils.clamp(this.currentObjectIndex,0,this.keepSize-1),null===(o=this.object)||void 0===o?void 0:o.add(p),setTransform(p,s),this.objectPool.length>this.keepSize){var c=this.objectPool[0];null===(a=this.object)||void 0===a?void 0:a.remove(c),delete this.objectPool[0];var m=this.objectPool.slice(1);this.objectPool=__spread(m)}}},t}(LiveCore),PoseArray=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_POSEARRAY);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_POSEARRAY),o)})||this;return a.object=new Group$1,a}return __extends(t,e),t.prototype.update=function(t){assertIsDefined(this.object),e.prototype.update.call(this,t),this.object.children.forEach(function(e){var t;null===(t=e.parent)||void 0===t?void 0:t.remove(e)}),this.object.children=[];for(var o,a=0;a<t.poses.length;a++)o=Pose.getNewPrimitive(this.options),o&&(setTransform(o,{translation:t.poses[a].position,rotation:t.poses[a].orientation}),setObjectDimension(o,this.options),this.object.add(o))},t}(LiveCore),Path=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_PATH);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_PATH),o)})||this,r=a.options,i=r.alpha,n=r.color;return a.object=new Group,a.line=new Line(null,!0),a.line.setColor(new Color(n)),a.line.setAlpha(i),a}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t);var o=this.options,a=o.alpha,r=o.color;this.line.setColor(new Color(r)),this.line.setAlpha(a)},t.prototype.update=function(t){var o;e.prototype.update.call(this,t);var a=t.poses,r=(a||[]).map(function(e){return e.pose.position});this.line.updatePoints(r),null===(o=this.object)||void 0===o?void 0:o.add(this.line)},t}(LiveCore),Image=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_IMAGE);var a=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_IMAGE),o)})||this;a.hide=function(){assertIsDefined(a.object),a.object.style.visibility="hidden"},a.show=function(){assertIsDefined(a.object),a.object.style.visibility="visible"};var r=a.options,i=r.height,n=r.width;return a.object=document.createElement("canvas"),a.shadowObject=document.createElement("canvas"),a.object.width=n,a.object.height=i,a}return __extends(t,e),t.prototype.applyImageData=function(e){var t=e.encoding,o=e.height,a=e.width;assertIsDefined(this.object);var r=this.object.getContext("2d");assertIsDefined(r);var i=this.shadowObject.getContext("2d");assertIsDefined(i);var n=i.createImageData(a,o),s=a/o;switch(t){case"bayer_rggb8":case"bayer_bggr8":case"bayer_gbrg8":case"bayer_grbg8":case"bayer_rggb16":case"bayer_bggr16":case"bayer_gbrg16":case"bayer_grbg16":case"8UC1":case"8SC1":case"mono8":{populateImageDataFromImageMsg(e,1,[0,0,0],n);break}case"8UC3":case"8SC3":case"bgr8":{populateImageDataFromImageMsg(e,3,[2,1,0],n);break}case"8UC4":case"8SC4":case"bgra8":{populateImageDataFromImageMsg(e,4,[2,1,0,3],n);break}case"rgb8":{populateImageDataFromImageMsg(e,3,[0,1,2],n);break}case"rgba8":{populateImageDataFromImageMsg(e,4,[0,1,2,3],n);break}}r.clearRect(0,0,this.object.width,this.object.height),r.fillStyle="#000",r.fillRect(0,0,this.object.width,this.object.height),i.clearRect(0,0,this.shadowObject.width,this.shadowObject.height),i.putImageData(n,0,0);var l=this.object.width/s,d=this.object.height*s;s>=this.object.width/this.object.height?r.drawImage(this.shadowObject,0,0,a,o,0,(this.object.height-l)/2,this.object.width,l):r.drawImage(this.shadowObject,0,0,a,o,(this.object.width-d)/2,0,d,this.object.height)},t.prototype.updateDimensions=function(e,t){assertIsDefined(this.object),this.object.width=e,this.object.height=t},t.prototype.update=function(e){var t=e.height,o=e.width;this.shadowObject.width=o,this.shadowObject.height=t,this.applyImageData(e)},t}(LiveCore),StaticCore=function(){function e(e){var t,o=this;this.hide=function(){assertIsDefined(o.object),isObject3D(o.object)?o.object.visible=!1:isHTMLElement(o.object)&&(o.object.style.visibility="hidden")},this.show=function(){assertIsDefined(o.object),isObject3D(o.object)?o.object.visible=!0:isHTMLElement(o.object)&&(o.object.style.visibility="visible")},this.destroy=function(){var e,t,a,r;isObject3D(o.object)?null===(t=null===(e=o.object)||void 0===e?void 0:e.parent)||void 0===t?void 0:t.remove(o.object):isHTMLElement(o.object)&&(null===(r=null===(a=o.object)||void 0===a?void 0:a.parentElement)||void 0===r?void 0:r.removeChild(o.object)),o.object=void 0},this.reset=function(){},this.options=null!==(t=e.options)&&void 0!==t?t:{},this.updateOptions=this.updateOptions.bind(this)}return e.prototype.updateOptions=function(e){this.options=__assign(__assign({},this.options),e)},e}(),ImageStream=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_IMAGE_STREAM);var a=e.call(this,{options:__assign(__assign({},DEFAULT_OPTIONS_IMAGE_STREAM),o)})||this;a.hide=function(){assertIsDefined(a.object),a.object.style.visibility="hidden"},a.show=function(){assertIsDefined(a.object),a.object.style.visibility="visible"};var r=a.options,i=r.height,n=r.width;return a.url=t,a.object=document.createElement("img"),a.object.src=a.url,a.object.setAttribute("draggable","false"),a.object.width=n,a.object.height=i,a}return __extends(t,e),t}(StaticCore),Marker=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_MARKER);var a,r=e.call(this,{sources:[t],options:__assign(__assign({},DEFAULT_OPTIONS_MARKER),o)})||this;return r.reset=function(){r.markerManager.reset()},r.object=new Group,r.markerManager=new MarkerManager(r.object,null!==(a=r.onNameSpaceChange)&&void 0!==a?a:function(){return null}),r.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_MARKER),o)),r}return __extends(t,e),t.prototype.updateOptions=function(t){e.prototype.updateOptions.call(this,t),this.markerManager.updateOptions(this.options)},t.prototype.update=function(t){e.prototype.update.call(this,t),this.markerManager.updateMarker(t)},t}(LiveCore),Range=function(e){var t=Math.PI;function o(o,a){void 0===a&&(a=DEFAULT_OPTIONS_RANGE);var r=e.call(this,{sources:[o],options:__assign(__assign({},DEFAULT_OPTIONS_RANGE),a)})||this,i=r.options,n=i.alpha,s=i.color;return r.object=new Group,r.cylinder=new Cylinder(r.options.color,.01,.01),r.cylinder.rotateZ(t/2),r.object.add(r.cylinder),r.cylinder.setAlpha(n),r.cylinder.setColor(new Color(s)),r}return __extends(o,e),o.prototype.update=function(t){var o=Math.tan;e.prototype.update.call(this,t);var a=t.field_of_view,r=t.max_range,i=t.min_range;this.cylinder.geometry=new CylinderGeometry(i*o(a)/4,r*o(a)/4,r-i,DEFAULT_RADIAL_SEGMENTS,DEFAULT_RADIAL_SEGMENTS),this.cylinder.geometry.verticesNeedUpdate=!0,this.cylinder.position.setX(.5*(i+r))},o}(LiveCore),stats_min=createCommonjsModule(function(o,a){!function(a,e){o.exports=e()}(commonjsGlobal,function(){var s=function(){function p(t){return u.appendChild(t.dom),t}function c(o){for(var e=0;e<u.children.length;e++)u.children[e].style.display=e===o?"block":"none";m=o}var m=0,u=document.createElement("div");u.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",u.addEventListener("click",function(t){t.preventDefault(),c(++m%u.children.length)},!1);var l=(performance||Date).now(),h=l,g=0,y=p(new s.Panel("FPS","#0ff","#002")),b=p(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var r=p(new s.Panel("MB","#f08","#201"));return c(0),{REVISION:16,dom:u,addPanel:p,showPanel:c,begin:function(){l=(performance||Date).now()},end:function(){g++;var o=(performance||Date).now();if(b.update(o-l,200),h+1e3<=o&&(y.update(1e3*g/(o-h),100),h=o,g=0,r)){var e=performance.memory;r.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return o},update:function(){l=this.end()},domElement:u,setMode:c}};return s.Panel=function(g,n,l){var i=1/0,b=0,E=Math.round,f=E(window.devicePixelRatio||1),r=80*f,t=48*f,d=3*f,c=2*f,p=3*f,u=15*f,s=74*f,m=30*f,h=document.createElement("canvas");h.width=r,h.height=t,h.style.cssText="width:80px;height:48px";var y=h.getContext("2d");return y.font="bold "+9*f+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=l,y.fillRect(0,0,r,t),y.fillStyle=n,y.fillText(g,d,c),y.fillRect(p,u,s,m),y.fillStyle=l,y.globalAlpha=.9,y.fillRect(p,u,s,m),{dom:h,update:function(o,e){i=Math.min(i,o),b=Math.max(b,o),y.fillStyle=l,y.globalAlpha=1,y.fillRect(0,0,r,u),y.fillStyle=n,y.fillText(E(o)+" "+g+" ("+E(i)+"-"+E(b)+")",d,c),y.drawImage(h,p+f,u,s-f,m,p,u,s-f,m),y.fillRect(p+s-f,u,f,m),y.fillStyle=l,y.globalAlpha=.9,y.fillRect(p+s-f,u,f,E((1-o/e)*m))}}},s})}),Scene=function(e){var t=Math.PI;function o(t){void 0===t&&(t=DEFAULT_OPTIONS_SCENE);var o=e.call(this)||this;return o.options=DEFAULT_OPTIONS_SCENE,o.vizWrapper=new Group$1,o.add(o.vizWrapper),o.stats=new stats_min,o.stats.showPanel(0),o.initLights(),o.initGrid(),o.updateOptions(t),o}return __extends(o,e),o.prototype.initLights=function(){var e=this;[[-1,0],[1,0],[0,-1],[0,1]].forEach(function(t){var o,a=new DirectionalLight(16777215,.4);o=__read(t,2),a.position.x=o[0],a.position.y=o[1],a.position.z=1,e.add(a)});var t=new AmbientLight(16777215,.2);this.add(t)},o.prototype.initGrid=function(){this.grid=new GridHelper(0,0),this.add(this.grid)},o.prototype.addObject=function(e){this.vizWrapper.add(e)},o.prototype.addVisualization=function(e){var t=e.object;t&&(this.vizWrapper.getObjectById(t.id)||this.addObject(t))},o.prototype.getObjectByName=function(e){return this.vizWrapper.getObjectByName(e)},o.prototype.updateOptions=function(e){var o,a;void 0===e&&(e=DEFAULT_OPTIONS_SCENE),this.options=__assign(__assign({},DEFAULT_OPTIONS_SCENE),e);var r=this.options,i=r.backgroundColor,n=r.gridCenterlineColor,s=r.gridColor,l=r.gridDivisions,d=r.gridSize;null===(o=this.grid)||void 0===o?void 0:o.copy(new GridHelper(d,l,n,s)),null===(a=this.grid)||void 0===a?void 0:a.rotateX(-t/2),this.background=new Color(i)},o}(Scene$1),vertexShader="uniform sampler2D map;\n\nuniform float width;\nuniform float height;\nuniform float nearClipping, farClipping;\n\nuniform float pointSize;\nuniform float zOffset;\n\nuniform float focallength;\nuniform float maxDepthPerTile;\nuniform float resolutionFactor;\n\nvarying vec2 vUvP;\nvarying vec2 colorP;\n\nvarying float depthVariance;\nvarying float maskVal;\n\nfloat sampleDepth(vec2 pos)\n  {\n    float depth;\n\n    vec2 vUv = vec2( pos.x / (width*2.0), pos.y / (height*2.0)+0.5 );\n    vec2 vUv2 = vec2( pos.x / (width*2.0)+0.5, pos.y / (height*2.0)+0.5 );\n\n    vec4 depthColor = texture2D( map, vUv );\n\n    depth = ( depthColor.r + depthColor.g + depthColor.b ) / 3.0 ;\n\n    if (depth>0.99)\n    {\n      vec4 depthColor2 = texture2D( map, vUv2 );\n      float depth2 = ( depthColor2.r + depthColor2.g + depthColor2.b ) / 3.0 ;\n      depth = 0.99+depth2;\n    }\n\n    return depth;\n  }\n\nfloat median(float a, float b, float c)\n  {\n    float r=a;\n\n    if ( (a<b) && (b<c) )\n    {\n      r = b;\n    }\n    if ( (a<c) && (c<b) )\n    {\n      r = c;\n    }\n    return r;\n  }\n\nfloat variance(float d1, float d2, float d3, float d4, float d5, float d6, float d7, float d8, float d9)\n  {\n    float mean = (d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9) / 9.0;\n    float t1 = (d1-mean);\n    float t2 = (d2-mean);\n    float t3 = (d3-mean);\n    float t4 = (d4-mean);\n    float t5 = (d5-mean);\n    float t6 = (d6-mean);\n    float t7 = (d7-mean);\n    float t8 = (d8-mean);\n    float t9 = (d9-mean);\n    float v = (t1*t1+t2*t2+t3*t3+t4*t4+t5*t5+t6*t6+t7*t7+t8*t8+t9*t9)/9.0;\n    return v;\n  }\n\nvec2 decodeDepth(vec2 pos)\n  {\n    vec2 ret;\n\n\n    float depth1 = sampleDepth(vec2(position.x-1.0, position.y-1.0));\n    float depth2 = sampleDepth(vec2(position.x, position.y-1.0));\n    float depth3 = sampleDepth(vec2(position.x+1.0, position.y-1.0));\n    float depth4 = sampleDepth(vec2(position.x-1.0, position.y));\n    float depth5 = sampleDepth(vec2(position.x, position.y));\n    float depth6 = sampleDepth(vec2(position.x+1.0, position.y));\n    float depth7 = sampleDepth(vec2(position.x-1.0, position.y+1.0));\n    float depth8 = sampleDepth(vec2(position.x, position.y+1.0));\n    float depth9 = sampleDepth(vec2(position.x+1.0, position.y+1.0));\n\n    float median1 = median(depth1, depth2, depth3);\n    float median2 = median(depth4, depth5, depth6);\n    float median3 = median(depth7, depth8, depth9);\n\n    ret.x = median(median1, median2, median3);\n    ret.y = variance(depth1, depth2, depth3, depth4, depth5, depth6, depth7, depth8, depth9);\n\n    return ret;\n\n  }\n\n\nvoid main() {\n\n  vUvP = vec2( position.x / (width*2.0), position.y / (height*2.0)+0.5 );\n  colorP = vec2( position.x / (width*2.0)+0.5 , position.y / (height*2.0)  );\n\n  vec4 pos = vec4(0.0,0.0,0.0,0.0);\n  depthVariance = 0.0;\n\n  if ( (vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>0.0))\n  {\n    vec2 smp = decodeDepth(vec2(position.x, position.y));\n    float depth = smp.x;\n    depthVariance = smp.y;\n\n    float z = -depth;\n\n    pos = vec4(\n      ( position.x / width - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength) * -1.0,\n      ( position.y / height - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength),\n      (- z + zOffset / 1000.0) * maxDepthPerTile,\n      1.0);\n\n    vec2 maskP = vec2( position.x / (width*2.0), position.y / (height*2.0)  );\n    vec4 maskColor = texture2D( map, maskP );\n    maskVal = ( maskColor.r + maskColor.g + maskColor.b ) / 3.0 ;\n  }\n\n  gl_PointSize = pointSize;\n  gl_Position = projectionMatrix * modelViewMatrix * pos;\n\n}",fragmentShader="uniform sampler2D map;\nuniform float varianceThreshold;\nuniform float whiteness;\n\nvarying vec2 vUvP;\nvarying vec2 colorP;\n\nvarying float depthVariance;\nvarying float maskVal;\n\n\nvoid main() {\n\n  vec4 color;\n\n  if ( (depthVariance>varianceThreshold) || (maskVal>0.5) ||(vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>1.0))\n  {\n    discard;\n  }\n  else\n  {\n    color = texture2D( map, colorP );\n\n    float fader = whiteness /100.0;\n\n    color.r = color.r * (1.0-fader)+ fader;\n\n    color.g = color.g * (1.0-fader)+ fader;\n\n    color.b = color.b * (1.0-fader)+ fader;\n\n    color.a = 1.0;//smoothstep( 20000.0, -20000.0, gl_FragCoord.z / gl_FragCoord.w );\n  }\n\n  gl_FragColor = vec4( color.r, color.g, color.b, color.a );\n\n}",DepthCloudObject=function(e){var t=Math.max;function o(t,o){void 0===o&&(o=DEFAULT_OPTIONS_DEPTHCLOUD);var a=e.call(this)||this;return a.options=DEFAULT_OPTIONS_DEPTHCLOUD,a.metaLoaded=!1,a.options=__assign(__assign({},DEFAULT_OPTIONS_DEPTHCLOUD),o),a.url=t,a.animate=a.animate.bind(a),a.onMetaLoaded=a.onMetaLoaded.bind(a),a}return __extends(o,e),o.prototype.onMetaLoaded=function(){this.metaLoaded=!0,this.initStreamer()},o.prototype.isMjpeg=function(){var e=this.options.streamType;return"mjpeg"===e.toLowerCase()},o.prototype.initVideo=function(){var e=this.options,t=e.height,o=e.width;this.video=document.createElement(this.isMjpeg()?"img":"video"),this.video.width=o,this.video.height=t,this.video.addEventListener(this.isMjpeg()?"load":"loadedmetadata",this.onMetaLoaded,!1),this.isMjpeg()||(assertIsHTMLVideoElement(this.video),this.video.loop=!0),this.video.src=this.url,this.video.crossOrigin="Anonymous",this.video.setAttribute("crossorigin","Anonymous")},o.prototype.initStreamer=function(){var e=this.options,o=e.f,a=e.height,r=e.maxDepthPerTile,n=e.pointSize,s=e.varianceThreshold,d=e.whiteness,p=e.width,c=t(p,a)/1024;if(this.metaLoaded){this.texture=new Texture(this.video),this.geometry=new Geometry;for(var m=p/2,u=a/2,h=0,g=m*u;h<g;h+=1)this.geometry.vertices.push(new Vector3(h%m,h/m,0));this.material=new ShaderMaterial({uniforms:{map:{value:this.texture},width:{value:m},height:{value:u},focallength:{value:o},pointSize:{value:n},zOffset:{value:0},whiteness:{value:d},varianceThreshold:{value:s},maxDepthPerTile:{value:r},resolutionFactor:{value:c}},vertexShader:vertexShader,fragmentShader:fragmentShader}),this.mesh=new Points$2(this.geometry,this.material),this.mesh.frustumCulled=!1,this.mesh.position.set(0,0,0),this.add(this.mesh),requestAnimationFrame(this.animate)}},o.prototype.animate=function(){var e;this.texture&&(this.isMjpeg()?this.texture.needsUpdate=!0:(assertIsHTMLVideoElement(this.video),this.video.readyState===this.video.HAVE_ENOUGH_DATA&&(this.texture.needsUpdate=!0)),(null===(e=this.video)||void 0===e?void 0:e.src)&&requestAnimationFrame(this.animate))},o.prototype.startStream=function(){this.isMjpeg()||(assertIsHTMLVideoElement(this.video),this.video.play())},o.prototype.stopStream=function(){var e;this.isMjpeg()||(assertIsHTMLVideoElement(this.video),this.video.pause()),null===(e=this.video)||void 0===e?void 0:e.removeAttribute("src")},o}(Object3D),DepthCloud=function(e){function t(t,o){void 0===o&&(o=DEFAULT_OPTIONS_DEPTHCLOUD);var a=e.call(this,{sources:[],options:__assign(__assign({},DEFAULT_OPTIONS_DEPTHCLOUD),o)})||this;return a.subscribe=function(){var e,t;null===(e=a.object)||void 0===e?void 0:e.initVideo(),null===(t=a.object)||void 0===t?void 0:t.startStream()},a.unsubscribe=function(){var e;null===(e=a.object)||void 0===e?void 0:e.stopStream()},a.url=t,a.object=new DepthCloudObject(t,o),a}return __extends(t,e),t}(LiveCore),MapControls2D=function(e,t){function o(e){if(!1!==d.enabled){b.set(e.clientX,e.clientY);var t=b.x-f.x,o=b.y-f.y;h===u.ROTATE?d.rotate(c.set(-t,-o,0)):h===u.ZOOM?d.zoom(c.set(0,0,o)):h===u.PAN&&d.pan(c.set(-t,o,0)),f.set(e.clientX,e.clientY)}}function a(){t.removeEventListener("mousemove",o,!1),t.removeEventListener("mouseup",a,!1),t.removeEventListener("mouseout",a,!1),t.removeEventListener("dblclick",a,!1),h=u.NONE}function r(e){e.preventDefault(),d.zoom(c.set(0,0,0<e.deltaY?1:-1))}function i(e){!1===d.enabled||(0===e.button?h=u.ROTATE:1===e.button?h=u.ZOOM:2===e.button&&(h=u.PAN),f.set(e.clientX,e.clientY),t.addEventListener("mousemove",o,!1),t.addEventListener("mouseup",a,!1),t.addEventListener("mouseout",a,!1),t.addEventListener("dblclick",a,!1))}function n(e){e.preventDefault()}function s(e){if(!1!==d.enabled){switch(e.touches.length){case 1:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),O=_[0].distanceTo(_[1]);}S[0].copy(_[0]),S[1].copy(_[1])}}function l(e){function t(e,t){var o=t[0];for(var a in t)o.distanceTo(e)>t[a].distanceTo(e)&&(o=t[a]);return o}if(!1!==d.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),d.rotate(_[0].sub(t(_[0],S)).multiplyScalar(-1));break;case 2:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var o=_[0].distanceTo(_[1]);d.zoom(c.set(0,0,O-o)),O=o;var a=_[0].clone().sub(t(_[0],S)),r=_[1].clone().sub(t(_[1],S));a.x=-a.x,r.x=-r.x,d.pan(a.add(r));}S[0].copy(_[0]),S[1].copy(_[1])}}t=t===void 0?document:t,this.enabled=!0,this.center=new Vector3,this.panSpeed=.01,this.zoomSpeed=.05,this.rotationSpeed=.005;var d=this,p=new Vector3,c=new Vector3,m=new Box3,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},h=u.NONE,g=this.center,y=new Matrix3,b=new Vector2,f=new Vector2,E=new Spherical,v=new Sphere$1,T={type:"change"};this.focus=function(t){var o;m.setFromObject(t),!1===m.isEmpty()?(m.getCenter(g),o=m.getBoundingSphere(v).radius):(g.setFromMatrixPosition(t.matrixWorld),o=.1),c.set(0,0,1),c.applyQuaternion(e.quaternion),c.multiplyScalar(4*o),e.position.copy(g).add(c),d.dispatchEvent(T)},this.pan=function(t){var o=e.zoom;t.multiplyScalar(d.panSpeed/o),t.applyMatrix3(y.getNormalMatrix(e.matrix)),e.position.add(t),g.add(t),d.dispatchEvent(T)},this.zoom=function(t){e.zoom-=.1*((t.z||0)*e.zoom),e.updateProjectionMatrix(),d.dispatchEvent(T)},this.rotate=function(t){p.copy(e.position).sub(g),E.setFromCartesianCoords(-1*p.x,p.z,p.y),E.theta+=t.x*d.rotationSpeed,E.makeSafe();var o=p.setFromSpherical(E);p.set(-1*o.x,o.z,o.y),e.position.copy(g).add(p),e.lookAt(g),d.dispatchEvent(T)},t.addEventListener("contextmenu",n,!1),t.addEventListener("mousedown",i,!1),t.addEventListener("wheel",r,!1);var _=[new Vector3,new Vector3,new Vector3],S=[new Vector3,new Vector3,new Vector3],O=null;t.addEventListener("touchstart",s,!1),t.addEventListener("touchmove",l,!1),this.dispose=function(){t.removeEventListener("contextmenu",n,!1),t.removeEventListener("mousedown",i,!1),t.removeEventListener("wheel",r,!1),t.removeEventListener("mousemove",o,!1),t.removeEventListener("mouseup",a,!1),t.removeEventListener("mouseout",a,!1),t.removeEventListener("dblclick",a,!1),t.removeEventListener("touchstart",s,!1),t.removeEventListener("touchmove",l,!1)}};MapControls2D.prototype=Object.create(EventDispatcher.prototype),MapControls2D.prototype.constructor=MapControls2D;var ResizeObserver=window.ResizeObserver||ResizeObserver$2,Viewer2d=function(){var e=Math.abs;function t(e,t){var o=this;void 0===t&&(t=DEFAULT_OPTIONS_SCENE),this.options=DEFAULT_OPTIONS_SCENE,this.previousWidth=0,this.previousHeight=0,this.options=__assign(__assign({},DEFAULT_OPTIONS_SCENE),t),this.scene=e||new Scene,this.ro=new ResizeObserver(function(e){0<e.length&&o.onWindowResize()}),this.initCamera(),this.animate=this.animate.bind(this),this.onWindowResize=this.onWindowResize.bind(this)}return t.prototype.animate=function(){var e;this.scene.stats.begin(),this.scene.updateMatrixWorld(),assertIsDefined(this.camera),null===(e=this.renderer)||void 0===e?void 0:e.render(this.scene,this.camera),this.scene.stats.end(),requestAnimationFrame(this.animate)},t.prototype.initCamera=function(){this.camera=new OrthographicCamera(-100,100,100,-100,.1,1e3),this.camera.zoom=.5,this.camera.position.set(0,0,10),this.camera.up=new Vector3(0,0,1),this.camera.lookAt(new Vector3),this.scene.add(this.camera)},t.prototype.setContainer=function(e){this.container=e,this.initRenderer(e),this.controls=new MapControls2D(this.camera,this.container),this.controls.enableDamping=!0,this.ro.observe(this.container),requestAnimationFrame(this.animate),this.onWindowResize()},t.prototype.initRenderer=function(e){var t=new WebGLRenderer({antialias:!0});t.autoClear=!1,t.setPixelRatio(window.devicePixelRatio),assertIsDefined(this.container),t.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer=t,this.container.appendChild(t.domElement)},t.prototype.updateOptions=function(e){void 0===e&&(e=DEFAULT_OPTIONS_SCENE),this.options=__assign(__assign({},this.options),e),this.scene.updateOptions(this.options)},t.prototype.destroy=function(){this.ro.unobserve(this.container)},t.prototype.onWindowResize=function(){var t;assertIsDefined(this.container),assertIsDefined(this.camera);var o=this.container,a=o.offsetHeight,r=o.offsetWidth;if(10<e(r-this.previousWidth)||10<e(a-this.previousHeight)){var i=__read([r/100,a/100],2),n=i[0],s=i[1];this.camera.left=-n/2,this.camera.right=n/2,this.camera.top=s/2,this.camera.bottom=-s/2,this.camera.updateProjectionMatrix(),null===(t=this.renderer)||void 0===t?void 0:t.setSize(r,a),this.previousWidth=r,this.previousHeight=a}},t.prototype.addVisualization=function(e){this.scene.addVisualization(e)},t}(),EditorControls=function(e,t){function o(e){!1===d.enabled||(0===e.button?h=u.ROTATE:1===e.button?h=u.ZOOM:2===e.button&&(h=u.PAN),f.set(e.clientX,e.clientY),t.addEventListener("mousemove",a,!1),t.addEventListener("mouseup",r,!1),t.addEventListener("mouseout",r,!1),t.addEventListener("dblclick",r,!1))}function a(e){if(!1!==d.enabled){b.set(e.clientX,e.clientY);var t=b.x-f.x,o=b.y-f.y;h===u.ROTATE?d.rotate(c.set(-t,-o,0)):h===u.ZOOM?d.zoom(c.set(0,0,o)):h===u.PAN&&d.pan(c.set(-t,o,0)),f.set(e.clientX,e.clientY)}}function r(e){t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),h=u.NONE}function i(e){e.preventDefault(),d.zoom(c.set(0,0,0<e.deltaY?1:-1))}function n(e){e.preventDefault()}function s(e){if(!1!==d.enabled){switch(e.touches.length){case 1:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio);break;case 2:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio),O=_[0].distanceTo(_[1]);}S[0].copy(_[0]),S[1].copy(_[1])}}function l(e){function t(e,t){var o=t[0];for(var a in t)o.distanceTo(e)>t[a].distanceTo(e)&&(o=t[a]);return o}if(!1!==d.enabled){switch(e.preventDefault(),e.stopPropagation(),e.touches.length){case 1:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),d.rotate(_[0].sub(t(_[0],S)).multiplyScalar(-1));break;case 2:_[0].set(e.touches[0].pageX,e.touches[0].pageY,0).divideScalar(window.devicePixelRatio),_[1].set(e.touches[1].pageX,e.touches[1].pageY,0).divideScalar(window.devicePixelRatio);var o=_[0].distanceTo(_[1]);d.zoom(c.set(0,0,O-o)),O=o;var a=_[0].clone().sub(t(_[0],S)),r=_[1].clone().sub(t(_[1],S));a.x=-a.x,r.x=-r.x,d.pan(a.add(r));}S[0].copy(_[0]),S[1].copy(_[1])}}t=t===void 0?document:t,this.enabled=!0,this.center=new Vector3,this.panSpeed=.002,this.zoomSpeed=.1,this.rotationSpeed=.005;var d=this,p=new Vector3,c=new Vector3,m=new Box3,u={NONE:-1,ROTATE:0,ZOOM:1,PAN:2},h=u.NONE,g=this.center,y=new Matrix3,b=new Vector2,f=new Vector2,E=new Spherical,v=new Sphere$1,T={type:"change"};this.focus=function(t){var o;m.setFromObject(t),!1===m.isEmpty()?(m.getCenter(g),o=m.getBoundingSphere(v).radius):(g.setFromMatrixPosition(t.matrixWorld),o=.1),c.set(0,0,1),c.applyQuaternion(e.quaternion),c.multiplyScalar(4*o),e.position.copy(g).add(c),d.dispatchEvent(T)},this.pan=function(t){var o=e.position.distanceTo(g);t.multiplyScalar(o*d.panSpeed),t.applyMatrix3(y.getNormalMatrix(e.matrix)),e.position.add(t),g.add(t),d.dispatchEvent(T)},this.zoom=function(t){var o=e.position.distanceTo(g);t.multiplyScalar(o*d.zoomSpeed);t.length()>o||(t.applyMatrix3(y.getNormalMatrix(e.matrix)),e.position.add(t),d.dispatchEvent(T))},this.rotate=function(t){p.copy(e.position).sub(g),E.setFromCartesianCoords(-1*p.x,p.z,p.y),E.theta+=t.x*d.rotationSpeed,E.phi+=t.y*d.rotationSpeed,E.makeSafe();var o=p.setFromSpherical(E);p.set(-1*o.x,o.z,o.y),e.position.copy(g).add(p),e.lookAt(g),d.dispatchEvent(T)},this.dispose=function(){t.removeEventListener("contextmenu",n,!1),t.removeEventListener("mousedown",o,!1),t.removeEventListener("wheel",i,!1),t.removeEventListener("mousemove",a,!1),t.removeEventListener("mouseup",r,!1),t.removeEventListener("mouseout",r,!1),t.removeEventListener("dblclick",r,!1),t.removeEventListener("touchstart",s,!1),t.removeEventListener("touchmove",l,!1)},t.addEventListener("contextmenu",n,!1),t.addEventListener("mousedown",o,!1),t.addEventListener("wheel",i,!1);var _=[new Vector3,new Vector3,new Vector3],S=[new Vector3,new Vector3,new Vector3],O=null;t.addEventListener("touchstart",s,!1),t.addEventListener("touchmove",l,!1)};EditorControls.prototype=Object.create(EventDispatcher.prototype),EditorControls.prototype.constructor=EditorControls;var ResizeObserver$1=window.ResizeObserver||ResizeObserver$2,Viewer3d=function(){var e=Math.abs;function t(e,t){var o=this;void 0===t&&(t={}),this.options={},this.previousWidth=0,this.previousHeight=0,this.options=__assign(__assign({},DEFAULT_OPTIONS_SCENE),t),this.scene=e||new Scene(this.options),this.ro=new ResizeObserver$1(function(e){0<e.length&&o.onWindowResize()}),this.initCamera(),this.animate=this.animate.bind(this),this.onWindowResize=this.onWindowResize.bind(this)}return t.prototype.animate=function(){var e;this.scene.stats.begin(),this.scene.updateMatrixWorld(),assertIsDefined(this.camera),null===(e=this.renderer)||void 0===e?void 0:e.render(this.scene,this.camera),this.scene.stats.end(),requestAnimationFrame(this.animate)},t.prototype.initCamera=function(){this.camera=new PerspectiveCamera(50,1,.01,1e3),this.camera.position.set(0,5,10),this.camera.up=new Vector3(0,0,1),this.camera.lookAt(new Vector3),this.scene.add(this.camera)},t.prototype.setContainer=function(e){this.container=e,this.initRenderer(),this.controls=new EditorControls(this.camera,this.container),this.controls.enableDamping=!0,this.ro.observe(this.container),requestAnimationFrame(this.animate),this.onWindowResize()},t.prototype.initRenderer=function(){var e=new WebGLRenderer({antialias:!0});e.autoClear=!1,e.setPixelRatio(window.devicePixelRatio),assertIsDefined(this.container),e.setSize(this.container.offsetWidth,this.container.offsetHeight),this.renderer=e,this.container.appendChild(e.domElement)},t.prototype.updateOptions=function(e){void 0===e&&(e=DEFAULT_OPTIONS_SCENE),this.options=__assign(__assign({},this.options),e),this.scene.updateOptions(this.options)},t.prototype.destroy=function(){this.ro.unobserve(this.container)},t.prototype.onWindowResize=function(){var t;assertIsDefined(this.container),assertIsDefined(this.camera);var o=this.container,a=o.offsetHeight,r=o.offsetWidth;(10<e(r-this.previousWidth)||10<e(a-this.previousHeight))&&(this.camera.aspect=r/a,this.camera.updateProjectionMatrix(),null===(t=this.renderer)||void 0===t?void 0:t.setSize(r,a),this.previousWidth=r,this.previousHeight=a)},t.prototype.addVisualization=function(e){this.scene.addVisualization(e)},t}(),TfViewer=function(e){function t(t,o){void 0===o&&(o={});var a=e.call(this,null,__assign(__assign({},DEFAULT_OPTIONS_TF_VIEWER),o))||this;return a.options={},a.framesList=[],a.ros=t,a.onFramesListUpdate=o.onFramesListUpdate||function(){},a.initRosEvents(),a.getTFMessages=a.getTFMessages.bind(a),a.setFrameTransform=a.setFrameTransform.bind(a),a.addRobot=a.addRobot.bind(a),a.onRosConnection=a.onRosConnection.bind(a),a}return __extends(t,e),t.prototype.initRosEvents=function(){var e=this;this.ros.on("connection",function(){e.onRosConnection()}),this.ros.isConnected&&this.onRosConnection()},t.prototype.onRosConnection=function(){var e=this;this.ros.getTopics(function(t){["/tf","/tf_static"].forEach(function(o){var a=new ROSLIB.Topic({ros:e.ros,name:o,messageType:t.types[t.topics.indexOf(o)]});a.subscribe(e.getTFMessages)})})},t.prototype.getTFMessages=function(e){var t=this,o=e.transforms;o.forEach(function(e){var o=e.header.frame_id,a=e.child_frame_id,r=e.transform,i=r.rotation,n=i.w,s=i.x,l=i.y,d=i.z,p=r.translation,c=p.x,m=p.y,u=p.z,h=__read([t.getObjectOrCreate(a+"-tf-connector"),t.getObjectOrCreate(o+"-tf-connector")],2),g=h[0],y=h[1];y.add(g),g.position.set(c,m,u),g.quaternion.set(s,l,d,n),[o,a].forEach(function(e){-1===t.framesList.indexOf(e+"-tf-connector")&&t.framesList.push(e+"-tf-connector")})}),this.setFrameTransform()},t.prototype.getObjectOrCreate=function(e){var t=this.scene.vizWrapper;-1===this.framesList.indexOf(e)&&(this.framesList.push(e),this.onFramesListUpdate(this.framesList));var o=t.getObjectByName(e);if(o)return o;var a=new Group$1;return a.name=e,this.scene.addObject(a),a},t.prototype.setFrameTransform=function(){var e=this,t=e.options.selectedFrame,o=e.scene.vizWrapper;if(t){var a=this.getObjectOrCreate(t);if(a){o.position.set(0,0,0),o.quaternion.set(0,0,0,1),o.updateMatrixWorld();var r=new Vector3,i=new Quaternion;a.getWorldQuaternion(i);var n=i.w,s=i.x,l=i.y,d=i.z;o.quaternion.set(-s,-l,-d,n),o.updateMatrixWorld(),a.getWorldPosition(r);var p=r.negate();o.position.set(p.x,p.y,p.z)}}},t.prototype.addVisualization=function(t){var o=this;e.prototype.addVisualization.call(this,t),t.onHeaderChange=function(e){var a=o.getObjectOrCreate(e+"-tf-connector");a.add(t.object)}},t.prototype.attachObjectOutsideTree=function(e){if(e.frameId){var t=this.getObjectOrCreate(e.frameId+"-tf-connector");t.attach(e)}},t.prototype.addRobot=function(t){var o=this;t.loadFromParam(function(){var a;e.prototype.addVisualization.call(o,t);var r=(null===(a=t.object)||void 0===a?void 0:a.children[0]).links,i=Object.keys(r);i.map(function(e){var t=r[e],a=o.getObjectOrCreate(e+"-tf-connector");a.add(t)})})},t.prototype.setFixedFrame=function(){},t}(Viewer3d),InteractiveMarkerManager=function(){var e=Math.pow,t=Math.abs,o=Math.PI;function a(e,t,o){this.markerManagerMap={},this.controlsMap={},this.objectMap={},this.namespaces={},this.callback=function(){return null},this.object=e,this.viewer=t,this.hideOtherHandlesOnSelect=o.hideOtherHandlesOnSelect,this.hideOtherControlsInstancesOnSelect=o.hideOtherControlsInstancesOnSelect,this.visible=o.visible,this.onChange=this.onChange.bind(this)}return a.prototype.getMarkerManagerOrCreate=function(e){var t=e;if(!this.markerManagerMap[t]||!this.objectMap[t]){var o=new Group;o.name=t||"",this.markerManagerMap[t]=new MarkerManager(o,this.onChange),this.objectMap[t]=o,this.object.add(o)}return{manager:this.markerManagerMap[t],object:this.objectMap[t]}},a.prototype.onChange=function(){this.callback&&this.callback()},a.prototype.onNamespaceChange=function(e){this.callback=e},a.prototype.initMarkers=function(e,t,o){var r=this,i=e.controls,n=e.header.frame_id,s=e.name,l=e.pose,d=l.orientation,p=l.position,c=e.scale;0===c&&(c=1);var m=this.getMarkerManagerOrCreate(s),u=m.manager,h=m.object;h.visible=o,h.frameId=n,this.viewer.attachObjectOutsideTree&&this.viewer.attachObjectOutsideTree(h),h.setTransform({translation:p,rotation:d}),h.userData.control={frameId:e.header.frame_id,markerName:e.name},h.userData.handlesControlsMap={},i.forEach(function(e,n){var l,d,p=s;if(void 0===r.controlsMap[p]&&(r.controlsMap[p]=[]),(null===(l=r.controlsMap[p])||void 0===l?void 0:l.length)!==i.length){var m=e.orientation_mode===INTERACTIVE_MARKER_ORIENTATION_MODES.FIXED?ANCHOR_MODE.FIXED:ANCHOR_MODE.INHERIT,g=t.anchor(h,{separationT:{x:.4,y:.4,z:.4},orientation:e.orientation,mode:m,hideOtherHandlesOnSelect:r.hideOtherHandlesOnSelect,hideOtherControlsInstancesOnSelect:r.hideOtherControlsInstancesOnSelect,showHelperPlane:!0});g.scale.set(c,c,c),g.visible=o,a.enableControls(h,e.interaction_mode,e.orientation_mode,e.name,g,randomColor({seed:p+"-"+e.name+"-"+2*n})),null===(d=r.controlsMap[p])||void 0===d?void 0:d.push(g)}0<e.markers.length&&e.markers.forEach(function(e){u.updateMarker(e)})})},a.prototype.setVisible=function(e){this.visible=e;var t=Object.values(this.controlsMap);t.map(function(t){null===t||void 0===t?void 0:t.map(function(t){t.visible=e,t.object.visible=e})})},a.prototype.updatePose=function(e){var t=e.name,o=e.pose,a=this.objectMap[t];if(a&&o){var r=o.orientation,i=o.position;a.setTransform({translation:i,rotation:r})}},a.enableControls=function(e,t,o,r,i,n){var s;i.showAll(!1);var l=new Quaternion;i.getWorldQuaternion(l);var d=new Euler().setFromQuaternion(l),p=a.getAlignmentColor(d),c=null!==p&&void 0!==p?p:n;if(-1!==UNSUPPORTED_INTERACTIVE_MARKER_ORIENTATION_MODES.indexOf(o)&&t===INTERACTIVE_MARKER_INTERACTION_MODES.ROTATE_AXIS)return e.userData.handlesControlsMap=__assign(__assign({},e.userData.handlesControlsMap),(s={},s[DEFAULT_HANDLE_GROUP_NAME.ER]=r,s)),void i.showByNames([DEFAULT_HANDLE_GROUP_NAME.ER],!0);var m=[];switch(t){case INTERACTIVE_MARKER_INTERACTION_MODES.NONE:case INTERACTIVE_MARKER_INTERACTION_MODES.MENU:case INTERACTIVE_MARKER_INTERACTION_MODES.BUTTON:break;case INTERACTIVE_MARKER_INTERACTION_MODES.MOVE_AXIS:{m=[DEFAULT_HANDLE_GROUP_NAME.XPT,DEFAULT_HANDLE_GROUP_NAME.XNT],i.translationXP.setColor(c),i.translationXN.setColor(c);break}case INTERACTIVE_MARKER_INTERACTION_MODES.MOVE_PLANE:{m=[DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_YZ],i.pickPlaneYZ.setColor(c);break}case INTERACTIVE_MARKER_INTERACTION_MODES.ROTATE_AXIS:{m=[DEFAULT_HANDLE_GROUP_NAME.XR],i.rotationX.setColor(c);break}case INTERACTIVE_MARKER_INTERACTION_MODES.MOVE_ROTATE:{m=[DEFAULT_HANDLE_GROUP_NAME.XR,DEFAULT_HANDLE_GROUP_NAME.PICK_PLANE_YZ],i.pickPlaneYZ.setColor(c),i.rotationX.setColor(c);break}case INTERACTIVE_MARKER_INTERACTION_MODES.MOVE_3D:{m=[DEFAULT_HANDLE_GROUP_NAME.XPT,DEFAULT_HANDLE_GROUP_NAME.XNT,DEFAULT_HANDLE_GROUP_NAME.YPT,DEFAULT_HANDLE_GROUP_NAME.YNT,DEFAULT_HANDLE_GROUP_NAME.ZPT,DEFAULT_HANDLE_GROUP_NAME.ZNT,DEFAULT_HANDLE_GROUP_NAME.PICK];break}case INTERACTIVE_MARKER_INTERACTION_MODES.ROTATE_3D:{m=[DEFAULT_HANDLE_GROUP_NAME.XR,DEFAULT_HANDLE_GROUP_NAME.YR,DEFAULT_HANDLE_GROUP_NAME.ZR];break}case INTERACTIVE_MARKER_INTERACTION_MODES.MOVE_ROTATE_3D:{m=[DEFAULT_HANDLE_GROUP_NAME.PICK];break}}m.map(function(t){e.userData.handlesControlsMap[t]=r}),i.showByNames(m,!0)},a.getAlignmentColor=function(a){for(var r,n=e(10,-3),s=__read(a.toArray(),3),l=s[0],d=s[1],p=s[2],c=-4;4>=c;c++){if(r=c*o/2,t(l-r)<n&&t(d)<n&&t(p)<n)return"red";if(t(d-r)<n&&t(l)<n&&t(p)<n)return"green";if(t(p-r)<n&&t(d)<n&&t(l)<n)return"blue"}return null},a.prototype.removeObject=function(e){var t,o=this.objectMap[e];null===(t=o.parent)||void 0===t?void 0:t.remove(o),delete this.objectMap[e]},a.prototype.reset=function(e){var t=this;this.onChange(),e&&Object.keys(this.objectMap).forEach(function(e){t.removeObject(e)})},a}(),InteractiveMarkers=function(e){var t=Math.pow,o=Math.round;function a(a,r,i,n){void 0===n&&(n=DEFAULT_OPTIONS_INTERACTIVE_MARKER);var s=e.call(this,a,r,MESSAGE_TYPE_INTERACTIVEMARKER,__assign(__assign({},DEFAULT_OPTIONS_INTERACTIVE_MARKER),n))||this;s.init=!1,s.object=new Group,s.interactiveMarkersNames=new Set,s.interactiveMarkersFrameIds=new Set,s.clientId="amphion-"+o(Math.random()*t(10,8)),s.messageSequence=0,s.feedbackTopic=null,s.init=!1,s.viewer=i,s.updateOptions(__assign(__assign({},DEFAULT_OPTIONS_INTERACTIVE_MARKER),n)),s.interactiveMarkerManager=new InteractiveMarkerManager(s.object,i,s.options);var l=s.options.publishThrottleRate;return s.debouncedPublish=debounce(s.publish.bind(s),l&&0<l?l:0),s.initFreeformControls(),s.publishManual=s.publishManual.bind(s),s}return __extends(a,e),a.prototype.hide=function(){e.prototype.hide.call(this),this.interactiveMarkerManager.setVisible(!1)},a.prototype.show=function(){e.prototype.show.call(this),this.interactiveMarkerManager.setVisible(!0)},a.prototype.destroy=function(){var t;e.prototype.destroy.call(this),null===(t=this.freeformControls)||void 0===t?void 0:t.destroy(),this.freeformControls=null,this.interactiveMarkerManager.reset(!0),this.interactiveMarkersNames=new Set},a.prototype.initFreeformControls=function(){var e=this,t=this.viewer,o=t.camera,a=t.controls,r=t.renderer,i=t.scene;assertIsDefined(o),assertIsDefined(r),this.freeformControls=new ControlsManager(o,r.domElement),i.add(this.freeformControls),this.freeformControls.listen(RAYCASTER_EVENTS.DRAG_START,function(){a.enabled=!1}),this.freeformControls.listen(RAYCASTER_EVENTS.DRAG,function(t,o){return e.debouncedPublish(t,o)}),this.freeformControls.listen(RAYCASTER_EVENTS.DRAG_STOP,function(t,o){e.debouncedPublish(t,o),a.enabled=!0})},a.makeInteractiveMarkerFeedbackMessage=function(e){var t=e.seq,o=e.frame_id,a=e.client_id,r=e.marker_name,i=e.control_name,n=e.position,s=e.quaternion;return new ROSLIB.Message({header:{seq:t,frame_id:o,stamp:{secs:0,nsecs:0}},client_id:a,marker_name:r,control_name:i,pose:{position:{x:n.x,y:n.y,z:n.z},orientation:{x:s.x,y:s.y,z:s.z,w:s.w}},event_type:1,menu_entry_id:0,mouse_point:{x:0,y:0,z:0},mouse_point_valid:!1})},a.makeInteractiveMarkerFeedbackTopic=function(e,t){return new ROSLIB.Topic({ros:e,name:t,messageType:MESSAGE_TYPE_INTERACTIVEMARKER_FEEDBACK})},a.prototype.publish=function(e,t){var o;if(e){var r=e.userData.control,i=r.frameId,n=r.markerName,s=e.userData.handlesControlsMap[t],l=a.makeInteractiveMarkerFeedbackMessage({seq:this.messageSequence,client_id:this.clientId,frame_id:i,marker_name:n,control_name:s,position:e.position,quaternion:e.quaternion});null!==this.feedbackTopic&&(null===(o=this.feedbackTopic)||void 0===o?void 0:o.publish(l)),this.messageSequence++}},a.prototype.publishManual=function(e){var t=a.makeInteractiveMarkerFeedbackMessage(__assign(__assign({seq:this.messageSequence,client_id:this.clientId},e),{frame_id:Array.from(this.interactiveMarkersFrameIds)[0],marker_name:Array.from(this.interactiveMarkersNames)[0]}));null!==this.feedbackTopic&&this.feedbackTopic.publish(t),this.messageSequence++},a.prototype.updateOptions=function(t){void 0===t.feedbackTopicName?this.feedbackTopic=null:(!this.feedbackTopic||this.feedbackTopic.name!==t.feedbackTopicName.name)&&(assertIsDefined(this.ros),this.feedbackTopic=a.makeInteractiveMarkerFeedbackTopic(this.ros,t.feedbackTopicName));var o=this.options.updateTopicName!==t.topicName&&this.init,r=this.topicName===this.options.updateTopicName;if(o&&void 0!==t.updateTopicName){var i=t.updateTopicName,n=i.messageType,s=i.name;this.changeTopic(s,n,!0)}else o&&r&&this.unsubscribe();e.prototype.updateOptions.call(this,t)},a.prototype.update=function(t){var o=this;if(e.prototype.update.call(this,t),t.markers&&0<t.markers.length&&(t.markers.forEach(function(e){o.interactiveMarkersNames.has(e.name)||o.interactiveMarkerManager.initMarkers(e,o.freeformControls,o.options.visible),o.interactiveMarkersNames.add(e.name),e.header&&o.interactiveMarkersFrameIds.add(e.header.frame_id),t.markers.forEach(function(e){o.interactiveMarkerManager.updatePose(e)})}),!this.init))if(this.init=!0,void 0!==this.options.updateTopicName){var a=this.options.updateTopicName,r=a.messageType,i=a.name;this.init=!0,this.changeTopic(i,r,!0)}else this.unsubscribe();if(t.poses&&0<t.poses.length&&t.poses.forEach(function(e){o.interactiveMarkerManager.updatePose(e)}),t.erases);},a.prototype.reset=function(){this.interactiveMarkerManager.reset(!1)},a}(LegacyCore),open=require("rosbag").open,RosbagBucket=function(){var e=Math.pow,t=Math.floor;function o(){var o=this;this.files=new Set,this.topics=[],this.readers={},this.addFile=function(e){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:if(this.files.has(e))throw new Error("file already exists in the bucket");return this.files.add(e),this.readers[e.name]={topics:{},queue:[]},[4,this.processFile(e)];case 1:return t.sent(),[2];}})})},this.removeFile=function(e,t){return __awaiter(o,void 0,void 0,function(){return __generator(this,function(o){if(!this.files.has(e))throw new Error("file does not exist in the bucket");return this.files.delete(e),clearTimeout(this.readers[e.name].timer),clearTimeout(this.readers[e.name].queueStartWaitTimer),this.readers[e.name]={topics:{},queue:[]},this.topics=this.topics.filter(function(t){return t.rosbagFileName!==e.name}),t(),[2]})})},this.addReader=function(e,t,a){var r,i=o.readers[t].topics;if(!i)throw new Error("add "+t+" to the bucket first");i[e]||(i[e]=new Set),null===(r=i[e])||void 0===r?void 0:r.add(a)},this.removeReader=function(e,t,a){var r,i,n=o.readers[t].topics;if(!n)throw new Error("add "+t+" to the bucket first");if(null===(r=n[e])||void 0===r||!r.has(a))throw new Error("reader has not yet been added to the bucket");null===(i=n[e])||void 0===i?void 0:i.delete(a)},this.processQueue=function(e){var t=o.readers[e.name].queue;return 0===t.length?void(o.readers[e.name].queueStartWaitTimer=window.setTimeout(function(){o.processQueue(e)},500)):void o.enqueueProcessing(0,e)},this.enqueueProcessing=function(a,r){var i=o.readers[r.name].queue,n=i[a],s=i[a+1];if(o.processBagReadResult(n,r),!s)return void o.enqueueProcessing(0,r);var l=n.timestamp,d=l.sec,p=l.nsec,c=s.timestamp,m=c.sec,u=c.nsec,h=t(d*e(10,3)+p/e(10,6)),g=t(m*e(10,3)+u/e(10,6)),y=0;g>h&&(y=g-h),4>y?o.enqueueProcessing(a+1,r):o.readers[r.name].timer=window.setTimeout(function(){o.enqueueProcessing(a+1,r)},y)},this.processBagReadResult=function(e,t){var a=o.readers[t.name].topics,r=a["*"],i=a[e.topic];null===r||void 0===r?void 0:r.forEach(function(o){return o(t,e)}),null===i||void 0===i?void 0:i.forEach(function(o){return o(t,e)})}}return o.prototype.processFile=function(e){return __awaiter(this,void 0,void 0,function(){var t,o=this;return __generator(this,function(a){switch(a.label){case 0:return[4,open(e)];case 1:return t=a.sent(),Object.keys(t.connections).forEach(function(a){var r=t.connections[a],i=r.topic,n=r.type,s=o.topics.findIndex(function(t){return t.name===i&&t.rosbagFileName===e.name});-1===s&&o.topics.push({name:i,messageType:n,rosbagFileName:e.name})}),t.readMessages({},function(t){o.readers[e.name].queue.push(t)}),this.processQueue(e),[2];}})})},o}(),RosbagDataSource=function(){function e(e){var t,o=this;this.createdAt=new Date,this.isStreamPaused=!1,this.internalListener=null,this.listeners=new Set,this.addListener=function(e){return o.listeners.has(e)?{success:!1,reason:"listener already present"}:(o.listeners.add(e),o.stream.addListener(e),{success:!0})},this.removeListener=function(e){return o.listeners.has(e)?(o.listeners.delete(e),o.stream.removeListener(e),{success:!0}):{success:!1,reason:"listener not present"}},this.removeAllListeners=function(){return o.listeners.forEach(function(e){o.stream.removeListener(e)}),o.listeners.clear(),{success:!0}},this.pause=function(){return o.isStreamPaused=!0,{success:!0}},this.resume=function(){return o.isStreamPaused=!1,{success:!0}},this.hasMemory=!(null===(t=e.memory)||void 0===t)&&t,this.bucket=e.bucket,this.producer={start:function(t){o.internalListener=function(e,a){o.isStreamPaused||t.next(a.message)},o.bucket.addReader(e.topicName,e.fileName,o.internalListener)},stop:function(){o.internalListener&&o.bucket.removeReader(e.topicName,e.fileName,o.internalListener)}},this.stream=this.hasMemory?xs.createWithMemory(this.producer):xs.create(this.producer)}return e}(),index={EditorControls:EditorControls,CollisionObject:CollisionObject,DepthCloud:DepthCloud,DisplayTrajectory:DisplayTrajectory,PlanningScene:PlanningScene,Point:Point,PointCloud:PointCloud,Polygon:Polygon,Pose:Pose,Wrench:Wrench,PoseArray:PoseArray,Tf:Tf,RobotModel:RobotModel,MarkerArray:MarkerArray,LaserScan:LaserScan,Map:Map$1,Odometry:Odometry,Path:Path,Image:Image,ImageStream:ImageStream,Marker:Marker,Range:Range,Scene:Scene,Viewer2d:Viewer2d,Viewer3d:Viewer3d,TfViewer:TfViewer,InteractiveMarkers:InteractiveMarkers,RosbagBucket:RosbagBucket,RosTopicDataSource:RosTopicDataSource,RosbagDataSource:RosbagDataSource,CONSTANTS:CONSTANTS};export default index;
